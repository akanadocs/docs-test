---
layout: page
title: Using the Microsoft Azure Service Bus Relay Policy
description: Learn how to use the Microsoft Azure Service Bus Relay Policy to host your on-premise APIs in the Microsoft Azure cloud.
product: ag
category: learn
weight:	3
sub-nav-class: Intermediary for Microsoft
type: page
nav-title: Using the Microsoft Azure Service Bus Relay Policy
---
  <h2 name="top">Using the Microsoft Azure Service Bus Relay Policy</h2>
  <p>Learn how to use the Microsoft Azure Service Bus Relay Policy to host your on-premise APIs in the Microsoft Azure cloud.</p>
<a href="../policies/policy_management.htm" class="button secondary">Managing Policies</a>

<p></p>

  <div class = "divider1"></div>
   <h3 style="color: gray;">Table of Contents</h3>

   <ol class="table_of_contents">

 <li><a href="#introduction">Introduction</a></li>

  <li><a href="#configuration">Configuration</a></li>


  </ol>
  <div class = "divider1"></div>
<a name="introduction">
<h3>Introduction</h3></a>

<p>The &quot;Microsoft Azure Service Bus Relay Policy&quot; is an Intermediary for Microsoft  operational policy that is installed to the Policy Manager Management Console as part of the  Intermediary for Microsoft product installation.
</p>
<p> With this policy, you can host your on-premise APIs in the Microsoft Azure cloud.  The policy offers Shared Secret or Access Control authentication modes. </p>
<p>To install this policy, see <em>Chapter 3: Installing SOA Software Intermediary for Microsoft Policy Manager Policy</em> section of the <em>SOA Software Intermediary for MicrosoftÂ® Install Guide</em> for installation instructions.</p>
<p><a href="#top">Back to top</a></p>
<a name="configuration">
<h3>Configuration</h3></a>



<p>Let's take a quick walkthrough of the Microsoft Azure Service Bus Relay   Policy configuration process to get your started.
</p>
<h5>Step 1: Add Policy</h5>

  <p>You can create a Microsoft Azure Service Bus Relay Policy instance using <strong>Add Policy</strong> in the <em>Policies &gt; Operational Policies</em> section.</p>
  <h5>Step 2: Modify Policy</h5>
<p>When you <strong>Modify</strong> the Microsoft Azure Service Bus Relay on the <em>Policy Details</em> page the initial policy will look like this:</p>
<p><img src="images/ms_azure_pol_summary.jpg" width="506" height="277" /></p>
<h5>Step 3: Configure Policy</h5>
<p>Configure the Microsoft Azure Service Bus Relay Policy as follows:</p>
<ul class="usingOrderedList">
  <li><strong>Access Control Service (Shared Secret)</strong> - If you require that shared access keys remain private, encrypt the key using SOA Software's CryptoTool utility, enter that encrypted key for the shared access key, and declare the key encrypted here. See further SOA Software documentation on how to use the CryptoTool utility. </li>
  <li><strong>Shared Access Key</strong> - Enter the shared access key, either primary or secondary, associated with the shared access policy entered above.</li>
  <li><strong>Shared Access Policy Name</strong> - Each Microsoft Azure Service Bus namespace has a set of shared access policies used for authorization. Each policy grants certain access rights to Service Bus objects. Enter the name of the shared access policy that should be used for this connection. </li>
  <li><strong>Service Bus Connection</strong> -
    Shared Access Signature is an authentication method that uses Microsoft Azure Service Bus's built in security model for authenticating providers. Shared Access Signature requires a Service Bus policy and associated key that providers will use to authenticate with Service Bus. <em>Please see the Microsoft Azure Service Bus documentation for details. </em></li>
  <li><strong>Access Control Service (Shared Secret)</strong> - Access Control Service (Shared Secret) is an authentication method that uses Microsoft Azure's Access Control Service to authenticate providers. Providers can authenticate with ACS using a pre-configured service identity and shared secret, which then federates with Microsoft Azure Service Bus. <em>Please see Microsoft Azure Service Bus documentation for more information on this authentication mode. </em><br />
  </li>
  <li><strong>Client Details &gt; Service Bus Connections </strong>- Enter the authentication mode that should be required of all clients connecting to Microsoft Azure Service Bus. If &quot;None&quot; is selected, any client can connect to Microsoft Azure Service Bus without needing to authenticate.  If &quot;Relay Access Token&quot; is selected, all clients must first retrieve a valid relay access token, that Microsoft Azure Service Bus will first authenticate and authorize before allowing the client's transaction to proceed. Note that regardless of authentication mode, additional security can and should be used within the Policy Manager virtual service to ensure conformance to the required security policy.<br />
  </li>
</ul>
<h5><img src="images/modify_msazure_policy.jpg" width="458" height="450" /></h5>
<h5>Step 4: Attach Policy</h5>
<p>After you have saved your policy you can  attach it to an Intermediary for Microsoft virtual Service in Policy Manager or you can attach the policy at the Organization level and the policy will be active for all services defined within the organization. </p>
<p><img src="images/ms_azure_pol_attach.jpg" width="653" height="175" /></p>
<h5>Step 5: Test Policy</h5>
<p>After you attached the Microsoft Azure Service Bus Relay Policy to a virtual service, send a request to your service and view the results in your client. You can also go to the <em>Services &gt; Monitoring</em> section to view the results for Logs (i.e., View Usage Record Details), Real Time Charts, and Historical Charts. Refer to the Policy Manager Online Help (i.e., Help button) for more information on the using the monitoring functions.</p>
<p>If you receive errors, review the log information for details. In most cases, errors are typically associated with specifying the wrong credentials for the Microsoft Azure Service Bus Provider. You may see errors when the service is first deployed to Intermediary for Microsoft and Intermediary for Microsoft connects to  Microsoft Azure Service Bus using incorrect credentials. Update the credentials in the policy and retry. </p>
<p><a href="#top">Back to top</a></p>

