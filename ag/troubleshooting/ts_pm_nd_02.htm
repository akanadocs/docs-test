---
layout: page
title: Troubleshooting for Policy Manager
description: Troubleshooting resources and tips for Policy Manager.
product: ag
category: ref
sub-nav-class: Troubleshooting
weight: 05
type: page
nav-title: Troubleshooting PM
---
<h1 id="top">Troubleshooting Policy Manager</h1>
<p>Information to help you troubleshoot issues that might come up with Policy Manager.</p>
<hr class="divide_hr" />



<h2 style="color: gray;">Table of Contents</h2>
<ol class="table_of_contents">
	<li><a href="#s02_01">Troubleshooting Issues: System Administrator</a></li>
	<li><a href="#s02_02">Database Issues</a></li>
	<li><a href="#s02_03">Monitoring Issues</a></li>
	<li><a href="#s02_04">Console Login Issues</a></li>
	<li><a href="#s02_05">Issues with Alerts</a></li>
	<li><a href="#s02_06">Unable to Start a Container</a></li>
	<li><a href="#s02_07">Troubleshooting Issues: Policy Manager Administrator</a></li>
	<li><a href="#s02_08">Miscellaneous Items</a></li>
</ol>
<hr class="divide_hr" />



<h2 id="s02_01">Troubleshooting Issues: System Administrator</h2>
<p>The earlier sections of this document provide information about issues a System Administrator might encounter with Policy Manager. It includes:</p>
<ul>
	<li><a href="#s02_02">Database Issues</a></li>
	<li><a href="#s02_03">Monitoring Issues</a></li>
	<li><a href="#s02_04">Console Login Issues</a></li>
	<li><a href="#s02_05">Issues with Alerts</a></li>
	<li><a href="#s02_06">Unable to Start a Container</a></li>
</ul>
<p><a href="#top">Back to top</a></p>



<h2 id="s02_02">Database Issues</h2>
<p>This section provides information about issues that might occur relating to your database, with suggestions and instructions to help you resolve the problem. It includes:</p>
<ul>
	<li><a href="#s02_02_01">Database Connections All In Use (Connection Pool Exhausted)</a></li>
	<li><a href="#s02_02_02">Database Locks on soa_qrtz_locks Table</a></li>
	<li><a href="#s02_02_03">Policy Manager Alert Code 92304, Retry Count Exceeded, when Database is Not Full</a></li>
	<li><a href="#s02_02_04">Database Password Expired</a></li>
	<li><a href="#s02_02_05">Database Thread Lock</a></li>
</ul>


<h3 id="s02_02_01">Database Connections All In Use (Connection Pool Exhausted)</h3>
<p>If database connections are all in use, virtual services on the Network Director might not be accessible. You might also see an out of memory error in the stdout log or console, and see the error message below in the log file:</p>
<pre>SQLNestedException: Cannot get a connection, pool exhausted.</pre>

<p>This can happen, in an environment with high traffic, if all database connections might be used by Policy Manager.</p>
<p>You can verify this with the monitoring tool for the Policy Manager container. If you see the error message listed above, the database connections are all in use.</p>
<h4>Solution:</h4>
<p>One resolution is to increase the maximum number of database threads. To do this, follow the steps below.</p>

<h4 id="proc_increase_max_db_threads">To increase the maximum number of database threads</h4>
<ol>
	<li>Log in to the Akana Administration Console for the Policy Manager instance.</li>
	<li>Click the <strong>Configuration</strong> tab.</li>
	<li>In the <strong>Configuration Categories</strong> section on the left, choose <strong>com.soa.database.config</strong>, and then select the applicable config ID.</li>
	<li>Change the <strong>maxPoolSize</strong> value from <strong>30</strong> to <strong>50</strong>.</li>
	<li>Click <strong>Apply Changes</strong>.</li>
</ol>
<p class="apidoc_note"><strong>Note</strong>: The settings take effect immediately. You do not need to restart the container. </p>


<h3 id="s02_02_02">Database Locks on soa_qrtz_locks Table</h3>
<p>If the DBA reports that there are database locks on the soa_qrtz_locks table with the Policy Manager database, it is probably because the Quartz scheduler is running on more than one Policy Manager instance.</p>
<p>The Quartz scheduler can only run on one Policy Manager instance. If your environment includes multiple Policy Manager instances, and more than one of them has the <strong>org.quartz.scheduler.enabled</strong> value set to <strong>true</strong>, it's likely that there will be issues with database locks on the soa_qrtz_locks table.</p>
<p>You'll need to determine which Policy Manager instance you want the Quartz scheduler to run on, and then disable it on any other Policy Manager instances.</p>
<h4>Solution:</h4>
<p>Verify that the Quartz scheduler is running on only one Policy Manager instance.</p>

<h4 id="proc_set_quartz_scheduler">To set the Quartz scheduler to run on only one Policy Manager instance</h4>
<ol>
	<li>Log in to the Akana Administration Console for the instance of Policy Manager that you want the Quartz scheduler to run on.</li>
	<li>Click the <strong>Configuration</strong> tab.</li>
	<li>In the <strong>Configuration Categories</strong> section on the left, choose <strong>com.soa.scheduler.quartz</strong>, and then click the container.</li>
	<li>On the right, make sure the <strong>org.quartz.scheduler.enabled</strong> value is set to <strong>true</strong>. If you change the value, click <strong>Apply Changes</strong>.</li>
	<li>Log in to the Akana Administration Console for the next instance of Policy Manager. Make sure the <strong>org.quartz.scheduler.enabled</strong> value is set to <strong>false</strong>. If you change the value, <strong>click Apply Changes</strong>.</li>
	<li>Repeat Step 5 for all other Policy Manager instances.</li>
</ol>
<p class="apidoc_note"><strong>Note</strong>: You do not need to restart the container after making these changes.</p>


<h3 id="s02_02_03">Policy Manager Alert Code 92304, Retry Count Exceeded, when Database is Not Full</h3>
<p>Policy Manager alert code 92304 message text: <strong>UsageWriter retry count has been exceeded</strong>.</p>
<p>One possible cause for getting this alert code when the database is not full is that there is more than auditing policy applied to the service.</p>
<p>For example, you might have a detailed auditing policy attached and also have the recording component turned on for a pipeline policy.</p>
<p>If you have multiple auditing policies turned on you will typically see this alert. The database constraint does not allow duplicate monitoring of data.</p>
<h4>Solution:</h4>
<p>Verify that the service being called has only one auditing policy attached to it. If there is more than one, choose the auditing policy you most want to use and remove any others so there is just one auditing policy applied.</p>


<h3 id="s02_02_04">Database Password Expired</h3>
<p>During the initial install, the database password is set up as part of configuring Policy Manager.</p>
<p>If the database password expires or is changed, Policy Manager cannot access the database.</p>
<h4>Solution:</h4>
<p>If the database password expires or is changed, you'll need to update it in Policy Manager.</p>
<p class="apidoc_note"><strong>Note</strong>: If the database password expires, contact the database administrator and if possible set the password to never expire. If this is not possible due to company security policies, follow the steps below to change the password.</p>

<h4 id="proc_change_db_password">To change the database password in Policy Manager</h4>
<ol>
	<li>Log in to the Akana Administration Console for the Policy Manager instance.</li>
	<li>Click the <strong>Configuration</strong> tab.</li>
	<li>In the <strong>Configuration Categories</strong> section on the left, choose <strong>com.soa.database.config</strong>, and then select the applicable config ID.</li>
	<li>In the password field, specify the new password.</li>
	<li>At the bottom right, click <strong>Add Property</strong>. The <strong>Add Configuration Property</strong> overlay appears.</li>
	<li>Enter the following:
		<ul>
			<li>Property Name: <strong>encryptValues</strong></li>
			<li>Property Value: <strong>false</strong></li>
		</ul>
		</li>
		<li>Click <strong>Apply</strong> to save the change and close the overlay.</li>
	<li>Click <strong>Apply Changes</strong>.</li>
	<li>Restart the Policy Manager instance.</li>
</ol>
<h3 id="s02_02_05">Container Running Out of Memory</h3>
<h4 class="stamp">Valid in version: 7.0 and later</h4>
<p class="apidoc_note"><strong>Note</strong>: This article applies to Policy Manager containers in version 6.1.6 update or later versions. </p>
<p>If the container is running out of memory, it could be because the automated rollup data deletion job is running, consuming memory.</p>
<p>By default, Policy Manager creates rollups for its own services, recording performance statistics for calls made to it, usually from Network Director.</p>
<p>The rollup data accumulates in the database over time if not cleaned out regularly. Automatic rollup data deletion jobs periodically clean out the accumulated data, but can slow down the system and even cause out of memory issues.</p>
<p>The automatic rollup data deletion job retrieves information older than a specified date, archives the data in the Export folder, and then deletes the archived information from the database. The job runs in the Policy Manager container. If there are a lot of calls to Policy Manager at the time the job is running, you might see a condition where the Policy Manager container runs out of memory.</p>
<h4>Solution:</h4>
<p>If there are memory issues and you suspect the automated data deletion jobs are the cause, you can change the settings so that the data deletion job does not run automatically.</p>
<p>If your system is becoming slow, or you are getting memory errors, it might be because of the job that is required to process all the rollup data.</p>
<p>Typically, if there is a memory error, the container will consume all the CPU cycles and the memory usage for this process will be at 100%.</p>
<p>Some troubleshooting steps you can take:</p>
<ul>
	<li>Add the monitoring tool. This will help you determine the issue. See <a href="ts_pm_nd_01.htm#proc_install_monitoring">To install the monitoring tool</a>.</li>
	<li>If the metrics are not important, you can disable the setting in the Akana Administration Console for the Policy Manager container so that they are not generated (see <a href="#proc_disable_rollup">To disable unnecessary rollup data metrics</a> below).</li>
	<li>You can manually delete unnecessary data from the database (see To manually delete unnecessary rollup data from the database below). Some customers prefer not to have automatic rollup data deletion jobs scheduled so that they can choose the best time to run this maintenance task.
	<p class="apidoc_note"><strong>Note</strong>: If you do this, you'll need to delete the data manually later.</p></li>
	<li>If you continue to experience memory issues after disabling the automated data deletion job, you can allocate more memory to the container Java process. The default is 1 GB, but you could increase the memory to 2 GB or more by changing to 64-bit JRE (see <a href="#s02_08_02">Out of memory errors on the error log</a>).</li>
</ul>

<h4 id="proc_disable_rollup">To disable unnecessary rollup data metrics</h4>
<ol>
	<li>Log in to the Akana Administration Console for the Policy Manager instance.</li>
	<li>Click the <strong>Configuration</strong> tab.</li>
	<li>In the <strong>Configuration Categories</strong> section on the left, choose <strong>com.soa.metrics</strong>.</li>
	<li>In the right pane, set the value of the <strong>metrics.rollup.reporter.requireMetricsPolicy</strong> property to <strong>true</strong>.</li>
	<li>Click <strong>Apply Changes</strong>.</li>
</ol>

<h4 id="proc_monitoring_off_deletions">To turn off automatic monitoring data deletion jobs</h4>
<ol>
	<li>Log in to the Akana Administration Console for the Policy Manager instance.</li>
	<li>Click the <strong>Configuration</strong> tab.</li>
	<li>In the <strong>Configuration Categories</strong> section on the left, choose <strong>com.soa.rollup.delete.old</strong>.</li>
	<li>Change one or more of the rollup enable properties from <strong>true</strong> to <strong>false</strong>.</li>
	<li>Click <strong>Apply Changes</strong>.</li>
</ol>
<p class="apidoc_note"><strong>Note</strong>: You must restart the Policy Manager container for the change to take effect.</p>

<h4>To manually delete unnecessary rollup data from the database</h4>
<p>To manually purge the rollup data from the database, run the queries below.</p>
<p class="apidoc_note"><strong>Note</strong>: Modify the date in the scripts below to reflect how much data you want to delete (the <strong>to_date</strong> value). Any information older than the date you specify is deleted.</p>
<p><strong>Backing up before deletion</strong>—You can also back up the data before deletion, or you can export the monitoring data before deletion.</p>
<p><strong>Delete rollup (chart) data script:</strong></p>
<pre>delete from MO_ROLLUPDATA where INTVLSTARTDTS &lt; to_date ('2013-12-01 00:00:00', 'YYYY-MM-DD HH24:MI:SS')
delete from MO_ROLLUP15 where INTVLSTARTDTS &lt; to_date ('2013-12-01 00:00:00', 'YYYY-MM-DD HH24:MI:SS')
delete from MO_ROLL_ORG15 where INTVLSTARTDTS &lt; to_date ('2013-12-01 00:00:00', 'YYYY-MM-DD HH24:MI:SS')
delete from MO_ROLLUP_HOUR where INTVLSTARTDTS &lt; to_date ('2013-12-01 00:00:00', 'YYYY-MM-DD HH24:MI:SS')
delete from MO_ROLL_ORG_H where INTVLSTARTDTS &lt; to_date ('2013-12-01 00:00:00', 'YYYY-MM-DD HH24:MI:SS')
delete from MO_ROLLUP_DAY where INTVLSTARTDTS &lt; to_date ('2013-12-01 00:00:00', 'YYYY-MM-DD HH24:MI:SS')
delete from MO_ROLL_ORG_D where INTVLSTARTDTS &lt; to_date ('2013-12-01 00:00:00', 'YYYY-MM-DD HH24:MI:SS')</pre>
<p><a href="#top">Back to top</a></p>



<h2 id="s02_03">Monitoring Issues</h2>
<p>This section provides information about issues that could affect your monitoring data, with suggestions and instructions to help you resolve the problem. It includes:</p>
<ul>
	<li><a href="#s02_03_01">No Data In Historical Charts</a></li>
	<li><a href="#s02_03_02">Historical Charts Displayed for Some Increments but Not Others</a></li>
	<li><a href="#s02_03_03">Historical Data Shows but Real-Time Data Does Not Show</a></li>
</ul>


<h3 id="s02_03_01">No Data in Historical Charts</h3>
<p>If you are seeing real-time charts, but there is no data in the historical charts, it might be because the MAX_ID value in the MO_STATUS table has reached its limit.</p>
<h4>Solution:</h4>
<p>To resolve this issue, run the following query on your Policy Manager database:</p>
<pre>select MAX(ROLLUPDATAID) from MO_ROLLUPDATA
update MO_STATUS set max_id = &lt;result from the above query&gt;
update SOA_QRTZ_TRIGGERS set TRIGGER_STATE = 'WAITING' where 
job_name='ms.generate.rollups.job.Trigger'</pre>


<h3 id="s02_03_02">Historical Charts Displayed for Some Increments but Not Others</h3>
<p class="apidoc_note"><strong>Note</strong>: This issue might occur in the Policy Manager 6.x environment for systems upgraded from an earlier version of Policy Manager. For new 6.x installations it will not occur.</p>
<p>Issues with historical chart information display are frequently due to the time zone configuration settings in Policy Manager. For example, if you can see daily data by the hour and weekly data by the day, but cannot see monthly data by day or week, this is caused by a configuration issue.</p>
<p>Historical chart data is stored in the ROLLUP data tables in the database. By default, this data is stored in GMT time. However, when you go to the Policy Manager Workbench, on the monitoring tab of the service, you will see that the time is shown in the time zone you configured in your Policy Manager profile.</p>
<p>To see accurate historical information for your implementation, this data should be set to display in the same time zone as your Policy Manager profile.</p>
<p><strong>Note</strong>: Some locations have a time zone offset that isn't in whole hours; for example, Bangalore, India. In this scenario, there is another configuration setting that would also need to be changed, to set the configuration rollup offset to 30 minutes. See <a href="#proc_rollup_config_time_offset">To configure the time offset for the rollup data tables</a> below.</p>
<h4>Solution:</h4>
<p>To configure the time zone setting for the rollup data tables, follow the steps below.</p>

<h4 id="proc_rollup_config_time_zone">To configure the time zone setting for the rollup data tables</h4>
<ol>
	<li>Log in to the Akana Administration Console for the Policy Manager instance.</li>
	<li>Click the <strong>Configuration</strong> tab.</li>
	<li>In the <strong>Configuration Categories</strong> section on the left, choose <strong>com.soa.rollup.configuration</strong>.</li>
	<li>In the right pane, set the <strong>monitoring.rollup.configuration.dailyRollupTimeZones</strong> property.
	<p>This property should list the time zones for which you want to collect the historical data. For example, to collect usage data for the GMT and MST time zones, you would enter: <strong>GMT, MST</strong>.</p></li>
	<li>In the right pane, set the <strong>statistic.dao.timeZoneMappings property</strong>.
<p>This property value should list the time zones that you want the data to display in when it is viewed in the console. For example, to display the historical charts for both GMT and MST, you would enter: <strong>UTC:GMT, America/Phoenix:MST</strong>.</p>
<p class="apidoc_note"><strong>Note</strong>: If you are not sure what value to use for time zone, you can check the setting in Policy Manager. In the Policy Manager Console, at the top right, click MyProfile and check the value specified in the Time Zone field. The user profile and the rollup tables should both be set to the same time zone.</p></li>
	<li>Click <strong>Apply Changes</strong>.</li>
</ol>

<h4 id="proc_rollup_config_time_offset">To configure the time offset for the rollup data tables</h4>
<p>Some locations have a time zone offset that isn't in whole hours; for example, Bangalore, India. In this scenario, there is another configuration setting that would also need to be changed, to set the configuration rollup offset to 30 minutes. Follow the steps below.</p>
<p>The default value is <strong>0</strong>, which means that rollups are per hour, on the hour. When this value is set to <strong>0,30</strong>, rollups are also created for each hour, on the half-hour.</p>
<ol>
<li>Log in to the Akana Administration Console for the Policy Manager instance.</li>
	<li>Click the <strong>Configuration</strong> tab.</li>
	<li>In the <strong>Configuration Categories</strong> section on the left, choose <strong>com.soa.rollup.configuration</strong>.</li>
	<li>In the right pane, set the <strong>monitoring.rollup.configuration.hourRollupMinutesOffsets</strong> property.
<p>The default value is <strong>0</strong>. To add an hourly rollup that rolls up on the half-hour, set the value to <strong>0,30</strong>.</p>
<p><strong>Note</strong>: Adding a value, rather than changing the default, will result in two sets of rollup data. If you only have one group of users, in the offset time zone, you can replace the default. If you have users in different time zones, add the value.</p>
</li>
<li>Click <strong>Apply Changes</strong>.</li>
</ol>

<h3 id="s02_03_03">Historical Data Shows but Real-Time Data Does Not Show</h3>
<p>Note: This issue might occur in the Policy Manager 6.x environment for systems upgraded from an earlier version of Policy Manager. In new 6.x installations it will not occur.</p>
<p>If data shows in historical charts but not in real-time charts, this might be because of inconsistent time zone settings on different machines.</p>
<p>For example, if the Network Director time is set to one hour earlier than the Policy Manager machine, you will never see any data in the real-time charts, since there is only a one-hour window in which to view the data.</p>
<h4>Solution:</h4>
<p>Verify that the time zones are the same on Policy Manager and Network Director.</p>
<p><a href="#top">Back to top</a></p>



<h2 id="s02_04">Console Login Issues</h2>
<ul>
	<li><a href="#s02_04_01">Cannot Log In to Policy Manager Console When Using Load Balancer</a></li>
	<li><a href="#s02_04_02">Lost the Only Admin Password</a></li>
	<li><a href="#s02_04_03">Access to the Akana Administration Console Needs to Be Restricted to Localhost Only</a></li>
</ul>


<h3 id="s02_04_01">Cannot Log In to Policy Manager Console When Using Load Balancer</h3>
<p>The user is redirected to the login page when trying to log in to the Policy Manager Console if the Policy Manager Workbench can't access the session, so the user is treated as a new user. If this occurs, there are two things to check:</p>
<ul>
	<li><strong><a href="#s02_04_01_01">Application Layer Persistence setting on load balancer (JSESSION Cookie)</a></strong>. If the persistence setting is not enabled, the JSESSION cookie is not passed on to the user, and the user is redirected back to the login page.</li>
	<li><strong><a href="#s02_04_01_02">Redirect Rewrite Setting on load balancer</a></strong> (SSL Offloading)</li>
</ul>

<h4 id="s02_04_01_01">Application Layer Persistence setting (JSESSION Cookie)</h4>
<p>Each login session is tracked by a JSESSION cookie. The load balancer must be able to access the session cookie and pass it back to the user.</p>
<p>Make sure the Application Layer Persistence setting is enabled on the load balancer. If the persistence on the load balancer is not turned on, the JSESSION cookie is not passed on to the user. Because the session information is not passed on, the user is redirected back to the login page.</p>
<p>The Application Layer Persistence setting is generally enabled by default. However, if you are experiencing difficulty logging in, it's best to make sure the setting hasn't been disabled.</p>
<p>The proper response to the login page request from the host is shown below. Note the JSESSION cookie on the last line.</p>
<pre>GET /ms/index.do HTTP/1.1
Host: pm_host:9900
Connection: keep-alive
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.17 (KHTML, like Gecko) Chrome/24.0.1312.56
Safari/537.17
Referer: http://pm_host:9900/ Accept-Encoding: gzip,deflate,sdch Accept-Language: en-US,en;q=0.8
Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.3
Cookie: JSESSIONID_pm_container=6jl7s7i4lm8qg</pre>

<h4>Solution:</h4>
<p>Check/modify the Application Layer Persistence setting in the load balancer configuration page.</p>


<h4 id="s02_04_01_02">Redirect Rewrite Setting on Load Balancer (SSL Offloading)</h4>
<p>If your implementation includes SSL Offloading (HTTPS to HTTP) for the load balancer, some Policy Manager console requests are redirected.</p>
<p>SSL Offloading is sometimes used in environments with multiple instances of Policy Manager and a single load balancer receiving traffic on HTTPS when Policy Manager has an HTTP endpoint.</p>

<h4>Solution:</h4>
<p>In this scenario, you must enable the Redirect Rewrite setting, to follow the redirects. You can modify this setting in the load balancer configuration page.</p>


<h3 id="s02_04_02">Lost the Only Admin Password</h3>
<p>There is only one administrator password for Policy Manager and it isn't available.</p>

<h4>Solution:</h4>
<p>You can reset the Policy Manager Console Admin password via the Akana Administration Console for the Policy Manager instance. Follow the steps below.</p>

<h4 id="proc_reset_admin_password">To reset the Admin password</h4>
<ol>
	<li>Log in to the Akana Administration Console for the Policy Manager instance.</li>
	<li>Click the <strong>Configuration</strong> tab.</li>
	<li>In the <strong>Configuration Categories</strong> section on the left, choose <strong>com.soa.admin.console.task.status</strong>.</li>
	<li>In the right panel, set the value of the <strong>com.soa.create.admin.user</strong> property to <strong>false</strong>.</li>
	<li>Click <strong>Apply Changes</strong>.</li>
	<li>Log out, and then log back in again.</li>
	<li>Click the <strong>Installed Features</strong> tab. <strong>Create Policy Manager Admin User</strong> is listed at the bottom as a pending task.</li>
	<li>Click <strong>Complete Configuration</strong> and set up the admin user.
	<p class="apidoc_note"><strong>Note</strong>: You will need to restart Policy Manager for the new settings to take effect.</p></li>
	<li>Run the following database query, which resets the password for the administrator account (and nothing else):</li>
	<li>Log in using the following credentials:
		<ul>
			<li>Username: <strong>administrator</strong></li>
			<li>password: <strong>password</strong></li>
		</ul>
		</li>
	
	<li>Once you're logged in, change the password to a unique and secure password.</li>
</ol>


<h3 id="s02_04_03">Access to the Akana Administration Console Needs to Be Restricted to Localhost Only</h3>
<p>For security reasons, it's best to make sure that access to the Akana Administration Console is restricted so that it's only accessible from the local machine (localhost).</p>
<p>To make sure the Akana Administration Console is accessible only from localhost, follow the procedure below.</p>

<h4 id="proc_restrict_ac_access">To restrict access to the Akana Administration Console so that it is accessible only from localhost</h4>
<ol>
	<li>Create a file in the ./sm60 directory named: <strong>com.soa.admin.console.cfg</strong>. Enter the following lines in the file:
<pre>admin.console.localhost.only=true
admin.console.access.restricted=true</pre></li>
	<li>Copy the <strong>com.soa.admin.console.cfg</strong> file into the ./sm60/instances/
		{instance_name}/deploy directory.</li>
	<li>From the Akana Administration Console, go to the <strong>Configuration</strong> tab. Verify that there is a configuration category named com.soa.admin.console and that it includes these two properties:
<ul>
	<li><strong>admin.console.localhost.only</strong> property set to <strong>true</strong></li>
	<li><strong>admin.console.access.restricted</strong> property set to <strong>true</strong></li>
</ul>
		</li>
	<li>Restart the container. </li>
	</ol>
<p>Once this setting is in place, when the container is up and running, the Akana Administration Console should only be accessible on the local machine. If an attempt is made to access it from another machine, a 404 error is returned.</p>
<p><a href="#top">Back to top</a></p>



<h2 id="s02_05">Issues with Alerts</h2>
<p>This section provides information about possible issues related to alerts and alert emails, including email configuration and notifications. It includes:</p>
<ul>
	<li><a href="#s02_05_01">Alert Notifications Not Configured</a></li>
	<li><a href="#s02_05_02">Incorrect <strong>From</strong> Address On Alert Notifications</a></li>
	<li><a href="#s02_05_03">CA Revocation Emails Not Being Sent</a></li>
	<li><a href="#s02_05_04">Too Many Alerts/Backlogged Alerts</a></li>
	<li><a href="#s02_05_05">Alert SMTP Server Not Set Up</a></li>
</ul>


<h3 id="s02_05_01">Alert Notifications Not Configured</h3>
<p>If you want emails to be sent out for alerts generated, you must configure email alert forwarding and set up email alert properties.</p>
<p>If the necessary configuration is not done, no alert messages are sent out.</p>

<h4>Solution:</h4>
<p>Configure the email alert forwarding settings.</p>

<h4 id="proc_config_email_alerts">To configure email alerts</h4>
<p class="apidoc_note"><strong>Note</strong>: Before configuring email alerts you must set up the SMTP server if it isn't set up yet.</p>
<ol>
	<li>Log in to Policy Manager.</li>
	<li>Click the <strong>Alerts</strong> tab.</li>
	<li>Click <strong>Email Groups</strong>.</li>
	<li>Add or modify email groups as needed.</li>
</ol>
<p>As part of adding or modifying an email group, you must specify the SMTP server used to send the emails. You can verify that the setup is correct by clicking <strong>Verify Connection</strong>. This sends a test message to all email addresses in the group.</p>
<p>For more information on setting up email groups for alerts, see <a href="../alerts/using_email_groups.htm">Using Email Groups</a>.</p>


<h3 id="s02_05_02">Incorrect &quot;From&quot; Address On Alert Notifications</h3>
<p>Email alert notifications are being sent using the default <strong>From</strong> email address (alert_notification@akana.com) if the default has not been modified.</p>

<h4>Solution:</h4>
<p>Configure the <strong>from</strong> address.</p>

<h4 id="proc_alerts_config_from_address">To configure the &quot;From&quot; address for alert emails</h4>
<ol>
	<li>Log in to the Akana Administration Console for the Policy Manager instance.</li>
	<li>Click the <strong>Configuration</strong> tab.</li>
	<li>In the <strong>Configuration Categories</strong> section on the left, choose <strong>com.soa.console</strong>.</li>
	<li>Add the following property: <strong>email.sender</strong>.</li>
	<li>For the property value, type the email address that should display in the <strong>From</strong> field for alert messages sent out by Policy Manager. Click <strong>Apply</strong>.</li>
	<li>Click <strong>Apply Changes</strong>.</li>
</ol>
<p class="apidoc_note"><strong>Note</strong>: The new setting takes effect after a short delay. You do not need to restart the container.</p>
<p>If you remove this property, the <strong>From</strong> address reverts to the default after the next restart of the Policy Manager container.</p>


<h3 id="s02_05_03">CA Revocation Emails not Being Sent</h3>
<p>If CA revocation emails are not being sent, one possible cause is that the SMTP server isn't configured for the Certificate Authority.</p>

<h4>Solution:</h4>
<p>In Policy Manager, configure the SMTP server for the CA.</p>

<h4 id="proc_config_smtp_server_cert_exp_email">To configure the SMTP server for the certificate expiration email</h4>
<ol>
	<li>Log in to Policy Manager.</li>
	<li>Click the <strong>Configure</strong> tab.</li>
	<li>Click <strong>Email</strong>.</li>
	<li>Click <strong>Modify SMTP Email Host</strong>.</li>
	<li>Set the applicable values and save changes.</li>
</ol>


<h3 id="s02_05_04">Alerts Not Showing Up on the Workbench</h3>
<p>If expected alerts are not showing up on the Workbench, it might be because alerts are backlogged.</p>
<p>By default, Policy Manager is set to process up to 20 alerts per minute.</p>
<p>If the number of alerts being generated exceeds Policy Manager's capability to process them, the alerts will backlog in Policy Manager. This can result in important information not reaching the right individual quickly enough; it can also result in alerts being irrelevant or even misleading due to being out of date.</p>

<h4>Solution:</h4>
<p>If the alerts are backlogged because the normal volume is higher than 20 per minute, you'll need to contact the Administrator of the Akana Administration Console for the Policy Manager instance, who can implement one or both of the following:</p>
<ul>
	<li>Increase the number of alerts Policy Manager can process per minute.</li>
	<li>Delete backlogged alerts from the database.</li>
</ul>
<p>For instructions and additional information, refer to <a href="#s02_07_05">Alert Emails Not Being Sent</a> later in this section.</p>


<h3 id="s02_05_05">Alert SMTP Server Not Set Up</h3>
<p>You can set up SMTP messaging to email the following notifications to users:</p>
<ul>
	<li>Alert notifications</li>
	<li>Certificate expiration notifications</li>
	<li>Out of memory errors on the error log</li>
</ul>
<p>When adding or modifying an email group, you must specify the SMTP server used to send the emails for that group. You can verify the email setup by sending a test email to all addresses within the group. Follow the steps below.</p>
<h4>To send a test email for an email group</h4>
<p>To send a test email to all addresses within the group, click <strong>Verify Connection</strong> under the Authenticated box. The test email is sent immediately.</p>

<h4 id="proc_config_pm_cert_exp_notif_send">To configure Policy Manager to send certificate expiration notifications</h4>
<ol>
	<li>Log in to the Policy Manager console.</li>
	<li>Click the <strong>Configure</strong> tab and then click <strong>Email</strong>.</li>
	<li>Click <strong>Modify SMTP Email Host</strong>.</li>
</ol>
<p>Certificate expiration notifications can be configured in the Policy Manager management console under <strong>Configure</strong> &gt; <strong>Email</strong> &gt; <strong>Modify SMTP Email Host</strong>, as shown below.</p>
<p><img src="assets/02_01.jpg" alt="Modify SMTP Email Host" /></p>

<h4 id="proc_pm_email_alerts_group">To configure Policy Manager to send email alert notifications to group members</h4>
<ol>
	<li>Log in to the Policy Manager console.</li>
	<li>Click the <strong>Alerts</strong> tab and then click <strong>Email Groups</strong>.</li>
	<li>Add a new email group, or modify an existing email group.</li>
	<li>In the <strong>Email Group</strong> overlay, add, update, or verify the email group details, including host information.</li>
	<li>Click <strong>Verify Connection</strong>. The Alert Manager sends a test email to the addresses defined for the email group.</li>
	<li>Conditional: If there is an issue, the emails are not sent out, and you will see an error message. Resolve as needed, and then try again.</li>
</ol>

<h4>To send alerts with a specific FROM: address</h4>
<p>You can configure your alert emails to display a specific address in the <strong>From</strong> field on the email. Follow the steps below.</p>

<h4 id="proc_alerts_from_address">To set up a specific &quot;From&quot; address for alert emails</h4>
<ol>
	<li>Log in to the Akana Administration Console for the Policy Manager instance.</li>
	<li>Click the <strong>Configuration</strong> tab.</li>
	<li>In the <strong>Configuration Categories</strong> section on the left, choose <strong>com.soa.console</strong>.</li>
	<li>Add the following property: <strong>email.sender</strong>.</li>
	<li>For the property value, type the email address that should display in the <strong>From</strong> field. Click <strong>Apply</strong>.</li>
	<li>Click <strong>Apply Changes</strong>.</li>
</ol>
<p class="apidoc_note"><strong>Note</strong>: The new setting takes effect after a short delay. You do not need to restart the container. </p>

<p>If you remove this property, the <strong>From</strong> address reverts to the default, alert_notification@akana.com, after the next restart of the Policy Manager container.</p>
<p><a href="#top">Back to top</a></p>



<h2 id="s02_06">Unable to Start a Container</h2>
<p>If the container will not start, it could be because of one of the following reasons:</p>
<ul>
	<li><a href="#s02_06_01">Incompatible JRE version</a></li>
	<li><a href="#s02_06_01">Cannot Bind to an Interface</a></li>
	<li><a href="#s02_06_01">Cannot Start a Container After an Update</a></li>
</ul>


<h3 id="s02_06_01">Incompatible JRE Version</h3>
<p>If the JRE version is incompatible with the Policy Manager version, the container will not start.</p>
<p class="apidoc_note"><strong>Note</strong>: Akana Container Instances created prior to Policy Manager Update 6.0.4.3 cannot run with Java 6.</p>

<h4>Solution:</h4>
<p>Verify that the JRE and update you are using are supported by the installed version of Policy Manager. Compatibility information is available in the installation documentation and on the support site.</p>


<h3 id="s02_06_02">Cannot Bind to an Interface</h3>
<p>It might be that there is an issue with binding to a virtual machine interface, and the container is not listening on the expected host/IP and port.</p>
<p>If the container is being run on a machine with multiple interfaces, it might be necessary to bind a particular host/IP and port to a specific interface.</p>
<h4>Solution:</h4>
<p>To ensure the container listens on the specified interface, ensure that the <strong>bind to all interfaces</strong> option for the container listener in the Policy Manager console is <strong>not</strong> checked.</p>
<p>To resolve this issue, follow the steps below.</p>

<h4 id="proc_bind_to_all_clear_setting">To clear the &quot;Bind to All Interfaces&quot; setting</h4>
<ol>
	<li>Log in to the Policy Manager console.</li>
	<li>For all affected containers, do the following:
		<ul>
			<li>From the organization tree, select the container.</li>
			<li>In the center pane, under Inbound Listeners, in the Actions drop-down list, select Modify Container Listener. The Configure HTTP Container Listener overlay opens.</li>
			<li>Clear the <strong>Bind to all interfaces</strong> checkbox and then click <strong>Finish</strong>.</li>
		</ul>
		</li>
	
	<li>Unregister the service using <strong>/sm60/bin/unregisterservice.ba</strong>t.</li>
	<li>Re-register the service using <strong>/sm60/bin/registerservice.bat</strong>.</li>
</ol>


<h3 id="s02_06_03">Cannot Start a Container After an Update</h3>
<p>If there is an error when starting Policy Manager/Network Director containers installed as a Windows service, it could be because of installation or configuration issues.</p>
<h4>Solution:</h4>
<p>To troubleshoot this problem, follow the steps below.</p>
<ul>
	<li><strong>Run at command line</strong>—First, try starting the containers from the command line with this command:
	<pre>start.bat {container}</pre>
	<p>Based on the results, determine the next step:</p>
	<ul>
		<li>If it runs from the command line: the problem is an issue with the Windows service. Go on to the next step to reinstall the service.</li>
		<li>If it does not run from the command line: the issue is with the container itself. The container might be trying to bind to a network interface that it cannot bind to. If so, because you can't start Policy Manager, you must edit the <strong>system.properties</strong> file. Go to <a href="#proc_bind_to_all_clear_properties">To clear the Bind to all interfaces setting in the system.properties file</a> below. Use <strong>netstat</strong> to verify this.</li>
	</ul>
	</li>
	<li><strong>Reinstall Windows service</strong>—If the container doesn't start from the command line, you'll need to reinstall the Windows service. To do this, first unregister the service and then register it again. Using the script in the /sm60/bin folder, run the following commands:
	<pre>UnregisterContainerService.bat {container_name}</pre>
	<pre>RegisterContainerService.bat {container_name}</pre></li>
</ul>

<h4 id="proc_bind_to_all_clear_properties">To clear the Bind to all interfaces setting in the system.properties file</h4>
<ol>
	<li>Open up the <strong>system.properties</strong> file: /sm60/instances/
		{PMcontainerName}/system.properties.</li>
	<li>Find the following default property:
	<pre>com.soa.http.bind.all=true</pre>
	<p>If the property doesn't exist, add it.</p></li>
	<li>Set the value for this property to <strong>false</strong>.</li>
	<li>Save and exit.</li>
</ol>
<p class="apidoc_note"><strong>Note</strong>: This property is typically modified if you have trouble connecting to the container listener. Another scenario where this might occur is if the machine has been assigned two different IP addresses. In this case, you must set the property to <strong>false</strong>. If you don't, the container Java process will bind to both IP addresses and be accessible on both addresses.</p>
<p><a href="#top">Back to top</a></p>



<h2 id="s02_07">Troubleshooting Issues: Policy Manager Administrator</h2>
<p>This section provides information about issues a Policy Manager Administrator might encounter. It includes:</p>
<ul>
<!--	<li>Cannot Connect to Service</li>-->
<!--	<li>Can't Create Service</li>-->
<!--	<li>Virtual Service Can't Connect to Physical Service</li>-->
<!--	<li>Authentication/Authorization Alerts</li>-->
	<li><a href="#s02_07_05">Alert Emails Not Being Sent</a></li>
</ul>


<h3 id="s02_07_05">Alert Emails Not Being Sent</h3>
<p>If alert emails are not being sent out, it might be because of one of the following:</p>
<ul>
	<li>Too many alerts pending. By default, Policy Manager is configured to process 20 alerts per minute.</li>
	<li>SMTP settings are not configured properly.</li>
</ul>
<h4>Solution:</h4>
<p>To clear the backlog of pending alert emails, run the following database query:</p>
<pre>update AM_ALERTDISPSTAT set lastalertsid = (select max(alertsid) from am_alerts)</pre>
<p>In addition, if the issue was not caused by an abnormal spike in alerts, you'll need to increase the number of alerts Policy Manager can process per minute.</p>

<h4 id="proc_alerts_increase">To increase the number of alerts Policy Manager can process per minute</h4>
<ol>
	<li>Log in to the Akana Administration Console for the Policy Manager instance.</li>
	<li>Click the <strong>Configuration</strong> tab.</li>
	<li>In the <strong>Configuration Categories</strong> section on the left, choose <strong>com.soa.framework</strong>.</li>
	<li>Add the following property:
	<pre>number.of.alerts.to.dispatch.in.one.run</pre></li>
	<li>Set the value to <strong>1000</strong>.</li>
	<li>Save changes.</li>
</ol>
<p><a href="#top">Back to top</a></p>



<h2 id="s02_08">Miscellaneous Items</h2>
<p>This section includes:</p>
<ul>
	<li><a href="#s02_08_01">HTTPS Listener Not Listening</a></li>
	<li><a href="#s02_08_02">Out of memory errors on the error log</a></li>
	<li><a href="#s02_08_03">Containers Not Starting After Update</a></li>
	<li><a href="#s02_08_04">Cannot Log In to Policy Manager Console using LDAP</a></li>
	<li><a href="#s02_08_05">Checking the JRE version</a></li>
</ul>


<h3 id="s02_08_01">HTTPS Listener Not Listening</h3>
<p>If the HTTPS listener is not listening on the Policy Manager container, it might be because the HTTP listener is not configured with applicable security.</p>
<p>All HTTPS listeners must be configured with PKI keys and X.509 certificate. If they are not, they will not work.</p>
<h4>Solution:</h4>
<p>Verify that the HTTPS listener is correctly configured, using the instructions below. If needed, take further troubleshooting steps as explained in the second procedure below.</p>

<h4 id="proc_verify_https_listener_config">To verify that an HTTPS listener is configured with PKI keys and X.509 certificate</h4>
<ol>
	<li>Log in to the Policy Manager console.</li>
	<li>Under the organization tree on the left, select the container for the HTTPS listener.</li>
	<li>In the right pane, click the Details tab.</li>
	<li>Under Inbound Listeners, on the Actions drop-down list, choose Modify Container Listener.</li>
	<li>Under PKI Key Details and Certificate Details you should see the base64 encoded public key and the details of the X.509 certificate. If they are not present, generate PKI keys and X.509 certificate and add them.</li>
</ol>

<h4>To troubleshoot issues with the listener not working</h4>
<ol>
	<li>On the machine on which the container is hosted, verify that the container is listening on the configured port and there are no other processes configured to listen on the container port. Shut down the container and verify that there is no process running that is listening on the same port as the configured container. For example, you could use a tool such as netstat.</li>
	<li>Verify that the listener's container is started.</li>
	<li>Check the logs of the container.</li>
</ol>


<h3 id="s02_08_02">Out of memory errors on the error log</h3>
<p>Out of memory errors in the log file for the container indicate that the container does not have enough memory reserved.</p>
<h4>Solution:</h4>
<p>If you find that you need more memory than the default of 1GB, you will need to convert to 64- bit JRE before increasing the memory. For instructions, see below.</p>
<p class="apidoc_note"><strong>Note</strong>: Before you convert, check with Support to see which JRE update is supported with Policy Manager (see <a href="ts_pm_nd_01.htm#s01_02">Customer Support</a>). As of September 2013, JRE 6.0 Update 36 is supported. The latest update is update 43, which isn't yet supported. We are constantly certifying new versions. For Policy Manager 6.1.15 we added support for JRE 7.0. Again, check which update is supported.</p>

<h4 id="proc_convert_to_64bitjre">To convert to 64-bit JRE</h4>
<p>If Policy Manager and Network Director are installed as a Windows service, uninstall them before following the procedure below. Use the uninstall batch file: \sm60\bin\UnRegisterContainerService.bat.</p>
<ol>
	<li>Download the JRE 1.6 64-bit version from the Oracle website. Use one of the following:
		<ul>
			<li><strong>For Linux</strong>: Linux-64bit-jre-1.6.0_37</li>
			<li><strong>For Windows</strong>: Windows-64bit-1.6.0_32</li>
			</ul>
		</li>
	<li>Install the JRE into a separate directory on the Policy Manager or Network Director machine. It can be in any location.</li>
	<li>Copy the <strong>bcprov-jdk15-141.jar</strong> file from the original PM ./sm60/jre/lib/ext directory to the Java 6 ./jre/lib/ext directory.</li>
	<li>Edit the {Java6_install_location}/jre/lib/security/java.security file to add the following security provider:
	<pre>security.provider.9=org.bouncycastle.jce.provider.BouncyCastleProvider</pre></li>
	<li>Rename the current ./sm60/jre directory to ./sm60/jre_15.</li>
	<li>Copy the {Java6_install_location}/jre directory into the Policy Manager or Network Director <strong>./sm60</strong> directory tree (<strong>./sm60/jre</strong>).</li>
	<li>Edit the /sm60/bin/startup.sh or startup.bat file to make the change shown below:
		<ul>
			<li><strong>From</strong>: JAVA_OPTS="-Xmx1024M -XX:MaxPermSize=128M"</li>
			<li><strong>To</strong>: JAVA_OPTS="-Xmx2048M -XX:MaxPermSize=256M"</li>
			</ul>
		</li>
	
	<li>On Windows, edit the /sm60/bin/RegisterContainerService.bat file to make the change shown below:
		<ul>
			<li><strong>From</strong>: JAVA_OPTS=-Xmx1024M -XX:MaxPermSize=128M</li>
			<li><strong>To</strong>: JAVA_OPTS=-Xmx2048M -XX:MaxPermSize=256M</li>
			</ul>
		</li>
	<li>In the \sm60\bin folder, rename <strong>JavaService.exe</strong> to <strong>JavaService32.exe</strong>.</li>
	<li>Copy <strong>JavaService64.exe</strong> (you can request it from Akana Technical Support) to \sm60\bin and rename it to <strong>JavaService.exe</strong>.</li>
	<li>Edit the <strong>\sm60\bin\RegisterContainerService.bat</strong> file to make the change shown below:
<ul>
			<li><strong>From</strong>: SET JAVA_DLL="%JAVA_HOME%\bin\client\jvm.dll"</li>
			<li><strong>To</strong>: SET JAVA_DLL="%JAVA_HOME%\bin\server\jvm.dll"</li>
		</ul>
		</li>
</ol>
<p class="apidoc_note"><strong>Note</strong>: We recommend that you use 2GB of memory when using 64-bit JRE. If you have a large deployment with many concurrent requests and many hosted services in the Network Director, you might need a larger heap size.</p>


<h3 id="s02_08_03">Containers Not Starting After Update</h3>
<p>A likely cause for this issue is that the configurator cache was not cleared before the update.</p>

<h4>Solution:</h4>
<p>It's important that the configurator's cache folder is cleared before updating Policy Manager. If the container doesn't start after an update, and you determine that the update was started without first clearing the configurator cache, contact Akana Technical Support for assistance (see <a href="ts_pm_nd_01.htm#s01_02">Customer Support</a>).</p>


<h3 id="s02_08_04">Cannot Log In to Policy Manager Console using LDAP</h3>
<p>If you're experiencing trouble logging in, you will first need to determine whether you have connectivity with the LDAP server. If you do, there might be such a high volume of calls that it isn't readily available. If this is the case they you will need to define a failover server.</p>
<h4>Solution:</h4>
<p>To check connectivity, first try logging in on the local domain. To do this, switch your domain to localdomain and then log in using the localdomain Admin ID.</p>
<p>If needed, define one or more failover LDAP servers. Follow the steps below.</p>

<h4 id="proc_define_fallover_ldap">To define a failover LDAP server</h4>
<ol>
	<li>Log in to the Policy Manager console.</li>
	<li>Click the <strong>Configure</strong> tab and then click <strong>Security</strong>.</li>
	<li>Click <strong>Identity Systems</strong>, and then click <strong>Modify Identity System</strong>.</li>
	<li>Add failover URLs and save changes.</li>
</ol>


<h3 id="s02_08_05">Checking the JRE version</h3>
<p>If you have an existing installation and you're not sure which JRE version the platform is using, you can check it in the Akana Administration Console.</p>
<p>Akana Administration Console &gt; <strong>System</strong> tab &gt; <strong>System Properties</strong> section. An example is shown below. All the <strong>java.*</strong> properties give information about Java installation and usage.</p>
<p>Scroll down to the <strong>java.home</strong> property.</p>
<p><img src="assets/java_path.jpg" alt="Finding the JRE version in the Akana Administration Console" /></p>
<p><a href="#top">Back to top</a></p>



<hr class="divide_hr" />



<h2 id="related_topics">Related Topics</h2>
<div class="relatedlinks" id="troubleshooting">
<ul>
	<li><a href="ts_pm_nd_01.htm">Troubleshooting: Introduction</a></li>
	<li><a href="ts_pm_nd_02.htm">Troubleshooting Policy Manager</a></li>
	<li><a href="ts_pm_nd_03.htm">Troubleshooting Network Director</a></li>
	<li><a href="ts_pm_nd_04.htm">Troubleshooting Reference: Database Queries</a></li>
</ul>
<ul>
	<li><a href="ts_pm_dp.htm">Troubleshooting Policy Manager for DataPower</a></li>
</ul>
</div>
