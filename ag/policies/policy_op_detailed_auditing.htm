---
layout: page
title: Using the Detailed Auditing Policy
description: Learn how to audit messages and record the message metrics in the Monitoring Logs tab as well as messages of each exchange.
product: ag
category: learn
sub-nav-class: Policies - Operational
weight: 04
type: page
nav-title: Detailed Auditing
---
<h2 id="top">Using the Detailed Auditing Policy</h2>
<p>Learn how to enable detailed auditing of message size, bindings, and contracts.</p>

<p>
	<a href="about_policies_view.htm" class="button secondary">About Policies</a>  
	<a href="policy_management.htm" class="button secondary">Managing Policies</a>  
	<a href="policies_operational_about.htm" class="button secondary">About Operational Policies</a>
</p>
<p>For information about using policies in the context of the developer portal, see <a href="../../cm/learnmore/bus_admin_organizations.htm#h_business_policies">Business Policies</a>.</p>



<div class = "divider1"></div>
<h3 style="color: gray;">Table of Contents</h3>
<ol class="table_of_contents">
	<li><a href="#introduction">Introduction</a></li>
	<li><a href="#detailed_auditing_config">Configuring the Detailed Auditing Policy</a></li>
	<li><a href="#detailed_auditing_options">Detailed Auditing Policy options</a></li>
	<li><a href="#policy_attach">Attaching the Policy</a></li>
	<li><a href="#uc_policy_op_detailed_auditing_pm">Detailed Auditing Policy: use case for Policy Manager</a></li>
</ol>
<div class = "divider1"></div>



<h3 id="introduction">Introduction</h3>
<p>The Detailed Auditing Policy is an out-of-the-box policy that is part of the Policy Manager default installation. It is an instance of the Auditing Service Policy. It provides detailed auditing of messages and records the message metrics in the <strong>Monitoring</strong><em> &gt; </em><strong>Logs</strong> tab as well as the messages of each exchange. The policy is located in the <strong>Policies</strong> folder of the root organization.</p>
<p><strong>Note</strong>: Only attach one auditing policy to a service or API; for example, <a href="policy_op_basic_auditing.htm">Basic Auditing</a> policy or <a href="policy_op_detailed_auditing.htm">Detailed Auditing</a> policy. Do not attach multiple auditing policies to a single API.</p>
<p>The following message metrics are recorded:</p>
<ul>
	<li><strong>Input Message</strong>: Audits Input Message content.</li>
	<li><strong>Output Message</strong>: Audits Output Message content.</li>
	<li><strong>Fault Message</strong>: Audits Fault Message content.</li>
	<li><strong>Message Size</strong>: Audits the size of messages in the exchange.</li>
	<li><strong>Binding</strong>: Audits binding information.</li>
	<li><strong>Transport</strong>: Audits 	 Transport information.</li>
	<li><strong>Contract</strong>: Audits the contract governing a message.</li>
</ul>
<p>The following identities are audited:</p>
<ul>
	<li><strong>Consumer</strong>: Audits consumer identity sent with a request message.</li>
	<li><strong>End User</strong>: Audits end-user identity sent with a request message.</li>
</ul>
<p><a href="#top">back to top</a></p>



<h3 id="detailed_auditing_config">Configuring the Detailed Auditing Policy</h3>
<p>The Detailed Auditing Policy is an instance of the <a href="policy_op_auditing_service.htm">Auditing Service policy</a>.</p>
<p>For configuration instructions, see <a href="policy_op_auditing_service.htm#auditing_service_policy_config">Configuring an Auditing Service Policy</a>.</p>
<p>Once you've defined the basic policy information, you can configure the technical details that determine how the policy works when it's attached to a service.</p>

<h5 id="proc_detailed_auditing">To configure a Detailed Auditing Policy</h5>
<ol>
	<li>Go to <strong>Workbench</strong> &gt; <strong>Browse</strong> &gt; <strong>Organization</strong>, and select <strong>Policies</strong> &gt; <strong>Operational Policies</strong>. The <strong>Policies Summary</strong> is displayed.</li>
	<li>In the <strong>Audit Messages</strong> section, choose which messages to audit and the audit options. For details on field values, see <a href="#detailed_auditing_options">Detailed Auditing Policy options</a> below.</li>
	<li>In the <strong>Audit Binding</strong> section, choose whether or not to audit transport headers and, if applicable, specify headers to exclude from auditing.</li>
	<li>In the <strong>Audit Identities</strong> section, choose one or more options: Consumer, End-User, or Additional Subject Categories (specify subject categories).</li>
	<li>In the <strong>Reporting Options</strong> section, choose <strong>Log</strong>, <strong>Alert</strong>, or both.</li>
	<li>Click <strong>Apply</strong>.</li>
	<li>At the <strong>Completion Summary</strong> page, click <strong>Close</strong>.</li>
</ol>
<p>After you've configured your policy, you can attach it to a web service, operation, or binding.</p>
<p><a href="#top">back to top</a></p>



<h3 id="detailed_auditing_options">Detailed Auditing Policy options</h3>
<p>On the Auditing Service Policy Options page, you can specify:</p>
<ul>
	<li><a href="#detailed_aud_audit_messages">Audit Messages</a>: Which messages the policy is applied to.</li>
	<li><a href="#detailed_aud_audit_bindings">Audit Binding</a>: Which bindings the policy is applied to.</li>
	<li><a href="#detailed_aud_audit_ids">Audit Identities</a>: Which identities the policy is applied to.</li>
	<li><a href="#detailed_aud_reporting_options">Reporting Options</a>: How policy exceptions are reported.</li>
</ul>
<p>Refer to the field descriptions below.</p>


<h4 id="detailed_aud_audit_messages">Audit Messages</h4>
<p>Use this section to identify which messages should be audited.</p>
<dl>
<dt>Audit Messages</dt>
<dd>Ifentifies which messages should be audited. The Audit Messages section includes two main options:
	<ul>
<li><strong>Audit All Messages</strong>: Enables the auditing of all messages.</li>
<li><strong>Filter Messages</strong>: Filter settings determine which messages are audited. Options:
	<p><strong>Exchanges resulting in an error</strong>: Audits only messages with errors.</p>
<p><strong>Percentage of exchanges</strong>: Audits a random sample of messages based on a specified percentage. If you choose this option, specify an integer percentage from 1 to 99.</p>
<p><strong>Filter by message content</strong>: specify message content that will trigger auditing. You can define trigger content in one or more of these formats: Regular Expression, JSONPath, or XPath. The XPath option includes a table where you can define <strong>Prefix</strong> and <strong>Namespace</strong> for each XPath expression. Click <strong>Add</strong> or <strong>Delete</strong> to modify the list. You can also sort the list by clicking the table header.</p>
<p>For more information about using regular expressions, see <a href="policy_management.htm#policies_regex">Using Regular Expressions in Policies</a>.</p>
</li>
</ul></dd>


<dt>Audit Messages: additional options</dt>
<dd>The Audit Messages section includes the following additional checkboxes:
<ul>
<li><strong>Audit Input Message</strong>: Enables the auditing of input messages.</li>
<li><strong>Audit Output Message</strong>: Enables the auditing of input messages.</li>
<li><strong>Audit Fault Message</strong>: Enables the auditing of fault messages.</li>
<li><strong>Audit Contract</strong>: Enables the auditing of a contract governing a message.</li>
<li><strong>Audit Message Size</strong>: Enables the auditing of the size of messages in the exchange.</li>
</ul></dd>
</dl>


<h4 id="detailed_aud_audit_bindings">Audit Binding</h4>
<h5 class="stamp">API Platform Version: 2018.0.0 and later</h5>
<p>Use this section to identify that the message binding should be audited. By default, if you check Audit Binding, the policy settings apply to the entire message binding. If you check Audit Transport, you can specify one or more transport headers to exclude.</p>
<p>For example, you could use this option to filter out HTTP Transport headers so that user authentication credentials are not recorded in the logs.</p>
<p>The <strong>Transport Header</strong> table stores a list of transport headers to be audited. Click <strong>Add</strong> or <strong>Delete</strong> to modify the list. You can also sort the list by clicking the table header.</p>


<h4 id="detailed_aud_audit_ids">Audit Identities</h4>
<p>Checking this box enables the auditing of specified identities included in a request message. Options:</p>
<dl>
<dt>Consumer</dt>
<dd>Audits the consumer identity sent with a request message.</dd>


<dt>End-User</dt>
<dd>Audits the end-user identity sent with a request message.</dd>

<dt>Additional Subject Categories</dt>
<dd>Audits the identity associated with one or more specified Subject Categories sent with a request message. If you choose this option, you can create one or more user-defined subject categories that you want to use. You can also add or delete from the table.</dd>
</dl>


<h4 id="detailed_aud_reporting_options">Reporting Options</h4>
<p>The following reporting options are available:</p>
<dl>
<dt>Log</dt>
<dd>Indicates that audit information should be logged.</dd>


<dt>Alert</dt>
<dd>Indicates that audit information should be delivered in an alert event.</dd>
</dl>
<p><a href="#top">Back to top</a></p>



<h3 id="policy_attach">Attaching the Policy</h3>
<p>To use the Detailed Auditing Policy, go to the <strong>Policies</strong> folder in the Root Organization and attach the policy to a web service, binding, or binding operation. Then, go to the <strong>Services</strong><em> &gt; </em><strong>Monitoring</strong> section to view the results for Logs, Real Time Charts, and Historical Charts.</p>
<p><a href="#top">Back to top</a></p>



<h3 id="uc_policy_op_detailed_auditing_pm">Detailed Auditing Policy: use case for Policy Manager</h3>
<p>This section includes the following usage scenario for the Detailed Auditing Policy:</p>
<ul>
	<li><a href="#uc_policy_op_detailed_auditing_pm_01">Audit Entire Message and Message Metrics</a></li>
</ul>


<h4 id="uc_policy_op_detailed_auditing_pm_01">Audit Entire Message and Message Metrics</h4>
<p>Audit entire message and message metrics of each exchange in usage logs of Monitoring tab.</p>
<ol>
	<li>Create a physical service in the <strong>Policy Manager Management Console</strong> using <strong>Create Physical Service</strong>.</li>
	<li>Provide service details and finish the wizard.</li>
	<li>Using <strong>Virtualize Service</strong>, virtualize and host the physical service on Network Director (<strong>ND1</strong>), and assign a name (for example, <strong>Vs1</strong>).</li>
	<li>Attach the Detailed Auditing Policy located in the Root Organization Policies folder to the Vs1 service in <strong>Service Details</strong> &gt; <strong>Policy Attachments</strong> &gt; <strong>Operational Policies</strong>.</li>
	<li>Send requests from the application/client to the Vs1 service.</li>
	<li>The details of the usage logs show the recorded information for each exchange.
	<p><img src="images/detailed_auditing_uc_pm_01.jpg" alt="Detailed Auditing policy use case: log details" /></p>
	<p>The fields that are recorded in each exchange are:</p>
		<ol>
			<li>Message Size</li>
			<li>Input Message</li>
			<li>Output Message</li>
			<li>Fault Message</li>
			<li>Transport</li>
			<li>Contract</li>
			<li>Binding</li>
			<li>Identities: Consumer/End-User</li>
		</ol>
		<p><img src="images/detailed_auditing_uc_pm_02.jpg" alt="Detailed Auditing policy use case: Usage Detail tab" /></p>
		<p><img src="images/detailed_auditing_uc_pm_03.jpg" alt="Detailed Auditing policy use case: Recorded Messages tab" /></p></li>
</ol>
<p><a href="#top">Back to top</a></p>



<div class = "divider1"></div>



<h3 id="related_topics">Related Topics</h3>
<div class="relatedlinks">
<ul>
	<li><a href="about_policies_view.htm">About Policies</a></li>
	<li><a href="policy_management.htm">Managing Policies</a></li>
	<li><a href="policies_operational_about.htm">About Operational Policies</a></li>
</ul>
<ul>
	<li><a href="../../cm/learnmore/basics_glossary.htm">Glossary of Terms for the Developer Portal</a></li>
</ul>
</div>