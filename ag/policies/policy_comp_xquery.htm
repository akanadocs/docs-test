---
layout: page
title: Using the Compliance XQuery Policy
description: Learn about using the Compliance XQuery Policy to execute an XQuery statement on a service or message model to determine compliance.
product: ag
category: learn
sub-nav-class: Policies - Compliance
weight: 04
type: page
nav-title: XQuery
---
<h1 id="top">Using the Compliance XQuery Policy</h1>
<p>Learn about using the Compliance XQuery Policy to execute an XQuery statement on a service or message model to determine compliance.</p>

<p>For information about using policies in the context of the developer portal, see <a href="../../cm/learnmore/bus_admin_organizations.htm#h_business_policies">Business Policies</a>.</p>
<hr class="divide_hr" />



<h2 style="color: gray;">Table of Contents</h2>
<ol class="table_of_contents">
	<li><a href="#comp_xquery_policy_about">About the Compliance XQuery policy</a></li>
	<li><a href="#comp_xquery_policy_create">Creating a Compliance XQuery policy</a></li>
	<li><a href="#comp_xquery_policy_modify">Configuring a Compliance XQuery policy</a></li>
	<li><a href="#comp_xquery_policy_options">Compliance XQuery policy options</a></li>
	<li><a href="#policy_xquery_schema_wsdl">Populating an XQuery policy with schema or WSDL data</a></li>
	<li><a href="#policy_xquery_service">Populating an XQuery policy with service data</a></li>
	<li><a href="#policy_xquery_exchange">Populating an XQuery policy with exchange (message) data</a></li>
	<li><a href="#policy_activating">Activating a policy</a></li>
	<li><a href="#policy_attach">Attaching a policy</a></li>
</ol>
<hr class="divide_hr" />



<h2 id="comp_xquery_policy_about">About the Compliance XQuery policy</h2>
<p>XQuery is a query language that queries and transforms collections of structured and unstructured data, usually XML. XPath is a subset of XQuery.</p>
<p>The Compliance XQuery policy executes an XQuery statement on the service or message model to determine compliance. </p>
<p><a href="#top">Back to top</a></p>



<h2 id="comp_xquery_policy_create">Creating a Compliance XQuery policy</h2>
<p>The first step in creating a policy is to define the basic policy information.</p>
<h4>To add a compliance policy</h4>
<ol>
	<li>Go to <strong>Workbench</strong> &gt; <strong>Browse</strong> &gt; <strong>Organization</strong>, and select <strong>Policies</strong> &gt; <strong>Compliance Policies</strong>. The <strong>Policies Summary</strong> is displayed.</li>
	<li>Click <strong>Add Policy</strong>.</li>
	<li>Choose the policy type and click <strong>Next</strong>.</li>
	<li>Specify a name (required) and description (optional) and click <strong>Finish</strong>. At the <strong>Completion Summary</strong>, click <strong>Close</strong>. The <strong>Add Policy</strong> Wizard creates a draft policy instance that you can then configure on the <strong>Policy Details</strong> page.</li>
</ol>
<p>For more information, see <a href="policy_management.htm#add_policy">Add Policy</a>.</p>
<p><a href="#top">Back to top</a></p>



<h2 id="comp_xquery_policy_modify">Configuring a Compliance XQuery policy</h2>
<p>Once you've created the policy, you can configure the policy options.</p>

<h4 id="proc_policy_comp_xquery">To configure a Compliance XQuery policy</h4>
<ol>
	<li>Go to <strong>Workbench</strong> &gt; <strong>Browse</strong> &gt; <strong>Organization</strong> and select the <strong>Policies</strong> &gt; <strong>Compliance Policies</strong> folder. The <strong>Policies Summary</strong> is displayed.</li>
	<li>Find the policy on the list and click to go to the pane for the Compliance XQuery policy.</li>
	<li>In the second section, click <strong>Modify</strong>. The <strong>Modify Compliance XQuery Policy</strong> page opens, as shown below.
		<p><img src="images/xquery_01.jpg" alt="The XQuery compliance policy page"/></p>
		</li>
	<li>Choose an asset type. For information on the individual options, see <a href="#comp_xquery_policy_options">Compliance XQuery Policy Options</a> below.</li>
	<li>Follow the steps for the specific asset type, to populate the Query Builder:
		<ul>
			<li><strong>Schema</strong>: <a href="#policy_xquery_schema_wsdl">Populating an XQuery policy with schema or WSDL data</a></li>
			<li><strong>Service</strong>: <a href="#policy_xquery_service">Populating an XQuery policy with service data</a></li>
			<li><strong>Exchange</strong>: <a href="#policy_xquery_exchange">Populating an XQuery policy with exchange (message) data</a></li>
			<li><strong>WSDL</strong>: <a href="#policy_xquery_schema_wsdl">Populating an XQuery policy with schema or WSDL data</a></li>
		</ul>
		</li>
	
	<li>When the Query Builder pane is populated, choose elements that you want to include in your Compliance XQuery policy. Use the arrow buttons to copy elements to the <strong>Namespace Declarations</strong> and/or <strong>XQuery</strong> fields.</li>
	<li>Click <strong>Evaluate</strong> to test the information, and debug as needed.</li>
	<li>When done, click <strong>Finish</strong>. The policy definition is saved.</li>
</ol>
<p>That completes the policy configuration. You can now assign the policy to a service.</p>
<p><a href="#top">Back to top</a></p>



<h2 id="comp_xquery_policy_options">Compliance XQuery policy options</h2>
<p>The <strong>Modify Compliance XQuery Policy</strong> wizard includes the options listed below.</p>
<dl>
	<dt>Asset Type</dt>
<dd>Choose from the list of supported asset types that can be evaluated by the current rule definition including exchange:</dd>
</dl>
<ul>
	<li><strong>schema</strong>
<p>For instructions, see <a href="#policy_xquery_schema_wsdl">Populating an XQuery policy with schema or WSDL data</a>.</p></li>
	<li><strong>service</strong>
<p>For instructions, see <a href="#policy_xquery_service">Populating an XQuery policy with service data</a>.</p></li>
	<li><strong>exchange</strong> (that is, message)
<p>For instructions, see <a href="#policy_xquery_exchange">Populating an XQuery policy with exchange (message) data</a>.</p></li>
	<li><strong>wsdl</strong>
<p>For instructions, see <a href="#policy_xquery_schema_wsdl">Populating an XQuery policy with schema or WSDL data</a>.</p></li>
</ul>
<dl>
	<dt>Tree Hierarchy</dt>
	<dd>The tree hierarchy stores the asset information that you specify for the current policy definition. You can populate it with any one of the four asset types (message, schema, service, or WSDL). When you choose the asset type, define the source, and click <strong>Load Context</strong>, the tree hierarchy is populated with the content.</dd>
	<dd>After the tree hierarchy is populated, you can select Namespace Declarations and XQuery expressions and transfer them to the target text boxes (Namespace Declarations and XQuery) by clicking the arrow buttons.</dd>
	
	
	<dt>Load Context</dt>
	<dd>Once you've specified the asset type, click the <strong>Load Context</strong> button to populate the tree hierarchy of the Query Builder with data to use in defining your Compliance XQuery policy. The applicable screen is displayed, depending on the asset type:
		<ul>
		<li><strong>Exchange</strong>&#8212;Displays the <strong>Select Usage Log</strong> screen which allows you to search for a usage log to upload into the tree hierarchy of the Query Builder. See <a href="#policy_xquery_exchange">Populating an XQuery policy with exchange (message) data</a>.</li>
		<li><strong>Schema</strong>&#8212;Displays the <strong>Upload File</strong> screen which allows you to upload a schema into the tree hierarchy of the Query Builder. See <a href="#policy_xquery_schema_wsdl">Populating an XQuery policy with schema or WSDL data</a>.</li>
		<li><strong>Service</strong>&#8212;Displays the <strong>Upload Service</strong> screen which allows you to navigate a tree hierarchy and select a service to be uploaded tree hierarchy of the Query Builder. See <a href="#policy_xquery_service">Populating an XQuery policy with service data</a>.</li>
		<li><strong>WSDL</strong>&#8212;Displays the <strong>Upload File</strong> screen which allows you to upload a WSDL into the tree hierarchy of the Query Builder. See <a href="#policy_xquery_schema_wsdl">Populating an XQuery policy with schema or WSDL data</a>.</li>
	</ul></dd>
	<dt>Namespace Declaration</dt>
	<dd>You must specify the namespace declaration for the XQuery statement. All namespace declarations are separated by a semi colon (;) and are of the form:
		<pre>declare namespace compCtx='http://www.akana.com/2007/Compliance-Context';</pre></dd>
	<dd>This provides namespace prefix resolution for the XQuery statement, effectively decoupling the XQuery statement from literal namespace prefixes.</dd>
	
	
	<dt>XQuery</dt>
	<dd>The <strong>XQuery</strong> text box must contain the <strong>comp</strong> context (compCtx:) for the selected asset.</dd>
	
	
	<dt>Evaluate</dt>
	<dd>Evaluates the XQuery statement against the current context, and displays the results in the associated text box. Note that the Query Builder implementation is for advanced users and requires a working knowledge of XPath/XQuery.</dd>
	<dd>The XQuery statement must evaluate as follows:</dd>
</dl>
<ol>
	<li>A Boolean result of <strong>true</strong> for a <strong>passed</strong> rule</li>
	<li>A Boolean result of <strong>false</strong> for a <strong>failed</strong> rule</li>
	<li>An integer value of 0 for a passed condition</li>
	<li>1 to denote a warning</li>
	<li>2 to denote an error</li>
</ol>
<dl>
	<dt>Warning Message</dt>
	<dd>Specify the warning message to be displayed if the XQuery statement evaluates to a warning (#4 above).</dd>
	
	
	<dt>Error Message</dt>
	<dd>Specify the error message to be displayed if the XQuery statement evaluates to an error (#5 above).</dd>
</dl>
<p><a href="#top">Back to top</a></p>



<h2 id="policy_xquery_schema_wsdl">Populating an XQuery policy with schema or WSDL data</h2>
<p>To populate a XQuery Policy with schema or WSDL data, you'll need to upload the applicable file. From the <strong>Asset Type</strong> list, select <strong>schema</strong> or <strong>wsdl</strong>, and then click <strong>Load Context</strong>. The <strong>Upload File</strong> page is displayed, as shown below.</p>
<p><img src="images/dial_upload_file.jpg" alt="Upload File page" /></p>
<p>Upload the asset file (schema or WSDL) to be used for testing the current compliance policy. Make sure you upload the correct file type, according to the asset type you specified.</p>
<p>The Query Builder tree is populated with the file you uploaded.</p>
<p><a href="#top">Back to top</a></p>



<h2 id="policy_xquery_service">Populating an XQuery policy with service data</h2>
<p>To populate a XQuery Policy with service data, choose an <strong>Asset Type</strong> of <strong>service</strong> and then click <strong>Load Context</strong>.</p>
<p> The <strong>Select Policy Asset</strong> page is displayed, as shown below.</p>
<p><img src="images/dial_select_policy_asset.jpg" alt="Select Policy Asset page" /></p>
<p>Here, you can upload an asset file (Service) to be used for testing the compliance policy.</p>
<p>Navigate the tree hierarchy, choose a service, and click <strong>Next</strong>. You are returned to the <strong>Modify Policy</strong> page, and the service information is displayed in the <strong>Query Builder</strong> tree, as shown below.</p>
<p><img src="images/xquery_02.jpg" alt="Query Builder, populated" /></p>
<p>You can now configure the policy further based on the service you selected, following the steps in <a href="#proc_policy_comp_xquery">To configure a Compliance XQuery policy</a> (Step 6 onwards).</p>
<p><a href="#top">Back to top</a></p>



<h2 id="policy_xquery_exchange">Populating an XQuery policy with exchange (message) data</h2>
<p>To populate the policy with message data, choose <strong>Exchange</strong> from the <strong>Asset Type</strong> list, and then click <strong>Load Context</strong>. The <strong>Select Usage Log</strong> screen is displayed.</p>
<p>On this page, you can filter usage data, as shown below.</p>
<p><img src="images/script_compliance_select_usage_log.jpg" alt="Select Usage Log page" /></p>
<p>Choose a service/operation combination and specify a time range filter. Configure the <strong>Observer Filte</strong>r and <strong>Time Range Filter</strong> and then click <strong>Refresh</strong>.</p>
<p>After completing the search, choose the usage logs you would like to use to populate the <strong>Query Builder</strong>, and then click <strong>Next</strong> to go to the <strong>Modify XQuery Policy</strong> page.</p>
<p>To view details for selected usage records, select a usage data report line item and click <strong>View Usage Record Details</strong>. The <strong>Usage Record Details</strong> screen displays with a list of usage data fields and associated SOAP messages.</p>

<h4 id="dg_usage_record_details">Usage Record Details page</h4>
<p>This page includes the following:</p>
<dl>
<dt>Usage Detail</dt>
<dd>The <strong>Usage Detail</strong> tab allows you to navigate the list of SOAP messages associated with the current usage record. To navigate to the next SOAP message, click <strong>Next</strong> or <strong>Previous</strong>.</dd>


<dt>Recorded Messages</dt>
<dd>The <strong>Recorded Message</strong> section displays SOAP messages associated with the usage record of the current service. To view the message details for the current SOAP message, just click the line item. To view message details in XML format, choose <strong>Raw Format</strong>. To save the selected SOAP message, click <strong>Save</strong>.</dd>


<dt>Transaction Events</dt>
<dd>The <strong>Transaction Events</strong> section displays a list of transactions associated with the selected service. Each line item includes the following:</dd>
</dl>
<ul>
	<li>Service</li>
	<li>Operation</li>
	<li>Elapsed Time</li>
	<li>Response Time</li>
	<li>Errors</li>
</ul>
<p>To view the usage detail for a transaction, just double-click the line item. An example is shown below. The example below combines the display of all three tabs.</p>
<p><img src="images/dial_usage_data_report.jpg" alt="Usage Data Report" /></p>
<p>To exit, click <strong>Close</strong>.</p>
<p><a href="#top">Back to top</a></p>



<h2 id="policy_activating">Activating a policy</h2>
<p>When you create and configure a policy, the policy is in <strong>Draft</strong> state. When the policy configuration is complete, activate the policy: click <strong>Activate Policy</strong> and then confirm. See <a href="policy_management.htm#policy_activate">Activate a Policy</a>.</p>
<p>A policy in Draft state is not available for general use. Once you activate the policy, it is in <strong>Active</strong> state and is available for use.</p>
<p><a href="#top">Back to top</a></p>



<h2 id="policy_attach">Attaching a policy</h2>
<p>To use the policy, go to the <strong>Policies</strong> folder in the respective organization and attach the policy to a web service, binding, or binding operation.</p>
<p><a href="#top">Back to top</a></p>



<hr class="divide_hr" />



<h2 id="related_topics">Related Topics</h2>
<div class="relatedlinks">
<ul>
	<li><a href="about_policies_view.htm">About Policies</a></li>
	<li><a href="policy_management.htm">Managing Policies</a></li>
	<li><a href="policies_compliance_about.htm">About Compliance Policies</a></li>
</ul>
<ul>
	<li><a href="../../cm/learnmore/basics_glossary.htm">Glossary of Terms for the Developer Portal</a></li>
</ul>
</div>