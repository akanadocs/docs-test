---
layout: page
title: Using the Operational Metrics Policy in Policy Manager 8.x
description: Learn how to collect numeric data relating to service request/response time and by contract, subject, and client region that can be visualized in charts using an Operational Metrics Policy.
product: ag
category: learn
sub-nav-class: Policies - Operational
weight: 04
type: page
nav-title: Operational Metrics
---
<h2 id="top">Using the Operational Metrics Policy</h2>
<p>Learn how to collect numeric data relating to service request/response time and by contract, subject, and client region that can be visualized in charts using an Operational Metrics Policy, including a use case.</p>
<p>This policy is used with the Envision product and is installed as part of the <em>Envision Console Extension Feature</em>.</p>

<p>
<a href="about_policies_view.htm" class="button secondary">About Policies</a>  
<a href="policy_management.htm" class="button secondary">Managing Policies</a>  
<a href="policies_operational_about.htm" class="button secondary">About Operational Policies</a>
</p>

<h5 class="stamp">Supported Platforms: 8.0 and later</h5>

<div class = "divider1"></div>



<h3 style="color: gray;">Table of Contents</h3>
<ol class="table_of_contents">
	<li><a href="#introduction">Introduction</a></li>
	<li><a href="#configuration">Configuration</a></li>
	<li><a href="#uc_policy_operational_metrics">Use case: Generating a Chart from Operational Metrics Obtained from Service Operational Data</a></li>
</ol>
<div class = "divider1"></div>



<h3 id="introduction">Introduction</h3>
<p>The Operational Metrics Policy allows you to specify what operational metrics should be gathered. It differs from an auditing policy in that metrics are only numeric values that can be charted; they contain no information about the content of the message.</p>
<p>Instead of collecting all metrics, data capture can be performed at a more granular level to serve specific reporting requirements. For example, you might want to monitor where the maximum API traffic is coming from based on a service, organization, operation, license, binding type, and so forth to determine the best location for your data center. With this policy you can configure the collection of a specific metric type <em>and</em> can also filter the data capture based on a specific dimension.</p>

<h4>Metrics</h4>
<p>You can enable the collection of <em>all</em> or <em>selected</em> metrics types. Options include:</p>
<ul>
	<li><strong>Collect All Metrics</strong>: Enables collection of all metrics types.</li>
	<li><strong>Collect Selected Metrics</strong>: Enables the collection of selected metrics types.</li>
</ul>
<p>Supported metrics types include:</p>
<ul>
	<li>Numbers of Requests</li>
	<li>Response Time</li>
	<li>Downstream Response Time</li>
	<li>Request Size</li>
	<li>Response Size</li>
</ul>
<h4>Dimensions</h4>
<p>You can enable the collection of <em>all</em> or <em>selected</em> dimensions. Options include:</p>
<ul>
	<li><strong>Support All</strong>: Enables collection of all dimension types.</li>
	<li><strong>Support Selected Dimensions</strong>: Enables the collection of selected dimension types.</li>
</ul>
<p>Supported dimension types include:</p>
<ul>
	<li><strong>Client Region</strong></li>
	<li><strong>Contract</strong></li>
	<li><strong>Authenticated Subject</strong>: This option allows you to state whether or not you want the authenticated subject (User) to be audited. You then select the category of user to audit. Predefined categories include Consumer, End-User, and User Defined. If you choose User Defined, you can specify a custom category name, as shown below.
  <p><img src="images/op_metrics_policy_modify.jpg" alt="" /></p></li>
</ul>
<p><a href="#top">back to top</a></p>



<h3 id="configuration">Configuration</h3>
<p>For a complete walk-through tutorial on adding and configuring an Operational Metrics Policy, generating audit and log data for a virtual service, and using this data in the <em>Envision Console</em> to generate a variety of different charts, refer to <a href="#uc_policy_operational_metrics">Use case: Generating a Chart from Operational Metrics Obtained from Service Operational Data</a> below.</p>
<p><a href="#top">back to top</a></p>



<h3 id="uc_policy_operational_metrics">Use case: Generating a Chart from Operational Metrics Obtained from Service Operational Data</h3>
<p>The following use case illustrates how to generate a chart from Operational Metrics obtained from Service Operational Data.</p>

<h4>Configuration</h4>
<ol>
	<li>Perform the <a href="../../ev/envision_install/installing_pm_env_integration.htm">Policy Manager / Envision Integration Installation</a>. At the end of this process you will have configured Envision, Policy Manager, and Network Director container instances. This process also includes using <strong>Add Container</strong> in the Policy Manager Management Console to register the Network Director container.</li>
	<li>Launch the Akana Administration Console for the Network Director container instance, and change the following configuration properties via the <strong>Configuration</strong> tab:
    <ol>
      <li><strong>com.soa.metrics</strong>: <strong>metrics.rollup.reporter.requireMetricsPolicy</strong> set to <strong>true</strong>.
  <p><img src="images/oper_metrics_usecase1a.jpg" alt="Changing the metrics rollup configuration" /></p></li>
      <li><strong>com.soa.monitor.usage</strong>: set values as shown below.
        <p><img src="images/oper_metrics_usecase1b.jpg" alt="Changeing the monitor usage configuration" /></p></li>
    </ol></li>
	<li>Restart the Network Director container instance.</li>
	<li>Launch the Policy Manager Management Console and create a physical service using the file at this URL: <a href="http://petstore.swagger.io/v2/swagger.json" target="_blank">http://petstore.swagger.io/v2/swagger.json</a>.</li>
	<li>Select <strong>Virtualize Service</strong>, and virtualize the physical service in the Network Director container. </li>
	<li>Go to <strong>Policies</strong> &gt; <strong>Operational</strong> and use <strong>Add Policy</strong> to create an Operational Metrics Policy and configure it based on the illustration below.
    <p><img src="images/oper_metrics_usecase1c.jpg" alt="Adding the Operational Metrics policy"/></p> 
  </li>
	<li>Attach a Detailed Auditing Policy (found in the root Policies folder) and an Operational Metrics Policy to the virtual service.</li>
	<li>Send requests to the virtual service.
    <p><img src="images/oper_metrics_usecase1d.jpg" alt="Send requests to the virtual service" /></p></li>
	<li>View the  usage logs for the service.
    <p><img src="images/oper_metrics_usecase1e.jpg" alt="Viewing the usage logs" /></p>
    <p><img src="images/oper_metrics_usecase1f.jpg" alt="Usage data details" /></p></li>
	<li>View the recorded logs in MongoDB in the AUDIT_LOG collection.
    <p><img src="images/oper_metrics_usecase1g.jpg" alt="Viewing the logs in MongoDB" /></p></li>
	<li>METRICDATASEC should be aggregating the logs per second. To see this, view the following collections: API Operational Metric Data Set, API Contract Metric Data Set, and API User Metric Data Set.
    <p><img src="images/oper_metrics_usecase1h.jpg" alt="Viewing the User Metric data set" /></p>
    <p><img src="images/oper_metrics_usecase1i.jpg" alt="Viewing the Operational Metric data set" /></p>
    <p><img src="images/oper_metrics_usecase1j.jpg" alt="Viewing the Contract Metric data set" /></p></li>
	<li>METRICDATAMIN should be aggregating the logs per minute on the basis of METRICDATASEC. To see this, view the following collections: API Operational Metric Data Set, API Contract Metric Data Set, and API User Metric Data Set.</li>
	<li>Send requests to various operations.
    <p><img src="images/oper_metrics_usecase1k.jpg" alt="Sending requests to generate data" /></p></li>
	<li>View the usage logs in MongoDB. The logs should contain the fields and information as per the Operational policy configuration made above
    <p><img src="images/oper_metrics_usecase1l.jpg" alt="Viewing the usage logs in MongoDB" /></p></li>
	<li>
    Launch the Envision Console and make a chart using the collections API Operational Metric Data Set, API Contract Metric Data Set, and API User Metric Data Set. The charts should show appropriate data:  
    
    <ul>
      <li>API Operational Metric Data Set
        <p><img src="images/oper_metrics_usecase1m.jpg" alt="Making a chart in Envision" /></p>
        <p><img src="images/oper_metrics_usecase1n.jpg" alt="Chart axis properties" /></p>
        <p><img src="images/oper_metrics_usecase1o.jpg" alt="Chart preview" /></p></li>
      </ul>
  </li>
	<li>In the same way, verify charts for the API Contract Metric Data Set and API User Metric Data Set.</li>
</ol>
<p><a href="#top">Back to top</a></p>
