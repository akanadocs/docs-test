---
layout: page
title: Using the Public and Private Operational Script Policy (PM8x)
description: Learn how to create your own custom policy and associate it with different components of a service's definition such as organizations, services, operations, bindings, and access points.
product: ag
category: learn
sub-nav-class: Operational Policies
weight:	5
type: page
nav-title: Using the Public and Private Operational Script Policies (8.x)
---
<h2 id="top">Using the Public and Private Operational Script Policies in Policy Manager 8.x </h2>
<p>Learn how to create your own custom public and private policies and associate each policy with different components of a service's definition such as organizations, services, operations, bindings, and access points.</p>

<p><a href="../scripts/getting_started_with_scripts_pm8x.htm" class="button secondary">Getting Started with Scripts (8.x)</a>
<a href="policy_management.htm" class="button secondary">Managing Policies</a>
<a href="../assets/scriptDocs_pm80/index.html" class="button secondary">Policy Manager Scripting API (8.x)</a></p>

<h5 class="stamp">Supported Platforms: 8.x</h5>

<div class = "divider1"></div>
<h3 style="color: gray;">Table of Contents</h3>
<ol class="table_of_contents">
  <li><a href="#introduction">Introduction</a></li>
  <li><a href="#config_options">Configuration Options</a></li>
  <li><a href="#configuration">Configuration</a></li>
</ol>
<div class = "divider1"></div>



<a name="introduction"></a><h3>Introduction</h3>
<p>The Operational Script Policy allows you create your own custom policy using custom utility scripts that you can associate with different components of a service's definition such as organizations, services, operations, bindings, and access points. Scripts can be defined using JavaScript, Jython, or BeanShell script languages.</p>
<p>The Policy Manager Scripting API located in the \docs\scriptDocs folder of the Policy Manager 8.x release folder provides a series of interfaces and classes you can use to build process-related scripts. The API includes lots of use cases and sample code you can experiment with and use as a baseline when building your own custom operational policy scripts. You can also access the API on the Akana Documentation Repository: <a href="../assets/scriptDocs_pm80/index.html" >Policy Manager Scripting API</a>.</p>

<h5>Private Operational Script Policy</h5>
<ul>
  <li>Policy Manager 7.1 and above includes the <em>Operational Script Policy</em>. </li>
  <li>This policy is considered <strong>Private</strong> and is not available to the Network Director when attached to a physical service. </li>
  <li>In Policy Manager 8.x, this policy has been renamed to the <em>Private Operational Script Policy</em>.</li>
</ul>
<h5>Public Operational Script Policy</h5>
<ul>
  <li>To support executing an <em>Operational Script Policy</em> as a <strong>Consumer</strong> when calling a physical service, Policy Manager 8.x includes the <em>Public Operational Script Policy</em>.</li>
</ul>
<p><a href="#top">back to top</a></p>



<a name="config_options"></a><h3>Configuration Options</h3>
<p>The policies include the following configuration options:</p>
<ul>
  <li><strong>Imports</strong>&#8212;This section includes common functions that you may need to perform in your scripts that have been saved in Script objects using the Add Script function in the Scripts section of each Organization in the Policy Manager Workbench. The available scripts are listed in the Available Scripts tree. Any number of Scripts in that tree can be moved to the Imported Scripts list box. Only scripts that match the language type will be available for selection in the tree. </li>
  <li><strong>Script Language</strong>&#8212;A drop-down list box that allows you to select the script language for the script to be added. JavaScript, Jython, and BeanShell Engine script language types are supported.</li>
  <li><strong>Expression </strong>&#8212;A text box that allows you to enter your script.</li>
</ul>
<p><a href="#top">back to top</a></p>



<a name="configuration"></a><h3>Configuration</h3>
<p>Let's take a quick walkthrough of the configuration process for each policy to get you started.</p>
<h4>Review Script Creation Process</h4>
<p>The first step is to review <a href="../scripts/getting_started_with_scripts_pm8x.htm">Getting Started with Scripts (PM8x)</a> to become familiar with the script creation process, available tools, and the <a href="../assets/scriptDocs_pm80/index.html" >Policy Manager Scripting API (PM8x)</a>.</p>
<p><a href="#top">back to top</a></p>



<a name="config_private_op_script_pol"></a><h4>Configure Private Operational Script Policy</h4>
<p>To configure a private operational script policy, follow these steps:</p>
<ol>
  <li><a href="#step1_private">Step 1: Add Policy</a></li>
  <li><a href="#step2_private">Step 2: Modify Policy</a></li>
  <li><a href="#step3_private">Step 3: Specify Function</a></li>
  <li><a href="#step4_private">Step 4: Attach Policy</a></li>
  <li><a href="#step5_private">Step 5: Test Policy</a></li>
</ol>

<a name="step1_private"></a><h5>Step 1: Add Policy</h5>
<p>In Policy Manager, you can create a Private Operational Script Policy instance using <strong>Add Policy</strong> in the <em>Policies &gt; Operational Policies</em> section. </p>

<a name="step2_private"></a><h5>Step 2: Modify Policy</h5>
<p>When you <strong>Modify</strong> the Private Operational Script Policy on the <em>Policy Details</em> page the initial policy will look like this:</p>
<p><img src="images/modify_private_op_script_policy_8x.jpg" alt="" width="552" height="392" /></p>
<p>To illustrate how to use the policy, we are going to add script code that gets the Service Details.</p>
<p>In the <em>Source</em> section, select <strong>JavaScript</strong> as the Script Language, add the following code to the Expression section, and then save the policy:</p>
<pre>exchange = messageContext.getExchange();
auditLog.debug("Service Name : " + exchange.getServiceName()+ "\n" + "Operation Name : " + exchange.getOperationName()+ "\n" +"Endpoint Name : " + exchange.getEndpointName());
</pre>
<p>The script editor will look similar to the following:</p>
<p><img src="images/modify_private_op_script_policy_8x_example.jpg" alt="" width="590" height="420" /></p>


<a name="step3_private"></a>
<h5>Step 3: Specify Function</h5>
<p>In the Function drop-down, as shown below, you can specify a function.</p>
<p><img src="images/op_script_function_menu_private.jpg" alt="Function menu (private operational policy" /></p>
<p>All policy handlers in the policy framework execute in an order dictated by the function they provide. In the Akana Administration Console there is an ordered list of policy functions that are followed. You can also create your own policy handlers and either use one of the functions listed or create a new function and add it into the list. You can also manage the order in which policies are executed. This allows more predictable ordering of the sequence in which different policies are executed or implemented. For example, Wire-Security policies are enforced before Transformation policies.</p>
<p>Operational Script policies are essentially custom policies that you can write using JavaScript instead of Java. When adding an operational script, you must let the platform know when to execute the script in relation to the other policy handlers in the framework. To do this, you can define a function that your script is performing. The platform executes this according to the function list of the policy framework.</p>
<p>There might be one or more policies that have a specific function. The functions are as follows:</p>
<ul>
  <li><strong>Pre-policy Auditing</strong>&#8212;Performs the function of auditing, or message logging, before any other policies can affect the message.</li>
  <li><strong>Denial of Service</strong>&#8212;Addresses any potential denial of service attacks.</li>
  <li><strong>Wire Security</strong>&#8212;Enforces security on the message, ensuring that the message was delivered securely; for example, verifying that a message was signed or encrypted.</li>
  <li><strong>Authentication</strong>&#8212;Authenticates any credentials sent in the message.</li>
  <li><strong>Authorization</strong>&#8212;Authorizes the authenticated user.</li>
  <li><strong>Threat</strong>&#8212;Addresses any message threats such as script injection, SQL injection, or viruses.</li>
  <li><strong>Transformation</strong>&#8212;Changes the content of the message.</li>
  <li><strong>Caching</strong>&#8212;Returns cached responses if possible.</li>
  <li><strong>Post-policy Auditing</strong>&#8212;Performs the function of auditing, or message logging, after all policies have been enforced.</li>
</ul>

<h5>Admin Console Settings for Policy Function</h5>
<p>In the Akana Administration Console, to manage the policy settings: <strong>Configuration</strong> &gt; <strong>com.soa.policy.framework</strong>:</p>
<ul>
  <li>Public Operational Script Policy:
    <ul>
      <li>Setting: policy.framework.settings.consumerHandlerFunctions</li>
      <li>Default values: pre-auditing, custom, transform, sec-ctx, message-sec, wire-sec, post-auditing</li>
    </ul>
  </li>
  <li>Private Operational Script Policy: 
    <ul>
      <li>Setting: policy.framework.settings.providerHandlerFunctions</li>
      <li>Default values: pre-auditing, dos, pre-flight, sec-ctx, wire-sec, message-sec, auth, auz, threat, transform, custom, caching, post-auditing</li>
    </ul>
  </li>
  </ul>


<a name="step4_private"></a><h5>Step 4: Attach Policy</h5>
<p>After you have saved your policy, activate it, and attach it to a web service operation.</p>
<p><img src="images/attach_private_op_script_policy_8x.jpg" alt="" width="646" height="177" /></p>


<a name="step5_private"></a><h5>Step 5: Test Policy</h5>
<p>To test the policy, send a request and select <em>Monitoring &gt; Logs &gt; View Usage Record Details &gt; Recorded Messages</em> to view the DEBUG statement that prints the service details.</p>
<p><img src="images/opt_private_script_debug_example.jpg" alt="" width="543" height="513" /></p>
<p><a href="#top">back to top</a></p>



<h4>Configure Public Operational Script Policy</h4>
<p>To configure a public operational script policy, follow these steps:</p>
<ol>
  <li><a href="#step1_public">Step 1: Add Policy</a></li>
  <li><a href="#step2_public">Step 2: Modify Policy</a></li>
  <li><a href="#step3_public">Step 3: Specify Function</a></li>
  <li><a href="#step4_public">Step 4: Attach Policy</a></li>
  <li><a href="#step5_public">Step 5: Test Policy</a></li>
</ol>


<a name="step1_public"></a><h5>Step 1: Add Policy</h5>
<p>In Policy Manager, you can create a Public Operational Script Policy instance using <strong>Add Policy</strong> in the <em>Policies &gt; Operational Policies</em> section. </p>


<a name="step2_public"></a><h5>Step 2: Modify Policy</h5>
<p>When you <strong>Modify</strong> the Public Operational Script Policy on the <em>Policy Details</em> page the initial policy will look like this:</p>
<p><img src="images/modify_public_op_script_policy_8x.jpg" alt="" width="559" height="393" /></p>
<p>To illustrate how to use the policy, we are going to add script code that will get public credentials. </p>
<p>In the <em>Source</em> section, select <strong>JavaScript</strong> as the Script Language, add the following code to the Expression section, and then save the policy:</p>
<pre>msg = messageContext.getMessage();
subject=msg.getSecuritySubjects().get(&quot;urn:org:federatedgovernance:security:subject-category:enduser&quot;);
creds = subject.getPublicCredentials();
var printString =&quot;&quot;;
for(var i=0; i&lt;creds.length; i++){
printString += creds[i] +&quot;\n&quot;
}
auditLog.debug(printString);</pre>
<p>The script editor will look similar to the following:</p>
<p><img src="images/modify_public_op_script_policy_8x_example.jpg" alt="" width="554" height="392" /></p>



<a name="step3_public"></a>
<h5>Step 3: Specify Function</h5>
<p>In the Function drop-down, as shown below, you can specify a function.</p>
<p><img src="images/op_script_function_menu_public.jpg" alt="Function menu (public operational policy" /></p>
<p>All policy handlers in the policy framework execute in an order dictated by the function they provide. In the Akana Administration Console there is an ordered list of policy functions that are followed. You can also create your own policy handlers and either use one of the functions listed or create a new function and add it into the list. You can also manage the order in which policies are executed. This allows more predictable ordering of the sequence in which different policies are executed or implemented. For example, Wire-Security policies are enforced before Transformation policies.</p>
<p>Operational Script policies are essentially custom policies that you can write using JavaScript instead of Java. When adding an operational script, you must let the platform know when to execute the script in relation to the other policy handlers in the framework. To do this, you can define a function that your script is performing. The platform executes this according to the function list of the policy framework.</p>
<p>There might be one or more policies that have a specific function. The functions are as follows:</p>
<ul>
  <li><strong>Pre-policy Auditing</strong>&#8212;Performs the function of auditing, or message logging, before any other policies can affect the message.</li>
  <li><strong>Denial of Service</strong>&#8212;Addresses any potential denial of service attacks.</li>
  <li><strong>Wire Security</strong>&#8212;Enforces security on the message, ensuring that the message was delivered securely; for example, verifying that a message was signed or encrypted.</li>
  <li><strong>Authentication</strong>&#8212;Authenticates any credentials sent in the message.</li>
  <li><strong>Authorization</strong>&#8212;Authorizes the authenticated user.</li>
  <li><strong>Threat</strong>&#8212;Addresses any message threats such as script injection, SQL injection, or viruses.</li>
  <li><strong>Transformation</strong>&#8212;Changes the content of the message.</li>
  <li><strong>Caching</strong>&#8212;Returns cached responses if possible.</li>
  <li><strong>Post-policy Auditing</strong>&#8212;Performs the function of auditing, or message logging, after all policies have been enforced.</li>
</ul>

<h5>Admin Console Settings for Policy Function</h5>
<p>In the Akana Administration Console, to manage the policy settings: <strong>Configuration</strong> &gt; <strong>com.soa.policy.framework</strong>:</p>
<ul>
  <li>Public Operational Script Policy:
    <ul>
      <li>Setting: policy.framework.settings.consumerHandlerFunctions</li>
      <li>Default values: pre-auditing, custom, transform, sec-ctx, message-sec, wire-sec, post-auditing</li>
    </ul>
  </li>
  <li>Private Operational Script Policy: 
    <ul>
      <li>Setting: policy.framework.settings.providerHandlerFunctions</li>
      <li>Default values: pre-auditing, dos, pre-flight, sec-ctx, wire-sec, message-sec, auth, auz, threat, transform, custom, caching, post-auditing</li>
    </ul>
  </li>
  </ul>


<a name="step4_public"></a><h5>Step 4: Attach Policy</h5>
<p>After you have saved your policy, activate it, and attach it to a web service operation. </p>
<p><img src="images/attach_public_op_script_policy_8x.jpg" alt="" width="648" height="174" /></p>


<a name="step5_public"></a><h5>Step 5: Test Policy</h5>
<p>To test the policy, send a request and select <em>Monitoring &gt; Logs &gt; View Usage Record Details &gt; Recorded Messages</em> to view the DEBUG statement that includes the public credentials.</p>
<p><img src="images/public_op_script_policy_8x_test.jpg" alt="" width="551" height="449" /></p>
<p><a href="#top">back to top</a></p>