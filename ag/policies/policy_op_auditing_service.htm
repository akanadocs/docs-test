---
layout: page
title: Using the Auditing Service Policy
description: Learn how to create and configure an Auditing Service policy.
product: ag
category: learn
sub-nav-class: Policies - Operational
weight: 04
type: page
nav-title: Auditing Service
---
<h1 id="top">Using the Auditing Service Policy</h1>
<p>Learn how to create and configure an Auditing Service policy.</p>
<p>For information about using policies in the context of the developer portal, see <a href="../../cm/learnmore/bus_admin_organizations.htm#h_business_policies">Business Policies</a>.</p>
<hr class="divide_hr" />



<h2 style="color: gray;">Table of Contents</h2>
<ol class="table_of_contents">
	<li><a href="#introduction">Introduction</a></li>
	<li><a href="#auditing_service_policy_create">Creating an Auditing Service Policy</a></li>
	<li><a href="#auditing_service_policy_config">Configuring an Auditing Service Policy</a></li>
	<li><a href="#auditing_service_policy_options">Auditing Service Policy Options</a></li>
	<li><a href="#policy_activating">Activating a policy</a></li>
	<li><a href="#policy_attach">Attaching a policy</a></li>
	<li><a href="#uc_policy_auditing_service">Auditing Service policy use cases</a></li>
</ol>
<hr class="divide_hr" />



<h2 id="introduction">Introduction</h2>
<p>The Auditing Service policy allows you to specify conditions under which messages will be audited.</p>
<p><strong>Note</strong>: In versions prior to 2019.0.0, the platform did not support attaching multiple auditing policies to a service or API; for example, <a href="policy_op_basic_auditing.htm">Basic Auditing</a> policy or <a href="policy_op_detailed_auditing.htm">Detailed Auditing</a> policy. In 2019.0.0 and later you can set up Basic Auditing for successful messages and Detailed Auditing for error conditions.</p>
<p><a href="#top">back to top</a></p>



<h2 id="auditing_service_policy_create">Creating an Auditing Service Policy</h2>
<p>The first step in creating a policy is to define the basic policy information.</p>
<h4>To add an operational policy</h4>
<ol>
<li>Go to <strong>Workbench</strong> &gt; <strong>Browse</strong> &gt; <strong>Organization</strong>, and select <strong>Policies</strong> &gt; <strong>Operational Policies</strong>. The <strong>Policies Summary</strong> is displayed.</li>
<li>Click <strong>Add Policy</strong>.</li>
<li>Choose the policy type and click <strong>Next</strong>.</li>
<li>Specify a name (required) and description (optional) and click <strong>Finish</strong>. At the <strong>Completion Summary</strong>, click <strong>Close</strong>. The <strong>Add Policy</strong> Wizard creates a draft policy instance that you can then configure on the <strong>Policy Details</strong> page.</li>
</ol>
<p>For more information, see <a href="policy_management.htm#add_policy">Add Policy</a>.</p>
<p>At this point, you've created the policy, but it doesn't do anything. The next step is to configure the policy details. See <a href="#auditing_service_policy_config">Configuring an Auditing Service Policy</a> below.</p>
<p><a href="#top">back to top</a></p>



<h2 id="auditing_service_policy_config">Configuring an Auditing Service Policy</h2>
<p>Once you've created the policy, you can configure the policy details that determine how the policy works. Then you can activate the policy so that it can be used.</p>
<h4>To configure an Auditing Service policy in Policy Manager</h4>
<ol>
	<li>In the Organization Tree, find the level where the policy was defined. Click to select.</li>
	<li>In the center pane, in the <strong>Auditing Service Policy</strong> section, click <strong>Modify</strong>. The <strong>Modify Auditing Service Policy</strong> overlay is displayed, as shown below.
		<p><img src="images/auditing_service_modify_2019.jpg" alt="Modify Auditing Service Policy" /></p></li>
	<li>Specify values for the messages you want to apply the policy to, the audit identities, and the reporting options. For details on field values, see <a href="#auditing_service_policy_options">Auditing Service Policy Options</a> below.</li>
	<li>Click <strong>Apply</strong>.</li>
</ol>
<p>Now that the policy is defined, you can activate it and start using it. On the right, under <strong>Actions</strong>, choose <strong>Activate Policy</strong>.</p>
<p><a href="#top">Back to top</a></p>



<h2 id="auditing_service_policy_options">Auditing Service Policy Options</h2>
<p>On the Auditing Service Policy Options page, you can specify:</p>
<ul>
	<li><a href="#detailed_aud_audit_messages">Audit Messages</a>: Which messages the policy is applied to.</li>
	<li><a href="#detailed_aud_audit_bindings">Audit Binding</a>: Which bindings the policy is applied to.</li>
	<li><a href="#detailed_aud_audit_ids">Audit Identities</a>: Which identities the policy is applied to.</li>
	<li><a href="#detailed_aud_reporting_options">Reporting Options</a>: How policy exceptions are reported.</li>
</ul>
<p>Refer to the field descriptions below.</p>
<h3 id="detailed_aud_audit_messages">Audit Messages</h3>
<p>Use this section to identify which messages should be audited. The Audit Messages section includes two main options: </p>
	<ul>
	<li><strong>Audit All Messages</strong>: Enables the auditing of all messages.</li>
	<li><strong>Filter Messages</strong>: Filter settings determine which messages are audited. Options:
		<p><strong>Exchanges resulting in an error</strong>: Audits only messages with errors.</p>
	<p><strong>Percentage of exchanges</strong>: Audits a random sample of messages based on a specified percentage. If you choose this option, specify an integer percentage from 1 to 99.</p>
	<p><strong>Filter by message content</strong>: Allows you to filter the messages to be audited by providing one or more regular expressions, JSONPath expressions, or XPath expressions. If message content matches the specified expressing, auditing is triggered.</p>
	<p><strong>Note</strong>: Initially, only the XPath option is available, since auditing is performed on the normalized message. If you choose to apply auditing at the binding level (see <a href="#detailed_aud_audit_bindings">Audit Binding</a> below), the additional options appear. </p>
	<p>The XPath option includes a table where you can define <strong>Prefix</strong> and <strong>Namespace</strong> for each XPath expression. Click <strong>Add</strong> or <strong>Delete</strong> to modify the list. You can also sort the list by clicking the table header. Allows you to filter the messages to be audited by An example is shown below.</p>
<!--<p><span class="apidoc_code">//*[matches(@id, 'sometext\d+_text')]</span></p>-->
<p><img src="images/auditing_service_filter_settings_regex.jpg" alt="Auditing Service policy: Filter settings" /></p>
<p>The XPath option includes a table where you can define <strong>Prefix</strong> and <strong>Namespace</strong> for each XPath expression. Click <strong>Add</strong> or <strong>Delete</strong> to modify the list. You can also sort the list by clicking the table header.</p>
<p>For more information, see <a href="policy_management.htm#policies_regex">Using Regular Expressions in Policies</a>, <a href="policy_management.htm#policies_jsonpath">Using JSONPath in Policies</a>, and <a href="policy_management.htm#policies_xpath">Using XPath in Policies</a>.</p>
	</li>
</ul>

<h4>Audit Messages: additional options</h4>
<p>The Audit Messages section includes the following additional checkboxes:</p>
<ul>
<li><strong>Audit Input Message</strong>: Enables the auditing of input messages.</li>
<li><strong>Audit Output Message</strong>: Enables the auditing of input messages.</li>
<li><strong>Audit Fault Message</strong>: Enables the auditing of fault messages.</li>
<li><strong>Audit Contract</strong>: Enables the auditing of a contract governing a message.</li>
<li><strong>Audit Message Size</strong>: Enables the auditing of the size of messages in the exchange.</li>
</ul>


<h3 id="detailed_aud_audit_bindings">Audit Binding</h3>
<h4 class="stamp">API Platform Version: 2018.0.0 and later</h4>
<p>Use this section to identify that the message binding should be audited. If you check <strong>Audit Binding</strong>, the policy settings apply to the entire message binding. If you check <strong>Audit Transport</strong>, you can specify one or more transport headers to exclude.</p>
<p>For example, you could use this option to exclude the authorization cookie so that it isn't recorded in the logs.</p>
<p><strong>Note</strong>: When the binding checkbox is selected, the Auditing Service policy is applied at the binding level. At that point, the content can be in any format, so it can be filtered in multiple ways. In this scenario, in the Audit Messages section, RegEx, XPath, and JSONPath are available options. If the policy is applied at the service level (Audit Binding option is cleared) then auditing is performed on the normalized exchange. Since normalized exchanges are always XML, in this scenario only XPath is available in the Audit Messages section.</p>
<p><img src="images/auditing_service_audit_binding.jpg" alt="Auditing Service policy: Audit Binding option" /></p>
<p>The <strong>Transport Header</strong> table stores a list of transport headers to be audited. Click <strong>Add</strong> or <strong>Delete</strong> to modify the list. You can also sort the list by clicking the table header.</p>


<h3 id="detailed_aud_audit_ids">Audit Identities</h3>
<p>Checking this box enables the auditing of specified identities included in a request message. Options:</p>
<dl>
<dt>Consumer</dt>
<dd>Audits the consumer identity sent with a request message.</dd>


<dt>End-User</dt>
<dd>Audits the end-user identity sent with a request message.</dd>

<dt>Additional Subject Categories</dt>
<dd>Audits the identity associated with one or more specified Subject Categories sent with a request message. If you choose this option, you can create one or more user-defined subject categories that you want to use. You can also add or delete from the table.</dd>
</dl>


<h3 id="detailed_aud_reporting_options">Reporting Options</h3>
<p>The following reporting options are available:</p>
<dl>
<dt>Log</dt>
<dd>Indicates that audit information should be logged.</dd>


<dt>Alert</dt>
<dd>Indicates that audit information should be delivered in an alert event.</dd>
</dl>
<p><a href="#top">back to top</a></p>



<h2 id="policy_activating">Activating a policy</h2>
<p>When you create and configure a policy, the policy is in <strong>Draft</strong> state. When the policy configuration is complete, activate the policy: click <strong>Activate Policy</strong> and then confirm. See <a href="policy_management.htm#policy_activate">Activate a Policy</a>.</p>
<p>A policy in Draft state is not available for general use. Once you activate the policy, it is in <strong>Active</strong> state and is available for use.</p>
<p><a href="#top">Back to top</a></p>



<h2 id="policy_attach">Attaching a policy</h2>
<p>To use the policy, go to the <strong>Policies</strong> folder in the respective organization and attach the policy to a web service, binding, or binding operation.</p>
<p><a href="#top">Back to top</a></p>



<h2 id="uc_policy_auditing_service">Auditing Service policy use cases</h2>
<p>Use cases are available for the following policies, which are implementations of the Auditing Service policy:</p>
<ul>
	<li>Basic Auditing Policy: see <a href="policy_op_basic_auditing.htm#uc_policy_qos_basic_auditing_pm">Basic Auditing Policy: use case for Policy Manager</a></li>
	<li>Detailed Auditing Policy: see <a href="policy_op_detailed_auditing.htm#uc_policy_op_detailed_auditing_pm_01">Detailed Auditing: Audit Entire Message and Message Metrics</a></li>
	<li>Detailed auditing on failure, basic auditing on success (2019.0.0 and later): see <a href="policy_op_detailed_auditing.htm#uc_policy_op_detail_aud_failure_basic_aud_success">Detailed Auditing on failure, Basic Auditing on success</a></li>
</ul>
<p><a href="#top">back to top</a></p>



<hr class="divide_hr" />



<h2 id="related_topics">Related Topics</h2>
<div class="relatedlinks">
<ul>
	<li><a href="about_policies_view.htm">About Policies</a></li>
	<li><a href="policy_management.htm">Managing Policies</a></li>
	<li><a href="policies_operational_about.htm">About Operational Policies</a></li>
</ul>
<ul>
	<li><a href="../../cm/learnmore/basics_glossary.htm">Glossary of Terms for the Developer Portal</a></li>
</ul>
</div>