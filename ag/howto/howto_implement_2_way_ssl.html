<!DOCTYPE html>
<html>
<head>
<title>howto_implement_2_way_ssl</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<style type="text/css">
/* GitHub stylesheet for MarkdownPad (http://markdownpad.com) */
/* Author: Nicolas Hery - http://nicolashery.com */
/* Version: b13fe65ca28d2e568c6ed5d7f06581183df8f2ff */
/* Source: https://github.com/nicolahery/markdownpad-github */

/* RESET
=============================================================================*/

html, body, div, span, applet, object, iframe, h1, h2, h3, h4, h5, h6, p, blockquote, pre, a, abbr, acronym, address, big, cite, code, del, dfn, em, img, ins, kbd, q, s, samp, small, strike, strong, sub, sup, tt, var, b, u, i, center, dl, dt, dd, ol, ul, li, fieldset, form, label, legend, table, caption, tbody, tfoot, thead, tr, th, td, article, aside, canvas, details, embed, figure, figcaption, footer, header, hgroup, menu, nav, output, ruby, section, summary, time, mark, audio, video {
  margin: 0;
  padding: 0;
  border: 0;
}

/* BODY
=============================================================================*/

body {
  font-family: Helvetica, arial, freesans, clean, sans-serif;
  font-size: 14px;
  line-height: 1.6;
  color: #333;
  background-color: #fff;
  padding: 20px;
  max-width: 960px;
  margin: 0 auto;
}

body>*:first-child {
  margin-top: 0 !important;
}

body>*:last-child {
  margin-bottom: 0 !important;
}

/* BLOCKS
=============================================================================*/

p, blockquote, ul, ol, dl, table, pre {
  margin: 15px 0;
}

/* HEADERS
=============================================================================*/

h1, h2, h3, h4, h5, h6 {
  margin: 20px 0 10px;
  padding: 0;
  font-weight: bold;
  -webkit-font-smoothing: antialiased;
}

h1 tt, h1 code, h2 tt, h2 code, h3 tt, h3 code, h4 tt, h4 code, h5 tt, h5 code, h6 tt, h6 code {
  font-size: inherit;
}

h1 {
  font-size: 28px;
  color: #000;
}

h2 {
  font-size: 24px;
  border-bottom: 1px solid #ccc;
  color: #000;
}

h3 {
  font-size: 18px;
}

h4 {
  font-size: 16px;
}

h5 {
  font-size: 14px;
}

h6 {
  color: #777;
  font-size: 14px;
}

body>h2:first-child, body>h1:first-child, body>h1:first-child+h2, body>h3:first-child, body>h4:first-child, body>h5:first-child, body>h6:first-child {
  margin-top: 0;
  padding-top: 0;
}

a:first-child h1, a:first-child h2, a:first-child h3, a:first-child h4, a:first-child h5, a:first-child h6 {
  margin-top: 0;
  padding-top: 0;
}

h1+p, h2+p, h3+p, h4+p, h5+p, h6+p {
  margin-top: 10px;
}

/* LINKS
=============================================================================*/

a {
  color: #4183C4;
  text-decoration: none;
}

a:hover {
  text-decoration: underline;
}

/* LISTS
=============================================================================*/

ul, ol {
  padding-left: 30px;
}

ul li > :first-child, 
ol li > :first-child, 
ul li ul:first-of-type, 
ol li ol:first-of-type, 
ul li ol:first-of-type, 
ol li ul:first-of-type {
  margin-top: 0px;
}

ul ul, ul ol, ol ol, ol ul {
  margin-bottom: 0;
}

dl {
  padding: 0;
}

dl dt {
  font-size: 14px;
  font-weight: bold;
  font-style: italic;
  padding: 0;
  margin: 15px 0 5px;
}

dl dt:first-child {
  padding: 0;
}

dl dt>:first-child {
  margin-top: 0px;
}

dl dt>:last-child {
  margin-bottom: 0px;
}

dl dd {
  margin: 0 0 15px;
  padding: 0 15px;
}

dl dd>:first-child {
  margin-top: 0px;
}

dl dd>:last-child {
  margin-bottom: 0px;
}

/* CODE
=============================================================================*/

pre, code, tt {
  font-size: 12px;
  font-family: Consolas, "Liberation Mono", Courier, monospace;
}

code, tt {
  margin: 0 0px;
  padding: 0px 0px;
  white-space: nowrap;
  border: 1px solid #eaeaea;
  background-color: #f8f8f8;
  border-radius: 3px;
}

pre>code {
  margin: 0;
  padding: 0;
  white-space: pre;
  border: none;
  background: transparent;
}

pre {
  background-color: #f8f8f8;
  border: 1px solid #ccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px;
}

pre code, pre tt {
  background-color: transparent;
  border: none;
}

kbd {
    -moz-border-bottom-colors: none;
    -moz-border-left-colors: none;
    -moz-border-right-colors: none;
    -moz-border-top-colors: none;
    background-color: #DDDDDD;
    background-image: linear-gradient(#F1F1F1, #DDDDDD);
    background-repeat: repeat-x;
    border-color: #DDDDDD #CCCCCC #CCCCCC #DDDDDD;
    border-image: none;
    border-radius: 2px 2px 2px 2px;
    border-style: solid;
    border-width: 1px;
    font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;
    line-height: 10px;
    padding: 1px 4px;
}

/* QUOTES
=============================================================================*/

blockquote {
  border-left: 4px solid #DDD;
  padding: 0 15px;
  color: #777;
}

blockquote>:first-child {
  margin-top: 0px;
}

blockquote>:last-child {
  margin-bottom: 0px;
}

/* HORIZONTAL RULES
=============================================================================*/

hr {
  clear: both;
  margin: 15px 0;
  height: 0px;
  overflow: hidden;
  border: none;
  background: transparent;
  border-bottom: 4px solid #ddd;
  padding: 0;
}

/* TABLES
=============================================================================*/

table th {
  font-weight: bold;
}

table th, table td {
  border: 1px solid #ccc;
  padding: 6px 13px;
}

table tr {
  border-top: 1px solid #ccc;
  background-color: #fff;
}

table tr:nth-child(2n) {
  background-color: #f8f8f8;
}

/* IMAGES
=============================================================================*/

img {
  max-width: 100%
}
</style>
</head>
<body>
<hr />
<p>layout: page
title: Implement 2-Way SSL using Policy Manager
description: Learn how to use Policy Manager to implement mutual authentication using an SSL (Secure Socket Layer) Certificate.
product: ag
category: learn
sub-nav-class: Mediation
weight: 15
type: page</p>
<h2>nav-title: Implement 2-Way SSL using Policy Manager</h2>
<h2><a name="top"></a> How To Implement 2-Way SSL Using Policy Manager</h2>
<p>Learn how to use Policy Manager to implement mutual authentication using an SSL (Secure Socket Layer) Certificate to authenticate either your business' legal name and location or, alternatively, just your domain.</p>
<h3>Table of Contents</h3>
<div id="toc-marker"></div>
<ul>
<li><a href="#ssl-overview">SSL Overview</a>  </li>
<li><a href="#2-way-ssl-prerequisites">2-Way SSL Prerequisites</a></li>
<li><a href="#assumptions">Assumptions</a></li>
<li><a href="#create-http-security-policy">Create HTTP Security Policy</a></li>
<li><a href="#create-authentication-policy">Create Authentication Policy</a></li>
<li><a href="#configure-outbound-https-support">Configure Outbound HTTPS Support</a></li>
<li><a href="#configure-inbound-https-support">Configure Inbound HTTPS Support</a></li>
<li><a href="#add-trusted-client-certificates-to-policy-manager">Add Trusted Client Certificates to Policy Manager</a></li>
<li><a href="#test">Test</a></li>
</ul>
<h2>SSL Overview</h2>
<h3>Identity Certificates</h3>
<p>When a user visits your secure site, your web server will send a copy of your SSL (Secure Socket Layer) certificate to the user's web browser. The information in the certificate will always include your web site's domain name, such as <em>www.yourdomain.com</em> and the name of the <strong>certificate authority (CA)</strong> that issued the certificate; <em>sometimes</em> it will also include your company's information. This lets the browser know that the web site it's connecting to is the correct web site, and not an impostor or phishing site. This is <strong>authentication.</strong></p>
<p>There are two types of SSL Authentication: <strong>full-authentication</strong> and <strong>domain-authentication</strong>.</p>
<h4>Fully-Authenticated SSL Certificates</h4>
<p>A <strong>fully-authenticated</strong> SSL certificate will contain information about your domain name and the legal name of your business organization. It will also contain the geographical location information for the city, state, and country where your business is registered to do business. Before a Certificate Authority issues this certificate, the applying business has to fax in supporting proof-of-organization documents to prove its identity. Fully-authenticated websites will typically have a green bar before their domain name.</p>
<p><img src="images/imp_2way_ssl_11.png" /></p>
<p><strong>Domain-Authenticated SSL Certificates</strong></p>
<p>A <strong>domain-authenticated</strong> certificate will vouch for your domain only. It will not include any information about your company nor its location in the certificate (except for the two-letter country code).  Domain-authenticated websites will have a lock icon before their name. </p>
<p><img src="images/imp_2way_ssl_12.png" /></p>
<p><a href="#top">back to top</a></p>
<h2>2-Way SSL Prerequisites</h2>
<p>In order for Policy Manager to properly implement mutual authentication, the following requirements must be met inside Policy Manager:</p>
<ol>
<li>You must have an <em>HTTP Security Policy</em> with the <em>Require Client Certificate Authentication</em> option enabled and attached to the service you want.</li>
<li>You must have an <em>Authentication Policy</em> that will check that the correct certificate is presented</li>
<li>You must set your <em>HTTPS Inbound Listener</em> on your Network Director to <em>Accept Client Certificates</em>.</li>
<li>Your <em>HTTPS Inbound Listener</em> must have a set of PKI Keys and an X.509 Certificate.</li>
</ol>
<p><a href="#top">back to top</a></p>
<h2>Assumptions</h2>
<p>This topic implements mutual authentication with an anonymous contract. It allows any user in your Workbench with the correct certificate attached to access the service.</p>
<p><a href="#top">back to top</a></p>
<h2>Create HTTP Security Policy</h2>
<p>The purpose of the HTTP Security Policy is to require a certain credential from the client. In this case we want to require the client to send a certificate as their credentials, which will be validated by the authentication policy in the next step. The HTTP Security Policy must be attached to the virtual service of any service you would like to implement mutual authentication on. </p>
<ol>
<li>Go to <em>[Organization Containing Service] &gt; Polices &gt; Operational Policies</em>.</li>
<li>On the <em>Policies Summary</em>, click <strong>Add Policy</strong> and create an <em>HTTP Security Policy</em>.</li>
<li>On the <em>HTTP Security Policy Details</em> portlet, click <strong>Modify</strong>. </li>
<li>Click <strong>Next</strong> on the <em>Specify HTTP Authentication Options</em> screen.</li>
<li>On the <em>Specify Client Certificate Authentication</em> screen, click the <strong>Require Client Certification Authentication</strong> checkbox and select the <strong>Use clients X.509 certificate from the SSL context</strong> radio button.</li>
<li>Under <em>Subject Category</em>, select <strong>End-User</strong> and click <strong>Finish</strong>
   <img src="images/imp_2way_ssl_1.jpg" /></li>
<li>In the <em>Policy Workflow</em> actions portlet, click <strong>Activate Policy</strong>.</li>
<li>Attach this policy to the service you want to implement mutual authentication on.</li>
<li>Navigate to [<em>Your Virtual Service</em>].</li>
<li>In the <em>Policy Attachments</em> portlet, click <strong>Manage</strong> in the <em>Operational</em> section.</li>
<li>Navigate the Policy Hierarchy, select the newly created HTTP Security Policy and click <strong>Apply</strong>.</li>
</ol>
<p><a href="#top">back to top</a> </p>
<h2>Create Authentication Policy</h2>
<p>The purpose of the authentication policy is to ensure that the correct certificate is received. The <em>HTTP Security Policy</em> only requires that a certificate be sent by the client, but that could be any certificate. This policy must also be attached to the service you want to implement mutual authentication on.</p>
<ol>
<li>Go to <em>[Organization Containing Service] &gt; Polices &gt; Operational Policies</em>.</li>
<li>On the <em>Policies Summary</em>, click <strong>Add Policy</strong> and create an <em>Authentication Policy</em>.</li>
<li>On the <em>Authentication Policy</em> portlet, click <strong>Modify</strong>. </li>
<li>On the <em>Modify Authentication Policy</em> pop-up, select the <strong>End User</strong> radio button.  </li>
<li>In the <em>Domains</em> section, select any domains you wish to have access to, use <strong>&gt;&gt;</strong> to move them to the right panel, and click <strong>Apply</strong>.
   <img src="images/imp_2way_ssl_2.jpg" /></li>
<li>In the <em>Policy Workflow</em> actions portlet, click <strong>Activate Policy</strong>.</li>
<li>Attach this policy to the service you want to implement mutual authentication on.</li>
<li>Navigate to [<em>Your Virtual Service</em>].</li>
<li>In the <em>Policy Attachments</em> portlet, click <strong>Manage</strong> in the <em>Operational</em> section.</li>
<li>Navigate the Policy Hierarchy, select the newly created <em>Authentication Policy</em>, and click <strong>Apply</strong></li>
</ol>
<p><a href="#top">back to top</a></p>
<h2>Configure Outbound HTTPS Support</h2>
<p>The Network Director supports Outbound HTTPS to the physical service/endpoint using the following two methods:</p>
<h3>Outbound HTTP Certificate Configured on the Virtual Service (Suggested Method)</h3>
<p>If you would like to use different outbound certificates for different services, you can accomplish this by attaching them to a particular virtual service.</p>
<p><img src="images/imp_2way_ssl_3.jpg" /></p>
<p>On the <strong>Manage Outbound Identities</strong> page, check the <strong>Use Incoming Identities as Outbound Identities</strong> box, as shown above. When you check this box, the platform uses the HTTP client's mutual SSL certificate. This allows using different client certificates for each service. If the box isn't checked, the listener certificate is used. </p>
<ol>
<li>In <em>Policy Manager Workbench</em>, select the virtual service you would like to attach an Outbound Certificate to.</li>
<li>On the <em>Service Details</em> screen, click <strong>Manage PKI Keys</strong> from the <em>Actions</em> portlet. </li>
<li>On the <em>Select Key Management Option</em> screen. Two options can be used.</li>
<li><strong>Option 1: Generate Your Own PKI keys and an X.509 certificate.</strong> Use this option if you do not have your own certificate and PKI keys. Policy Manager will create them for you and display the information after. <em>Note that Policy Manager must be configured as a Certificate Authority in order to complete the following steps.</em></li>
<li>Select <strong>Generate PKI Keys and X.509 Certificate</strong>, and click <strong>Next</strong>.</li>
<li>Select the key length value (2048 is recommended).</li>
<li>Fill out <em>Certificate Details</em> and click <strong>Finish</strong>.</li>
<li><strong>Option 2: Import your already existing certificate and keys</strong>. Use this option if you have purchased a certificate from a CA and would like to use it.</li>
<li>Select <strong>Import PKI Keys and X.509 Certificate</strong> and click <strong>Next</strong>.</li>
<li>Specify the <em>Keystore Type</em>.</li>
<li>Specify the <em>Keystore Path</em>.</li>
<li>Enter the password for the selected keystore.</li>
<li>Click <strong>Load Aliases</strong>.</li>
<li>
Select the <em>Key Alias</em> you would like to import and click <strong>Finish</strong>.
<img src="images/imp_2way_ssl_4.jpg" />
</li>
<li>From the <strong>Details</strong> page for the service, from the <em>Actions</em> portlet, click <strong>Manage Outbound Identities</strong>. Check the <strong>Use Service Identity for Outbound HTTPS</strong> box, as shown in the diagram at the beginning of this procedure. Click <strong>Finish</strong>. </li>
</ol>
<h3>Outbound HTTPS Certificate Configured on the Network Director Container</h3>
<p>This optional method can be thought of as a “default” certificate that is sent with every request made by services hosted on the Network Director. It is configured in the <em>Details</em> tab in the <em>Outbound Configuration</em> portlet.</p>
<p><img src="images/imp_2way_ssl_5.jpg" /></p>
<ol>
<li>In <em>Policy Manager</em> Workbench, go to <em>Organization Tree &gt; Containers</em> and select the Network Director container instance the service is hosted on.</li>
<li>In the <em>Outbound Configurations</em> portlet, click <strong>Manage PKI Keys</strong>.
<img src="images/imp_2way_ssl_6.jpg" /></li>
<li>On the <em>Select Key Management Option</em> screen, select from two options:</li>
<li><strong>Option 1: Generate Your Own PKI keys and an X.509 certificate</strong>. Use this option if you do not have your own certificate and PKI keys. Policy Manager will create them for you and display the information after. <em>Note that Policy Manager must be configured as a Certificate Authority in order to complete the following steps.</em></li>
<li>Select <strong>Generate PKI Keys and X.509 Certificate</strong> and click <strong>Next</strong>.</li>
<li>Select the key length value (2048 is recommended).</li>
<li>Fill out the <em>Certificate Details</em> and click <strong>Finish</strong>.</li>
<li><strong>Option 2: Import your already existing certificate and keys</strong>. Use this option if you have purchased a certificate from a CA and would like to use it.</li>
<li>Select <strong>Import PKI Keys and X.509 Certificate</strong> and click <strong>Next</strong>.</li>
<li>Specify the <em>Keystore Type</em>.</li>
<li>Specify the <em>Keystore Path</em>.</li>
<li>Enter the password for selected keystore.</li>
<li>Click <strong>Load Aliases</strong>.</li>
<li>Select the <em>Key Alias</em> you would like to import and click <strong>Finish</strong>.</li>
</ol>
<p><a href="#top">back to top</a> </p>
<h2>Configure Inbound HTTPS Support</h2>
<p>There are two things to do in order to enable client certification:</p>
<ul>
<li>Set your HTTPS inbound listener to accept client certificates.</li>
<li>Use Policy Manager to create a client certificate and add it to your store of Trusted CA Certificates.</li>
</ul>
<h3>Create an HTTPS Inbound Listener</h3>
<p><em>Note: If you have an existing HTTPS listener you want to use, you can just modify it under Actions &gt; Modify Container Listener and change its client certificate requirements.</em></p>
<ol>
<li>In the <em>Inbound Listeners</em> portlet, select the <em>Network Director</em> container instance you plan to host the service on.</li>
<li>Click <strong>Add Container Listener</strong>.
<img src="images/imp_2way_ssl_7.jpg" /></li>
<li>From the drop-down, select <strong>HTTPS</strong> and click <strong>Next</strong>.</li>
<li>From the <em>Client Certificates</em> drop-down, select <strong>Accept Client Certificates</strong>.</li>
<li>Fill out the rest of the fields to your preference and click <strong>Finish</strong>.
<img src="images/imp_2way_ssl_8.jpg" /></li>
<li>Go to <strong>Actions &gt; Manage PKI Keys</strong>.</li>
<li>Create or import PKI Keys and certificate for HTTPS Inbound Listener.
<img src="images/imp_2way_ssl_9.jpg" /></li>
<li>On the <em>Select Key Management Option</em> screen, select from two options.</li>
<li><strong>Option 1: Generate Your Own PKI keys and an X.509 certificate</strong>. Use this option if you do not have your own certificate and PKI keys. Policy Manager will create them for you and display the information after. <em>Note that Policy Manager must be configured as a Certificate Authority in order to complete the following steps.</em></li>
<li>Select <strong>Generate PKI Keys and X.509 Certificate</strong> and click <strong>Next</strong>.</li>
<li>Select the key length value (2048 is recommended).</li>
<li>Fill out the <em>Certificate Details</em> and click <strong>Finish</strong>.</li>
<li><strong>Option 2: Import your already existing certificate and keys</strong>. Use this option if you have purchased a certificate from a CA and would like to use it.</li>
<li>Select <strong>Import PKI Keys and X.509 Certificate</strong> and click <strong>Next</strong>.</li>
<li>Specify the <em>Keystore Type</em>.</li>
<li>Specify the <em>Keystore Path</em>.</li>
<li>Enter the password for the selected keystore.</li>
<li>Click <strong>Load Aliases</strong>.</li>
<li>Select the <em>Key Alias</em> you would like to import and click <strong>Finish</strong>.</li>
</ol>
<p><a href="#top">back to top</a></p>
<h2>Add Trusted Client Certificates to Policy Manager</h2>
<p>Add any additional trusted client certificates to the Trust CA Store in Policy Manager.</p>
<ol>
<li>Go to <em>Configure &gt; Security &gt; Certificates &gt; Trusted CA Certificates</em>.</li>
<li>To import the certificate for the client, click <strong>Add Trusted CA Certificate</strong> and click <strong>Apply</strong>.</li>
<li>Go to <strong>Security &gt; Users</strong>.</li>
<li>Assign PKI Keys and X.509 certificate to desired user(s).</li>
<li>Select user(s).</li>
<li>Click <strong>Manage PKI Keys</strong>.</li>
<li><strong>Import PKI Keys and X.509 Certificate</strong> and click <strong>Next</strong>.</li>
<li>Select a <strong>valid .jks file</strong> and click <strong>Finish</strong>.</li>
</ol>
<p><a href="#top">back to top</a></p>
<h2>Test</h2>
<p>You can test to be sure that mutual authentication is working properly by testing it with SOAPUI. You just need to export the Private Key and X.509 Certificate from the HTTPS Inbound Listener and add them to your SOAPUI.</p>
<ol>
<li>Navigate to [<em>Your Network Director</em>].</li>
<li>Locate your <a href="#configure-inbound-https-support">HTTPS Listener created earlier in this guide</a> under <em>Inbound Listeners</em> portlet.</li>
<li>From the <em>Actions</em> drop-down, select <strong>Manage PKI Keys</strong>.</li>
<li>Under <em>Key Management Options</em>, select <strong>Export Private Key and X.509 Certificate</strong> and click <strong>Next</strong>.</li>
<li>Confirm that <em>Keystore</em> Type is set to <strong>Java</strong>.</li>
<li>Fill out the <strong>Keystore Details</strong> fields and click <strong>Finish</strong>.
<img src="images/imp_2way_ssl_10.jpg" /></li>
<li>Inside SOAPUI, go to <strong>File &gt; Preferences &gt; SSL Settings</strong>.</li>
<li>Inside the <em>Keystore</em> field, <strong>browse</strong> to where you saved the exported file.</li>
<li>Under <strong>KeyStore Password</strong>, enter the same password you made when you exported the keys and click <strong>OK</strong>.</li>
<li>SOAPUI should now be able to successfully test services with mutual authentication.</li>
</ol>
<p><a href="#top">back to top</a></p>

</body>
</html>
<!-- This document was created with MarkdownPad, the Markdown editor for Windows (http://markdownpad.com) -->
