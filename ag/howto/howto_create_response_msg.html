<!DOCTYPE html>
<html>
<head>
<title>howto_create_response_msg</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<style type="text/css">
/* GitHub stylesheet for MarkdownPad (http://markdownpad.com) */
/* Author: Nicolas Hery - http://nicolashery.com */
/* Version: b13fe65ca28d2e568c6ed5d7f06581183df8f2ff */
/* Source: https://github.com/nicolahery/markdownpad-github */

/* RESET
=============================================================================*/

html, body, div, span, applet, object, iframe, h1, h2, h3, h4, h5, h6, p, blockquote, pre, a, abbr, acronym, address, big, cite, code, del, dfn, em, img, ins, kbd, q, s, samp, small, strike, strong, sub, sup, tt, var, b, u, i, center, dl, dt, dd, ol, ul, li, fieldset, form, label, legend, table, caption, tbody, tfoot, thead, tr, th, td, article, aside, canvas, details, embed, figure, figcaption, footer, header, hgroup, menu, nav, output, ruby, section, summary, time, mark, audio, video {
  margin: 0;
  padding: 0;
  border: 0;
}

/* BODY
=============================================================================*/

body {
  font-family: Helvetica, arial, freesans, clean, sans-serif;
  font-size: 14px;
  line-height: 1.6;
  color: #333;
  background-color: #fff;
  padding: 20px;
  max-width: 960px;
  margin: 0 auto;
}

body>*:first-child {
  margin-top: 0 !important;
}

body>*:last-child {
  margin-bottom: 0 !important;
}

/* BLOCKS
=============================================================================*/

p, blockquote, ul, ol, dl, table, pre {
  margin: 15px 0;
}

/* HEADERS
=============================================================================*/

h1, h2, h3, h4, h5, h6 {
  margin: 20px 0 10px;
  padding: 0;
  font-weight: bold;
  -webkit-font-smoothing: antialiased;
}

h1 tt, h1 code, h2 tt, h2 code, h3 tt, h3 code, h4 tt, h4 code, h5 tt, h5 code, h6 tt, h6 code {
  font-size: inherit;
}

h1 {
  font-size: 28px;
  color: #000;
}

h2 {
  font-size: 24px;
  border-bottom: 1px solid #ccc;
  color: #000;
}

h3 {
  font-size: 18px;
}

h4 {
  font-size: 16px;
}

h5 {
  font-size: 14px;
}

h6 {
  color: #777;
  font-size: 14px;
}

body>h2:first-child, body>h1:first-child, body>h1:first-child+h2, body>h3:first-child, body>h4:first-child, body>h5:first-child, body>h6:first-child {
  margin-top: 0;
  padding-top: 0;
}

a:first-child h1, a:first-child h2, a:first-child h3, a:first-child h4, a:first-child h5, a:first-child h6 {
  margin-top: 0;
  padding-top: 0;
}

h1+p, h2+p, h3+p, h4+p, h5+p, h6+p {
  margin-top: 10px;
}

/* LINKS
=============================================================================*/

a {
  color: #4183C4;
  text-decoration: none;
}

a:hover {
  text-decoration: underline;
}

/* LISTS
=============================================================================*/

ul, ol {
  padding-left: 30px;
}

ul li > :first-child, 
ol li > :first-child, 
ul li ul:first-of-type, 
ol li ol:first-of-type, 
ul li ol:first-of-type, 
ol li ul:first-of-type {
  margin-top: 0px;
}

ul ul, ul ol, ol ol, ol ul {
  margin-bottom: 0;
}

dl {
  padding: 0;
}

dl dt {
  font-size: 14px;
  font-weight: bold;
  font-style: italic;
  padding: 0;
  margin: 15px 0 5px;
}

dl dt:first-child {
  padding: 0;
}

dl dt>:first-child {
  margin-top: 0px;
}

dl dt>:last-child {
  margin-bottom: 0px;
}

dl dd {
  margin: 0 0 15px;
  padding: 0 15px;
}

dl dd>:first-child {
  margin-top: 0px;
}

dl dd>:last-child {
  margin-bottom: 0px;
}

/* CODE
=============================================================================*/

pre, code, tt {
  font-size: 12px;
  font-family: Consolas, "Liberation Mono", Courier, monospace;
}

code, tt {
  margin: 0 0px;
  padding: 0px 0px;
  white-space: nowrap;
  border: 1px solid #eaeaea;
  background-color: #f8f8f8;
  border-radius: 3px;
}

pre>code {
  margin: 0;
  padding: 0;
  white-space: pre;
  border: none;
  background: transparent;
}

pre {
  background-color: #f8f8f8;
  border: 1px solid #ccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px;
}

pre code, pre tt {
  background-color: transparent;
  border: none;
}

kbd {
    -moz-border-bottom-colors: none;
    -moz-border-left-colors: none;
    -moz-border-right-colors: none;
    -moz-border-top-colors: none;
    background-color: #DDDDDD;
    background-image: linear-gradient(#F1F1F1, #DDDDDD);
    background-repeat: repeat-x;
    border-color: #DDDDDD #CCCCCC #CCCCCC #DDDDDD;
    border-image: none;
    border-radius: 2px 2px 2px 2px;
    border-style: solid;
    border-width: 1px;
    font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;
    line-height: 10px;
    padding: 1px 4px;
}

/* QUOTES
=============================================================================*/

blockquote {
  border-left: 4px solid #DDD;
  padding: 0 15px;
  color: #777;
}

blockquote>:first-child {
  margin-top: 0px;
}

blockquote>:last-child {
  margin-bottom: 0px;
}

/* HORIZONTAL RULES
=============================================================================*/

hr {
  clear: both;
  margin: 15px 0;
  height: 0px;
  overflow: hidden;
  border: none;
  background: transparent;
  border-bottom: 4px solid #ddd;
  padding: 0;
}

/* TABLES
=============================================================================*/

table th {
  font-weight: bold;
}

table th, table td {
  border: 1px solid #ccc;
  padding: 6px 13px;
}

table tr {
  border-top: 1px solid #ccc;
  background-color: #fff;
}

table tr:nth-child(2n) {
  background-color: #f8f8f8;
}

/* IMAGES
=============================================================================*/

img {
  max-width: 100%
}
</style>
</head>
<body>
<hr />
<p>layout: page
title: How to Create a Response Msg
description: A how to guide for returning a locally created response message
product: ag
category: learn
sub-nav-class: Mediation
weight: 05
type: page</p>
<h2>nav-title: Create Response Msg</h2>
<h2>How to Create a Response Msg</h2>
<p>This article describes how to create a virtual service process that creates a response message using input from the request message and returns this response to the consumer.  This is useful for creating sandbox services.  In this case I am adding a protocol header that is specific to SOAP, this header would only be returned via a SOAP binding, but the process generates a normalized XML message that can be returned via any of the bindings, including being mediated to JSON if that is required.</p>
<p>NOTE: this article doesn't cover configuring the bindings, all it does is tell you how to create the response message and wire that into your process.</p>
<h3>Step 1 - Define a Variable</h3>
<p>Use the 'A' button on the process editor palette to define a new variable name of type message.  To match the script below we'll call this new message variable 'newMsg'.  Note: all adding a variable here does is to make the variable name available to other activities in the process editor.</p>
<h3>Step 2 - Set the Reply to use the new Variable</h3>
<p>Edit the reply activity and pick your new message variable as the response message (the field labelled variable).</p>
<h3>Step 3 - Add a Script Activity between the receive and the reply</h3>
<p>Add a script activity between the receive and the reply, and use the script below.  This script performs a few operations:</p>
<ul>
<li>creates a new normalized message</li>
<li>normalizes the input request and converts the resulting normalized message to a Javascript object</li>
<li>Sets the content of the new normalized message as a string built using an element taken from the Javascript object (in this case we know that the input request contains an element called 'cin')</li>
<li>adds a new protocol (binding) header to the new message - this is Optional, and is here simply to show how this works between SOAP and REST bindings (it's ignored by the REST binding)</li>
</ul>
<p>NOTE: there is a known issue in releases prior to 7.2.10 that means that setProtocolHeader() only works on newly created messages.  After 7.2.10 you will be able to use setProtocolHeader() to add new headers to the input message (after normalization).</p>
<p>```javascript
// Create a new normalized message and add it as a variable to the process context
var newMsg = msgFactory.createNormalized();
processContext.setVariable(&quot;newMsg&quot;,newMsg);</p>
<p>// Get the input message and normalize it
var nm = processContext.getVariable(&quot;message&quot;).normalize();</p>
<p>// Convert the normalized input message to JSON and parse it to a JavaScript Object
converter = com.soa.json.xml.script.XML2JSON.converter();
var jsonString = converter.convert(nm.getContentAsString());
var jsObj = JSON.parse(jsonString,null);</p>
<p>// Set the content of our new normalized message to the body content of the soap response
// NOTE: this is the bit that will be inside the &lt;soap:body&gt; tag, it does not include that tag
newMsg.setStringContent(&quot;&lt;brwr:cin xmlns:brwr=\&quot;http://soap.borrower.demo.soa.com\&quot;&gt;&quot; + jsObj.cin + &quot;&lt;/brwr:cin&gt;&quot;)</p>
<p>// Add a protocol header to the new normalized message.  The outbound binding will add this to the SOAP envelope when it sends it
newMsg.setProtocolHeader(&quot;{http://demo.akana.com/}DemoHead&quot;, &quot;&lt;demo:Demohead xmlns:demo=\&quot;http://demo.akana.com/DemoHeade<em>V</em>1_0\&quot;/&gt;&quot;);</p>
<p>```</p>
<h3>Step 4 - Preserve Binding Headers - Optional</h3>
<p>Edit the operation, select Header Propagation, and set Preserved Binding Headers to all, or add the specific header you want to pass through the downstream binding in this list.</p>
<p>This is only needed if you want to pass specific headers back to the consumer.  For REST consumers you would typically enable Preserve Transport Headers and would use the setTransportHeaders() function:</p>
<p><code>javascript
headers = processContext.getVariable(&quot;newMsg&quot;).getTransportHeaders();
headers.add(&quot;HeaderName&quot;, &quot;headerValue&quot;);</code></p>

</body>
</html>
<!-- This document was created with MarkdownPad, the Markdown editor for Windows (http://markdownpad.com) -->
