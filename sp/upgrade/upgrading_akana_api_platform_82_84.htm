---
layout: page
title: Upgrading Akana API Platform 8.2 to 8.4
description: Provides instructions for upgrading from Akana API Platform 8.2 to Akana API Platform 8.4.
product: sp
category: ref
sub-nav-class: Upgrade - Akana API Platform
weight: 15
type: page
nav-title: Upgrade 8.2 to 8.4
---
<h1 id="top">Upgrading Akana API Platform from Version 8.2 to Version 8.4x</h1>
<p>Learn how to upgrade from Akana API Platform 8.2x to 8.4x.</p>
<p><strong>Note</strong>: If you're upgrading Policy Manager for DataPower, follow the steps in this document that you would use for upgrading Network Director.</p>
<p><strong>Note</strong>: This document covers instructions for the combined features available in version 8.4x.</p>
<p><strong>Micro-Upgrade</strong>: If you're upgrading to a micro version&#8212;for example, 8.4.1 to 8.4.22&#8212;it's important to follow through the entire upgrade procedure. For additional notes and information about upgrading to an 8.4x micro version, see <a href="upgrading_micro.htm">Minor-Version Update Notes</a>.</p>
<p>If you're upgrading to a version later than 8.4x, go to <a href="upgrading_akana_api_platform_all.htm">Upgrading the Akana API Platform (all versions)</a> and choose the version you're upgrading to.</p>
<hr class="divide_hr" />



<h2 style="color: gray;">Table of Contents</h2>


<h4 style="color: gray;"><a href="#h_upgrade_planning">Planning the Upgrade</a></h4>
<ol class="table_of_contents">
	<li><a href="#s01_00">Overview</a></li>
	<li><a href="#s01_01">Step 1-1: Review release notes</a></li>
	<li><a href="#s01_02">Step 1-2: Plan the upgrade for additional features</a></li>
	<li><a href="#s01_03">Step 1-3: Gather ZIP files and create folder</a></li>
</ol>



<h4 style="color: gray;"><a href="#h_upgrade_performing">Performing the Upgrade</a></h4>
<ol class="table_of_contents">
	<li><a href="#s02_00">Overview</a></li>
	<li><a href="#s02_01">Step 2-1: Turn off scheduled jobs</a></li>
	<li><a href="#s02_02">Step 2-2: Back up and stop all containers for previous version</a></li>
	<li><a href="#s02_03">Step 2-3: Extract new ZIP files in sequence</a></li>
	<li><a href="#s02_04">Step 2-4: Copy applicable version 8.2 files to version 8.4 folder</a></li>
	<li><a href="#s02_06">Step 2-6: Upgrade container</a></li>
	<li><a href="#s02_07">Step 2-7: Upgrade additional containers</a></li>
	<li><a href="#s02_08">Step 2-8: (Conditional): Unregister and re-register the Windows service</a></li>
	<li><a href="#s02_09">Step 2-9: Start the containers</a></li>
	<li><a href="#s02_10">Step 2-10: Clear browser cache</a></li>
	<li><a href="#s02_11">Step 2-11: Launch the Akana Administration Console</a></li>
	<li><a href="#s02_12">Step 2-12: Refresh repository</a></li>
	<li><a href="#s02_13">Step 2-13: Verify that features were updated correctly</a></li>
	<li><a href="#s02_14">Step 2-14: Run pending installation tasks and restart container</a></li>
	<li><a href="#s02_15">Step 2-15: Upgrade all containers before installing the upgrade tool</a></li>
	<li><a href="#s02_16">Step 2-16: Install and run upgrade tool: "Akana 8.2 to 8.4 model upgrade" (CM containers only)</a></li>
	<li><a href="#s02_17">Step 2-17: Turn scheduled jobs back on</a></li>
	<li><a href="#s02_18">Step 2-18: Update container metadata and authentication options</a></li>
</ol>



<h4 style="color: gray;"><a href="#h_post_upgrade_tasks">Post-Upgrade Tasks</a></h4>
<ol class="table_of_contents">
	<li><a href="#s03_00">Upgrade tasks when upgrading to 8.4: Overview</a></li>
	<li><a href="#s03_01">Step 3-1: Post-Upgrade Tasks for upgrades to 8.4: Provisioning</a></li>
	<li><a href="#s03_02">Step 3-2: Post-Upgrade Tasks for upgrades to 8.4: Upgrade CM Models</a></li>
	<li><a href="#s03_04">Step 3-3: Post-Upgrade Task for upgrades to 8.4: Rebuild CM Styles</a></li>
	<li><a href="#s03_05">Step 3-4: Repeat configuration actions for additional containers and restart all containers</a></li>
	<li><a href="#s03_06">Step 3-5: Post-Upgrade task when upgrading to 8.4: delete and install object mappings</a></li>
	<li><a href="#s03_07">Step 3-6: Post-Upgrade Task for upgrades to 8.4: MongoDB Updates</a></li>
	<li><a href="#s03_08">Step 3-7: Conditional, MongoDB/OAuth: Post-Upgrade Task for Data Migration</a></li>
</ol>



<h4 style="color: gray;"><a href="#h_upgrade_tasks_reference">Upgrade Procedures/Reference:</a></h4>
<ol class="table_of_contents">
	<li><a href="#support_contact">Contacting Akana Technical Support</a></li>
	<li><a href="#container_upgrade_sequence">Container upgrade sequence</a></li>
	<li><a href="#ts_01_error_some_model_objects">Troubleshooting: error: "Some of the model objects are not updated"</a></li>
	<li><a href="#ts_02_error_new_containers">Upgrading by creating a new container and re-using the old container identity: note</a></li>
</ol>



<hr class="divide_hr" />
<h2 id="h_upgrade_planning">Planning the Upgrade</h2>



<h3 id="s01_00">Overview</h3>
<p>There are some steps you might need to take before starting the upgrade process, and some information you'll need to consider to determine how to proceed, including:</p>
<ul>
	<li>Review the Akana API Platform release notes.</li>
	<li>Plan the upgrade for additional features.</li>
	<li>Gather ZIP files and create folder.</li>
	<li>Check if there are any constraints or requirements associated with the type of database you're using, such as permissions required. For details, see <a href="../platform_install/installing_akana_api_platform_v84.htm#database_notes">Database Notes</a> (install doc).</li>
</ul>
<p><a href="#top">Back to top</a></p>



<h3 id="s01_01">Step 1-1: Review release notes</h3>
<p>Review the release notes so that you are aware of changes to the platform. Check for upgrade notes.</p>
<p>Release notes are available from the Rogue Wave Support Center (<a href="https://library.roguewave.com" target="_blank">https://library.roguewave.com</a>).</p>
<p><a href="#top">Back to top</a></p>



<h3 id="s01_02">Step 1-2: Plan the upgrade for additional features</h3>
<p>If you have a specific add-on feature installed, such as the Integration Services option pack, SiteMinder Security Provider, or SAML Web SSO Security Provider feature, it's important that you download the new release version package for the same feature.</p>
<p><strong>Note</strong>: In version 8.2, some of the additional packages have been incorporated into the Akana API Platform along with Community Manager and Policy Manager. Depending on the additional features you're using, you might not have to install updates.</p>
<p>If one of the features is installed in a container that you copy over from the earlier version during the upgrade process, and you don't upgrade the add-on, container startup might fail after you complete the upgrade process. When you upgrade, make sure you have the latest version for any features you're using. See <a href="#s02_13">Step 2-13: Verify that features were updated correctly</a>.</p>
<p><strong>Note</strong>: The SAML Web SSO feature remains at version 8.0. There is no upgrade to version 8.4.</p>
<p><a href="#top">Back to top</a></p>



<h3 id="s01_03">Step 1-3: Gather ZIP files and create folder</h3>
<p>Before starting the upgrade, gather all the ZIP files from the Rogue Wave Support Center (<a href="https://library.roguewave.com" target="_blank">https://library.roguewave.com</a>), and collect any other information needed for the entire process.</p>
<p>You'll need all the ZIP files listed below. They are listed in the order in which they should be installed.</p>

<h4 id="proc_zip_download">To download the installation ZIP files</h4>
<ol>
	<li>Log in to the Rogue Wave Support Center (<a href="https://library.roguewave.com" target="_blank">https://library.roguewave.com</a>).</li>
	<li>In the <strong>My Resources section</strong>, click <strong>Product Downloads</strong>, and then click <strong>Akana - Product Downloads</strong>.</li>
	<li>Choose the major version release page.</li>
	<li>Expand the links at the top of the page and choose the files listed below.</li>
</ol>
<p>You'll need to install files for:</p>
<ol>
	<li><strong>The Akana Platform</strong>: an OSGI environment. Akana features run within this environment, obey its constraints, and make use of its facilities. The platform supports Windows and Unix (Linux, Solaris, AIX) environments.</li>
	<li><strong>The Akana API Platform</strong>.</li>
	<li><strong>Add-Ons</strong>: Any platform add-ons you are using that are not included in the Akana API Platform.</li>
</ol>
<h4>Gather ZIP files and create folder</h4>
<ol>
	<li>On your installation machine, create a folder for the new version: for example, AP84 for API platform 8.4.</li>
	<li>In this folder, copy all the ZIP files listed below. You should have at minimum two files, with additional files if there are updates and/or add-ons.</li>
</ol>

<h4 id="upgrade_zips_82_84">ZIP files for upgrade to version 8.4</h4>
<ol>
	<li>To upgrade the Akana platform, first locate the appropriate file for the operating system you're using. You'll see the below or a later version (online doc not yet updated):
<ol>
	<li><strong>Windows (includes JRE)</strong>: <strong>akana-platform-win-jre-8.4.xxx.zip</strong> </li>
	<li><strong>Linux only (includes JRE)</strong>: <strong>akana-platform-linux-jre-8.4.xxx.zip</strong> </li>
	<li><strong>Windows, Linux, or Solaris (does not include JRE; provide your own JRE, version 1.8)</strong>: <strong>akana-platform-8.4.xxx.zip</strong>
<p><strong>Note</strong>: When using this JRE you must modify the bin/setDEMS.sh script and comment out lines that relate to your JRE and then ensure you have JAVA set correctly.</p></li>
</ol></li>
	<li>Check if there are any Akana platform updates. If there are any updates, locate the latest cumulative update ZIP file.
	<p><strong>Note</strong>: Akana API Platform 8.4 requires Akana Platform 8.4.</p>
	</li>
	<li>To upgrade the Akana API platform to version 8.4, locate the file below, which contains all necessary files for Akana API Platform installation, including Policy Manager and Community Manager installation:
		<ul>
	<li>akana-api-platform-8.4.xxx.zip</li>
</ul></li>
	<li>Check if there are any Akana API platform updates. If there are any updates, locate the latest cumulative update ZIP file. For example:
	<p><strong>akana-api-platform-update-cumulative-8.4.1.zip</strong></p></li>
</ol>
<h4>ZIP files for add-ons</h4>
<p>Check the Rogue Wave Support Center (<a href="https://library.roguewave.com" target="_blank">https://library.roguewave.com</a>) for the latest ZIP file for any additional add-ons you are using in your installation. In the <strong>My Resources</strong> section, click <strong>Product Downloads</strong>, then click <strong>Akana - Product Downloads</strong>. Get all applicable update files for your installation. You'll extract these after the other files.</p>
<p>For product compatibility information, refer to the applicable matrix in the Rogue Wave Support Center (<a href="https://library.roguewave.com" target="_blank">https://library.roguewave.com</a>).</p>
<p><strong>Note</strong>: For notes about limitations and extra steps for specific databases, see <a href="../platform_install/installing_akana_api_platform_v84.htm#supported_databases">Supported databases</a> (install doc).</p>
<p><a href="#top">Back to top</a></p>



<hr class="divide_hr" />
<h2 id="h_upgrade_performing">Performing the Upgrade</h2>



<h3 id="s02_00">Overview</h3>
<p><strong>Note</strong>: The instructions in this document are for upgrade from Akana API Platform 8.2 to Akana API Platform 8.4.</p>
<p>At a high level, to perform the upgrade, you'll complete the following actions:</p>
<ol>
	<li>Install the Akana API Platform 8.4 in a new location.</li>
	<li>Copy the AP82 container instances to the instances folder for the AP84 installation (except the configurator instance).</li>
	<li>Perform the upgrade steps from the AP84 installation, following the exact sequence given below.</li>
</ol>
<p><a href="#top">Back to top</a></p>



<h3 id="s02_01">Step 2-1: Turn off scheduled jobs</h3>
<p>Before upgrading, you must turn off scheduled jobs in the configuration settings, including the following two scheduled jobs in this sequence:</p>
<ol>
	<li>com.soa.scheduler.quartz</li>
	<li>simple.scheduler.enabled</li>
</ol>
<p><strong>Note</strong>: Simple scheduler jobs are specific to a container. In general, any container that has features installed that could require the schedule jobs should have the simple scheduler jobs installed and enabled. Quartz scheduler jobs are specific to the environment (database).</p>
<p>When upgrade is complete, you'll turn these properties back on again (see <a href="#s02_17">Step 2-17: Turn scheduled jobs back on</a>). </p>
<p><strong>Note</strong>: Perform this step for all AP84 containers with Policy Manager features installed.</p>
<h4>To turn off scheduled jobs</h4>
<ol>
	<li>Log in to the Akana Administration Console using Administrator credentials.</li>
	<li>Click the <strong>Configuration</strong> tab.</li>
	<li>In the <strong>Configuration Categories</strong> section, find <strong>com.soa.scheduler.quartz</strong>. </li>
	<li>Locate the <strong>org.quartz.scheduler.enabled</strong> property and change it to <strong>false</strong>.</li>
	<li>Click <strong>Apply Changes</strong>.</li>
	<li>In the <strong>Configuration Categories</strong> section, find <strong>com.soa.scheduler</strong>. </li>
	<li>Locate the <strong>simple.scheduler.enabled</strong> property and change it to <strong>false</strong>, as shown below.
			<p><img src="images/02_01_config_categ.jpg" alt="Turning off scheduled jobs" /></p></li>
	<li>Click <strong>Apply Changes</strong>.</li>
</ol>
<p><a href="#top">Back to top</a></p>



<h3 id="s02_02">Step 2-2: Back up and stop all containers for previous version</h3>
<p>The next step is to back up and stop the current version, before you upgrade. Follow the steps below.</p>
<h4>To back up and stop version 8.2</h4>
<ol>
	<li>Stop any containers that are currently running. 
<p>This is required to update the database schema to AP84. Stopping the containers ensures that the database is not locked while the update is in progress. For more information, refer to <a href="../container_management/start_stop_container_instance.htm" title="Starting and Stopping a Container Instance" target="_blank">Starting and Stopping a Container Instance</a>.</p></li>
	<li>Back up your AP82 database, using your database management tool, and save the backup file to a safe location. For example, if you're using MySQL, the backup command might look something like the below:
<pre>C:\Program Files\MySQL\MySQL Server 5.6\bin>mysqldump.exe -e -u root -p -h localhost AP82 &gt; C:\backups\ap82-20170331</pre>
</li>
	<li>Back up your AP82 release directory, and save the backup file to a safe location.</li>
</ol>
<p><a href="#top">Back to top</a></p>



<h3 id="s02_03">Step 2-3: Extract new ZIP files in sequence</h3>
<p>Now you're ready to install the new version. Make sure you install from the various ZIP files in the correct sequence.</p>
<p><strong>Note</strong>: the filenames used below are examples. When you download files from the Rogue Wave Support Center (<a href="https://library.roguewave.com" target="_blank">https://library.roguewave.com</a>), you might have an updated variation.</p>
<h4>To extract the new ZIP files</h4>
<p><strong>Note</strong>: When unzipping files, if you are prompted to replace a file, choose All to accept all the new files.</p>
<ol>
	<li>Go to the folder with the downloaded ZIP files, which you created earlier. See <a href="#s01_03">Step 1-3: Gather ZIP files and create folder</a>. 
		<p>Make sure the folder includes all the ZIP files you'll need for upgrade. You should have at least two files, and possibly more, as detailed in <a href="#upgrade_zips_82_84">ZIP files for upgrade to version 8.4</a>.</p></li>
	<li><strong>Extract the Akana platform files</strong>:
		<ol>
	<li><strong>Main platform file</strong>: extract <strong>akana-platform-win-jre-8.4.xxx.zip</strong> or comparable file for Linux or other operating system.</li>
	<li><strong>Possible updates</strong>: If there are any updates for the Akana Platform, extract the update next.</li>
</ol></li>
	<li><strong>Extract the Akana API Platform files</strong> (contains all necessary files for Policy Manager and API Platform/Community Manager installation):
<ol>
	<li><strong>Main API Platform file</strong>: extract <strong>akana-api-platform-8.4.xxx.zip</strong>.</li>
	<li><strong>Possible updates</strong>: If there are any updates for the Akana API Platform, extract the update next.</li>
</ol></li>
	<li>Extract the ZIP files for any add-ons you're using.</li>
</ol>
<p><strong>Note</strong>: After the installation is complete, do not launch the Configure Container Instance Wizard/configure the API Platform container until you've completed the next step, below.</p>
<p><a href="#top">Back to top</a></p>



<h3 id="s02_04">Step 2-4: Copy applicable version 8.2 files to version 8.4 folder</h3>
<p>The next step is to copy container instances to your new installation.</p>
<p><strong>Note</strong>: Do not copy the Configurator instance.</p>
<h4>To copy version 8.2 files to version 8.4 folder</h4>
<ol>
	<li>Go to the AP82 backup directory, and locate the AP82 container instances. For example:
AP82/instances/{instance}</li>
	<li>Copy the AP82 container instances. Note:
		<ul>
	<li><strong>Include</strong> AP82, Network Director, and Agent container instances. </li>
	<li><strong>Do not include</strong> the AP82 configurator or the AP82 default container folder.
		<p>An example is shown below.</p>
<p><img src="images/02_04_update_instances.jpg" alt="Copy container instances" /></p></li>
</ul></li>
	<li>In the AP84 container instances folder (AP84/instances/{pm_instance}, paste the container instances that you copied.</li>
	<li>Delete the log folder so that the logs will only include information for the new version, not for the old version.</li>
</ol>
<p><a href="#top">Back to top</a></p>



<h3 id="s02_06">Step 2-6: Upgrade container</h3>
<p>You'll need to perform the upgrade procedure on each container you're upgrading to AP84, using the <strong>Configure Container Instance</strong> wizard.</p>
<p><strong>Note</strong>: These instructions follow a sequence of upgrading the first Policy Manager container, then additional Policy Manager and Community Manager containers, and then Network Director and Agent containers. However, once you've done an initial Policy Manager upgrade to upgrade the database, the sequence of containers really doesn't matter. See <a href="#container_upgrade_sequence">Container upgrade sequence</a> below.</p>
<p><strong>Note</strong>: Before you upgrade, make sure you've completed all previous steps, including copying the container instances (see <a href="#s02_04">Step 2-4: Copy applicable version 8.2 files to version 8.4 folder</a>).</p>
<p>There are three ways you can upgrade the container:</p>
<ul>
	<li>Via the user interface: see <a href="#s02_06_01">Upgrade container to Akana API Platform 8.4 (GUI)</a>.</li>
	<li>Silent upgrade: see <a href="#s02_06_02">Upgrade container to Akana API Platform 8.4 (silent upgrade)</a>.</li>
	<li>Command line upgrade: see <a href="#s02_06_03">Upgrade container to Akana API Platform 8.4 (command line)</a>.</li>
</ul>


<h3 id="s02_06_01">Upgrade container to Akana API Platform 8.4 (GUI)</h3>
<p>Upgrade via the GUI launches the Configurator wizard, which walks you through the upgrade process.</p>
<h4>To upgrade the container to Akana API Platform 8.4 (via the GUI)</h4>
<ol>
	<li>Open up a command prompt.</li>
	<li>Go to the new folder where you unzipped the version 8.4 files, then navigate to the \bin subfolder and run the following command:
<pre>startup configurator</pre></li>
	<li>The Configurator starts, and the <strong>Welcome to Configure Container Instance Wizard</strong> page displays. Click <strong>Next</strong>.</li>
	<li>At the Instance Name screen, specify the name of the Akana container instance the upgrade will be applied to, as shown in the example below (same name as previous installation). Leave the Container Key field blank; the upgrade process will use the container key for the container being upgraded. Click <strong>Next</strong>.
<p><img src="images/02_06_01_InstanceName.jpg" alt="Instance Name page" /></p></li>
	<li>At the <strong>Instance Already Exists page</strong>, to apply the AP82 to AP84 upgrade, click <strong>Update</strong>, as shown below, and then click <strong>Next</strong>.
<strong>Note</strong>: This updates the instance you copied over in <a href="#s02_04">Step 2-4: Copy applicable version 8.2 files to version 8.4 folder</a>.
<p><img src="images/02_06_02_instance_already_exists.jpg" alt="Instance Already Exists message" /></p></li>
	<li>At the <strong>Instance Configuration Summary</strong> page, shown below, verify that the instance has been stopped, and then click <strong>Finish</strong>.
<p><img src="images/02_06_03_Instance_Config_Summary.jpg" alt="Instance Configuration Summary page" /></p></li>
	<li>When the container update process is complete, the <strong>Update Complete</strong> page displays with a summary of the number of bundles that were updated.</li>
	<li>Click <strong>OK</strong> to close the wizard.</li>
</ol>
<p><a href="#top">Back to top</a></p>



<h3 id="s02_06_02">Upgrade container to Akana API Platform 8.4 (silent upgrade)</h3>
<p>You can set up the Configure Container Instance Wizard update process to run in an automated mode (silent mode).</p>
<p>To do this you essentially need to set up a properties file that contains a set of property values that the wizard uses to automatically configure a container instance.</p>
<h4>To upgrade to Akana API Platform 8.4 using silent mode</h4>
<ol>
	<li>Define a properties file for upgrade in silent mode:
<ol>
	<li>Choose a file name; for example, upgrade.properties.</li>
	<li>In the file, add the following default content:
<pre>container.instance.name=[container_instance_name]
wizard.mode=update</pre>
<p>For example:</p>
<pre>container.instance.name=policymanager
wizard.mode=update</pre></li>
</ol></li>
	<li>Determine system properties you want to use when running the upgrade in silent mode. There are two possible properties, which together are used to perform the silent upgrade:
<ol>
	<li>silent (If true, silent configuration will be performed)</li>
	<li>properties (path/filename for properties file to be used for configuration)</li>
</ol></li>
	<li>Run the upgrade in silent mode, using either of the following commands, depending on the operating system:
<ul>
	<li>Windows:
<pre>\bin>startup.bat configurator "-Dsilent=true" "-Dproperties={full path to properties file}\upgrade.properties"</pre></li>
	<li>Unix:
<pre>/bin&gt;startup.sh configurator -Dsilent=true -Dproperties={full path to properties file}/upgrade.properties</pre></li>
</ul></li>
	<li>Repeat for Network Director or Agent containers:
<ol>
	<li>For each container, repeat the steps above.</li>
</ol></li>
	<li>Optional post-upgrade step for silent mode users not using the Akana Administration Console:
<ol>
	<li>If you will not be using the Akana Administration Console, you can install the Policy Manager 8.4.0 schema manually using a third-party database schema management tool.</li>
	<li>For assistance in installing the schema, contact Akana Customer Support.</li>
</ol></li>
</ol>
<p><strong>Note</strong>: If you are not using the Akana Administration Console, you are done with the upgrade; skip the rest of the upgrade steps.</p>


<h3 id="s02_06_03">Upgrade container to Akana API Platform 8.4 (command line)</h3>
<p>You can also perform the upgrade process from the command line. Follow the steps below.</p>
<h4>To upgrade to Akana API Platform 8.4 from the command line</h4>
<ol>
	<li>Execute the following in the \bin folder depending on your operating system:
<ul>
	<li>Windows:
<pre>startup.bat configurator "-Dsilent=true" "-Dcontainer.instance.name={Instance name}" "-Dwizard.mode=update"</pre></li>
	<li>Unix:
<pre>startup.sh configurator -Dsilent=true -Dcontainer.instance.name={instance name} -Dwizard.mode=update</pre></li>
</ul></li>
</ol>
<p><a href="#top">Back to top</a></p>



<h3 id="s02_07">Step 2-7: Upgrade additional containers</h3>
<p>Repeat the upgrade process for all additional containers. A suggested sequence is:</p>
<ol>
	<li>First, any additional containers running Policy Manager and/or the API Platform.</li>
	<li>Then, any Network Director or Agent containers.</li>
</ol>
<p><strong>Note</strong>: These instructions follow a sequence of upgrading the first Policy Manager container, then additional Policy Manager and Community Manager containers, and then Network Director and Agent containers. However, once you've done an initial Policy Manager upgrade to upgrade the database, the sequence of containers really doesn't matter. See <a href="#container_upgrade_sequence">Container upgrade sequence</a> below.</p>

<h4>To upgrade additional containers</h4>
<ol>
	<li>For each container, repeat <a href="#s02_06">Step 2-6: Upgrade container</a>.</li>
</ol>
<p><a href="#top">Back to top</a></p>



<h3 id="s02_08">Step 2-8: (Conditional, Windows only): Unregister and re-register the Windows service</h3>
<p>If your containers are registered as a Windows service, so that the container will start automatically when Windows starts, you must unregister the old version and register the new version, for each container.</p>
<p>If you're not sure which containers are registered as a Windows service, you can check in the Windows Control Panel (<strong>Administrative Tools</strong> &gt; <strong>Services</strong>). To change the services, you must run as Administrator.</p>

<h4 id="proc_register_unregister_windows">To unregister and register the Windows service</h4>
<ol>
	<li>Open a command prompt in Administrator mode (If you don't use Administrator mode, Windows prompts for Admin permission before unregistering/registering the service, but doesn't actually start the service).</li>
	<li>Unregister the previous version as a windows service:
		<pre>.\{AP82_install_folder}\bin\unregisterContainerServiceYAJWS.bat {instance_name}</pre></li>
	<li>Register the new version as a Windows service:
	<pre>.\{AP84_install_folder}\bin\registerContainerServiceYAJWS.bat {instance_name}</pre></li>
	<li>If you're running in Administrator mode, Windows registers the service and also starts it.</li>
	<li>Repeat steps 2 and 3 for each additional container that's registered as a Windows service.</li>
</ol>
<p><a href="#top">Back to top</a></p>



<h3 id="s02_09">Step 2-9: Start the containers</h3>
<p><strong>Note</strong>: If you registered your containers as Windows services, in the previous step, the containers should already be running.</p>
There are several ways you can start a container: Windows, as Windows service, or Unix. Follow the applicable procedure below.
<h4>To start the container (Windows)</h4>
<ol>
	<li>Navigate to the \{AP84_install_folder}\bin\ folder.</li>
	<li>Type the following:
<pre>startup {instance_name}</pre></li>
</ol>
<h4>To start the container (as Windows service)</h4>
<ol>
	<li>Launch the Program Group (<strong>Settings</strong> &gt; <strong>Control Panel</strong> &gt; <strong>Administrative Tools</strong> &gt; <strong>Services</strong>).</li>
	<li>Select the Akana Container Instance (the instance name is displayed as the Container Key).</li>
	<li>From the <strong>Actions</strong> menu, select <strong>Start</strong>.</li>
</ol>
<h4>To start the container (Unix)</h4>
<ol>
	<li>Navigate to the /{AP84_install_folder}/bin/ folder.</li>
	<li>Type the following:
<pre>startup.sh {instance_name}</pre></li>
</ol>
<h4>To start the container (Unix, Background)</h4>
<ol>
	<li>Navigate to the /bin folder.</li>
	<li>Type the following:
<pre>startup.sh {instance_name} -bg</pre></li>
</ol>
<p><a href="#top">Back to top</a></p>



<h3 id="s02_10">Step 2-10: Clear browser cache</h3>
<p>Before launching the Akana Administration Console, clear the browser cache and then refresh the page, or start a new session in a browser private window. This ensures that you see the user interface changes included in the update.</p>
<p>This completes the product installation. The next steps walk you through additional updates you'll need to make to complete the process, including updating database schemas and data.</p>
<p><a href="#top">Back to top</a></p>



<h3 id="s02_11">Step 2-11: Launch the Akana Administration Console</h3>
<p>Now it's time to launch the Administration Console and complete the installation tasks.</p>
<p><strong>Note</strong>: The rest of the installation tasks are completed on containers running PM/CM only. There is no need to run them on Network Director containers.</p>
<h4>To launch the Akana Administration Console</h4>
<ol>
	<li>Launch the Akana Administration Console for the updated container instance:
<pre>http://{hostname}:{port}/admin</pre></li>
	<li>Log in to the Akana Administration Console as an Administrator. The Akana Administration Console launches and displays the <strong>Available Features</strong> tab, as shown below.
<p><img src="images/02_11_Available_Features_Tab.jpg" alt="Available Features tab" /></p></li>
</ol>
<p><a href="#top">Back to top</a></p>



<h3 id="s02_12">Step 2-12: Refresh repository</h3>
<p>Verify that the repository is there. Refresh if needed.</p>
<h4>To verify/refresh the repository</h4>
<ol>
	<li>Click the <strong>Repository</strong> tab and verify that the <strong>Akana Platform Repository 8.4.0</strong> and the <strong>Akana API Platform Repository 8.4.0</strong> are both present, as shown below.
		<p><img src="images/02_12_repository.jpg" alt="Repository tab" /></p></li>
	<li>Conditional: if you don't see both these repositories, click <strong>Refresh</strong> to update.</li>
</ol>
<p>Further installation steps are conditional:</p>
<ul>
	<li>If your container <strong>doesn't</strong> have Policy Manager features installed (Akana Policy Manager Console and Akana Policy Manager Services), the upgrade is complete. </li>
	<li>If your container <strong>does</strong> have Policy Manager features installed (Akana Policy Manager Console and Akana Policy Manager Services), continue.</li>
</ul>
<p><a href="#top">Back to top</a></p>



<h3 id="s02_13">Step 2-13: Verify that features were updated correctly</h3>
<p>At this point, check that all the features installed in your implementation have been correctly upgraded to the new version you're installing:</p>
<ol>
	<li>In the Akana Administration Console, go to <strong>Installed Features</strong>.</li>
	<li>Look at the <strong>Version</strong> column to make sure each feature has the correct version number. An example is shown below.
<p><img src="images/02_13_features_installed.jpg" alt="8.4 features installed tab" /></p>
	</li>
</ol>
<p>If there are any issues, check that you followed all steps correctly.</p>
<p>If needed, <a href="#support_contact">contact Technical Support</a>.</p>
<p><a href="#top">Back to top</a></p>



<h3 id="s02_14">Step 2-14: Run pending installation tasks and restart container</h3>
<p>Once you've installed and configured the Policy Manager features (Akana Policy Manager Console and Akana Policy Manager Services) on your container, the next step is to run any pending installation tasks. Some tasks start automatically; some might need to be started manually.</p>
<p>Pending Installation tasks should include at least the below:</p>
<ul>
	<li><strong>Manage Schemas</strong>: Updates the database schemas for the new version. This task needs to be done only once.</li>
</ul>
<h4>To run pending installation tasks</h4>
<p><strong>Note</strong>: Pending installation tasks might vary according to your upgrade process. When you click <strong>Complete Configuration</strong>, the upgrade process leads you through tasks.</p>
<ol>
	<li>In the Akana Administration Console, go to <strong>Installed Features</strong> &gt; <strong>Pending Installation Tasks</strong>. At the bottom left, click <strong>Complete Configuration</strong>, as shown below.
<p><img src="images/02_14_01_admin_console_installedfeatures.jpg" alt="Click Complete Configuration" /></p></li>
	<li>The <strong>Manage Schemas</strong> wizard starts. In the <strong>Available Schemas</strong> section, add the schemas listed. It should look something like the below. There might be variations depending on the features you're using. Click <strong>Finish</strong>.
		<p><img src="images/02_14_02_available_schemas.jpg" alt=" Available Schemas section" /></p></li>
	<li>The schemas are installed. At the summary page, click <strong>Next Task</strong> if there is another task. Otherwise, click <strong>Finish</strong>.</li>
	<li>Restart the container.
		<strong>Note</strong>: If the container doesn't restart automatically, restart it manually.</li>
	<li>Check to make sure all the bundles have started correctly: In the Admin Console, go to the <strong>System</strong> tab. It should show a lifecycle state of STARTED for all bundles, with no errors listed, as shown below.
	<p><img src="images/02_14_03_CheckBundlesRestarted.jpg" alt="Check that bundles are running" /></p></li>
</ol>
<p><a href="#top">Back to top</a></p>



<h3 id="s02_15">Step 2-15: Upgrade additional containers</h3>
<p>Make sure:</p>
<ul>
	<li>All containers are upgraded.</li>
	<li>Pending installation tasks are complete for all containers.</li>
	<li>All bundles start correctly for each container.</li>
</ul>
<p>Essentially, make sure all steps, from <a href="#s02_06">Step 2-6: Upgrade container</a> through to <a href="#s02_14">Step 2-14: Run pending installation tasks and restart container</a>, are complete for every container.</p>
<p><a href="#top">Back to top</a></p>



<h3 id="s02_16">Step 2-16: Install and run upgrade tool: "Akana 8.2 to 8.4 model upgrade" (CM containers only)</h3>
<p>The next step is to run the 8.2 to 8.4 upgrade tool, to update database objects from version 8.2 to 8.4.</p>
<p>This step is applicable only if Community Manager is installed on the container. If the container doesn't include Community Manager, skip to <a href="#s02_17">Step 2-17: Turn scheduled jobs back on</a>.</p>
<p>Before running this tool, change the <strong>failure.data.capture.enabled</strong> setting in the configuration file. Changing this setting will save memory for logging events during the upgrade process. It's important to change this setting; if you don't, there might be memory issues during upgrade. If you want to, you can change the setting back afterwards. When set to <strong>true</strong>, this setting indents entries in the log file.</p>
<p>Follow these three steps:</p>
<ol>
	<li><a href="#s02_16_01">Step A: To turn off the <strong>failure.data.capture.enabled</strong> configuration setting</a></li>
	<li><a href="#s02_16_02">Step B: To install and run the 8.2 to 8.4 upgrade tool</a></li>
	<li><a href="#s02_16_03">Step C: To restore the <strong>failure.data.capture.enabled</strong> configuration setting</a></li>
</ol>
<p><strong>Note</strong>: Perform these steps only once, on one container that has database connectivity and has Policy Manager Service installed.</p>


<h4 id="s02_16_01">Step A: To turn off the failure.data.capture.enabled configuration setting</h4>
<ol>
	<li>Log in to the Akana Administration Console for your upgraded installation, using Administrator credentials.</li>
	<li>Click the <strong>Configuration</strong> tab.</li>
	<li>On the left, under <strong>Configuration Categories</strong>, find the <strong>com.soa.framework</strong> category.</li>
	<li>Locate the <strong>failure.data.capture.enabled</strong> property and change it to <strong>false</strong>, as shown below.
			<p><img src="images/02_16_01_failure_data_captured.jpg" alt="Changing the failure.data.capture.enabled property" /></p></li>
	<li>Click <strong>Apply Changes</strong>.</li>
</ol>

<h4 id="s02_16_02">Step B: To install and run the 8.2 to 8.4 upgrade tool</h4>
<ol>
	<li>Launch the Akana Administration Console for your upgraded installation, using Administrator credentials.</li>
	<li>Click the <strong>Available Features</strong> tab.</li>
	<li>From the <strong>Filter</strong> drop-down, select <strong>Tool</strong>.</li>
	<li>Select <strong>Akana 8.2 to 8.4 model upgrade</strong>, as shown below, and click <strong>Install Feature</strong>. The upgrade tool is installed.
			<p><img src="images/02_16_02_Upgrade_Tool.jpg" alt="8.2 to 8.4 upgrade tool" /></p></li>
	<li>At the <strong>Installation Complete</strong> message, click <strong>Configure</strong>.</li>
	<li>At the <strong>Perform 8.2 to 8.4 upgrade</strong> page, make sure <strong>Upgrade APIs</strong> is checked, as shown below, and click <strong>Finish</strong>.
		<p><img src="images/02_16_03_UpgradeTool.jpg" alt="Upgrade tool configuration" /></p></li>
	<li>At the system restart prompt, click <strong>OK</strong> to restart.</li>
</ol>


<h4 id="s02_16_03">Step C: To restore the failure.data.capture.enabled configuration setting</h4>
<p>Log in to the Akana Administration Console, using the instructions in <a href="#s02_16_01">Step A: To turn off the <strong>failure.data.capture.enabled</strong> configuration setting</a>. Change the setting back to <strong>true</strong>, and save the changes.</p>
<p><a href="#top">Back to top</a></p>



<h3 id="s02_17">Step 2-17: Turn scheduled jobs back on</h3>
<p>Now it's time to turn back on the properties that you turned off in <a href="#s02_01">Step 2-1</a>. Restart the scheduled jobs in the opposite sequence; first the simple scheduler, and then the Quartz scheduler.</p>
<p><strong>Note</strong>: Perform this step for all the AP82 containers with Policy Manager features installed, which have now been upgraded to AP84. Before performing this step, make sure the container was restarted.</p>
<h4>To turn scheduled jobs back on</h4>
<ol>
	<li>Log in to the Akana Administration Console using Administrator credentials.</li>
	<li>Click the <strong>Configuration</strong> tab.</li>
	<li>In the Configuration Categories section, find <strong>com.soa.scheduler</strong>. </li>
	<li>Locate the <strong>simple.scheduler.enabled</strong> property and change it to <strong>true</strong>.</li>
	<li>Click <strong>Apply Changes</strong>.</li>
	<li>In the <strong>Configuration Categories</strong> section, find <strong>com.soa.scheduler.quartz</strong>. </li>
	<li>Locate the <strong>org.quartz.scheduler.enabled</strong> property and change it to <strong>true</strong>.</li>
	<li>Click <strong>Apply Changes</strong>.</li>
</ol>
<p><a href="#top">Back to top</a></p>



<h3 id="s02_18">Step 2-18: Update container metadata and authentication options</h3>
<p>The final step in the upgrade process is to update the Metadata URL and Authentication Options of each container you upgraded, in Policy Manager. This updates the container capabilities to support the latest features.</p>
<h4>To update container metadata and authentication options</h4>
<ol>
	<li>Log in to the Policy Manager Management Console as the Administrator.</li>
	<li>In the left pane, from the <strong>Containers</strong> folder, select the AP84 container.</li>
	<li>In the right pane, from the <strong>Actions</strong> Portlet, select <strong>Update Container Metadata</strong>, as shown below.
<p><img src="images/02_18_01_update_container_metadata.jpg" alt="Update Container Metadata" /></p></li>
	<li>Enter the metadata URL for the container being updated (<strong>http://{pm_host}:{pm_port}/metadata</strong> or <strong>http://{nd_host}:{nd_port}/metadata</strong>), or the metadata path for the Network Director. An example is shown below.
<p><img src="images/02_18_02_metadata_import.jpg" alt="Metadata path for the ND" /></p></li>
	<li>Conditional: If Authentication options are being used or updated, select the authentication options.</li>
	<li>If the metadata URL is not accessible from Policy Manager, you can update the metadata from a file:
<ol>
	<li>First, access the metadata URL from a machine that has access to the container and save the metadata document to a file.</li>
	<li>Then, upload the file to Policy Manager.</li>
</ol></li>
</ol>
<p>That completes the upgrade.</p>
<p>After upgrading, run the post-install tasks on one of the containers with the Akana API Platform feature installed, as covered in the next group of tasks.</p>
<p><a href="#top">Back to top</a></p>




<hr class="divide_hr" />
<h2 id="h_post_upgrade_tasks">Post-Upgrade Tasks</h2>




<h3 id="s03_00">Upgrade tasks when upgrading to 8.4: Overview</h3>
<p>Once you've completed the product version update, there are additional post-upgrade tasks you'll need to complete. Run these tasks on one of the containers with the Akana API Platform feature installed. Some of these steps are conditional depending on platform features you're using. They include:</p>
<ul>
	<li><a href="#s03_01">Step 3-1: Post-Upgrade Tasks for upgrades to 8.4: Provisioning</a></li>
	<li><a href="#s03_02">Step 3-2: Post-Upgrade Tasks for upgrades to 8.4: Upgrade CM Models</a></li>
	<li><a href="#s03_04">Step 3-3: Post-Upgrade Task for upgrades to 8.4: Rebuild CM Styles</a></li>
	<li><a href="#s03_05">Step 3-4: Repeat configuration actions for additional containers and restart all containers</a></li>
	<li><a href="#s03_06">Step 3-5: Post-Upgrade task when upgrading to 8.4: delete and install object mappings</a></li>
	<li><a href="#s03_07">Step 3-6: Post-Upgrade Task for upgrades to 8.4: MongoDB Updates</a></li>
	<li><a href="#s03_08">Step 3-7: Conditional, MongoDB/OAuth: Post-Upgrade Task for Data Migration</a></li>
</ul>
<p><a href="#top">Back to top</a></p>



<h3 id="s03_01">Step 3-1: Post-Upgrade Tasks for upgrades to 8.4: Provisioning</h3>
<p>If you're upgrading from any previous version to version 8.4, you'll need to complete the <strong>Provisioning</strong> task as part of the upgrade process, in all containers where the Policy Manager feature is installed.</p>
<p>The provisioning step must be completed for each container running PM/CM.</p>
<h4>To complete the Provisioning configuration action</h4>
<ol>
	<li>In the Akana Administration Console, click the <strong>Configuration</strong> tab.</li>
	<li>In the <strong>Configuration Actions</strong> section, choose the <strong>Provisioning</strong> configuration action, as shown below.
	<p><img src="images/03_01_Manual_Provisioning.jpg" alt="Running Provisioning manually" /></p></li>
	<li>On the <strong>Provisioning</strong> page, make sure <strong>Perform Provisioning</strong> is checked, as shown below, and then click <strong>Finish</strong>.
		<p><strong>Note</strong>: Make sure the Provisioning task is 100% complete before moving to the next task.</p>
		<p><img src="images/03_02_provisioning.jpg" alt="Provisioning Summary" /></p></li>
	<li>When provisioning is 100% complete, click <strong>Close</strong>.</li>
</ol>
<p><a href="#top">Back to top</a></p>



<h3 id="s03_02">Step 3-2: Post-Upgrade Tasks for upgrades to 8.4: Upgrade CM Models</h3>
<p>If you're upgrading from any previous version to version 8.4, you'll need to complete the <strong>Upgrade CM Models</strong> configuration action as part of the upgrade process, in all containers where the Community Manager feature is installed.</p>

<h4>To complete the Upgrade CM Models configuration action</h4>
<ol>
	<li>In the Akana Administration Console, click the <strong>Configuration</strong> tab.</li>
	<li>In the <strong>Configuration Actions</strong> section, choose <strong>Upgrade CM Models</strong>.
	<p><strong>Note</strong>: if you get an error after running this process, see <a href="#ts_01_error_some_model_objects">Troubleshooting: error: "Some of the model objects are not updated"</a>.</p></li>
	<li>When done, click <strong>Close</strong>.</li>
</ol>
<p><a href="#top">Back to top</a></p>



<h3 id="s03_04">Step 3-3: Post-Upgrade Task for upgrades to 8.4: Rebuild CM Styles</h3>
<p>As part of every upgrade, if you are using the Community Manager developer portal, you'll need to run the <strong>Rebuild CM Styles</strong> configuration action as part of the upgrade process, in all containers where the Community Manager feature is installed.</p>
<p> This makes sure that you have the latest style updates, for all themes and tenants.</p>
<h4>To rebuild CM styles</h4>
<ol>
	<li>In the Akana Administration Console, click the <strong>Configuration</strong> tab.</li>
	<li>In the <strong>Configuration Actions</strong> section, choose <strong>Rebuild CM Styles</strong>.</li>
	<li>When done, click <strong>Finish</strong>.</li>
</ol>
<p><a href="#top">Back to top</a></p>




<h3 id="s03_05">Step 3-4: Repeat configuration actions for additional containers and restart all containers</h3>
<p>You might need to repeat some of the configuration actions for additional containers.</p>

<h4>To complete configuration actions</h4>
<ol>
	<li>Repeat these tasks as needed for additional containers:
		<ol>
			<li><a href="#s03_01">Step 3-1</a></li>
			<li><a href="#s03_02">Step 3-2</a></li>
			<li><a href="#s03_04">Step 3-3</a></li>
		</ol>
	</li>
	<li>Stop and restart all containers.</li>
</ol>
<p><a href="#top">Back to top</a></p>



<h3 id="s03_06">Step 3-5: Post-Upgrade task when upgrading to 8.4: delete and install object mappings</h3>
<!--<p>{MM 3/27/17: Delete mappings can be done at any time after the upgrade.}</p>-->
<p>Because of specific changes in the Elasticsearch mappings in version 8.3 and 8.4, as part of the upgrade process you'll need to delete the object mappings, and then add the updated mappings. This is because an additional object, Organizations, was added.</p>
<p>You'll need to delete the existing Elasticsearch app and API mappings and then update app, API, and business organization mappings from the installation bundle.</p>
<p>There are three steps to this:</p>
<ol>
	<li>In the Policy Manager console, grant admin permissions to send API calls, to the current user. This is needed so that Step 2 will be successful. If you don't complete this step, the API calls return a 401 (unauthorized) response. See <a href="#s03_06_01">To grant Admin permission</a> below.</li>
	<li>Delete mappings using the API: see <a href="#s03_06_02">To delete mappings using the API</a> below.</li>
	<li>Run a database script: see<a href="#s03_06_03"> To reindex objects using a database script</a> below.</li>
</ol>



<h4 id="s03_06_01">To grant Admin permission</h4>
<ol>
	<li>Log in to the Policy Manager console as the Administrator.</li>
	<li>Click the <strong>Workbench</strong> tab and then, on the left, click <strong>Registry</strong>.</li>
	<li>On the right, click the <strong>Security</strong> tab, as shown below.
<p><img src="images/03_06_01_add_permissions.jpg" alt="Add permissions: Security tab" /></p>
	</li>
	<li>In the right pane, scroll down to the <strong>Role Memberships</strong> section, and find the System Administrator role. On the right, click <strong>Manage Role</strong>, as shown below.
		<p><img src="images/03_06_02_add_permissions.jpg" alt="Add permissions: modifying the permission" /></p>
	</li>
	<li>In the <strong>Object Based Security Role</strong> page, use the search feature to locate the user. In the example below, choosing <strong>Contains</strong> with no value and clicking <strong>Save</strong> returns a full list of users. Click the username in the left pane and click the arrow icon (<strong>&gt;&gt;</strong>) to move the admin user to the right pane, to assign the role.
		<p><img src="images/03_06_03_add_permissions.jpg" alt="Add permissions: assigning user to role" /></p>
	</li>
	<li>Click <strong>Apply</strong>. The admin user now has the System Administrator role and can use the API.</li>
	</ol>
<p><strong>Note</strong>: You can also grant permissions in the Community Manager developer portal: Administration &gt; Users. See <a href="../../cm/learnmore/bus_admin_org_roles.htm#business_assign_roles_to_users">How do I assign security roles to users for my organization?</a> However, you might find that the System Administrator permission isn't displayed on the list.</p>

<h4 id="s03_06_02">To delete mappings using the API</h4>
<p><strong>Note</strong>: When running the API operations below:</p>
<ul>
	<li>Replace <strong>{protocol}:{hostname}</strong> with the URL for the container.</li>
	<li>Log in first. You'll need values from the login response to authenticate so that you can run these operations. For information on the login operation, refer to the API documentation: <span class="apidoc_code"><a href="../../cm/api/login/m_login_login.htm" target="_blank">POST /api/login</a></span>.</li>
	<li>If the client you're using doesn't automatically detect the login cookie (<strong>AtmoAuthToken_{fedmemberid}</strong>), get the cookie from the login response and send it in the request for each of the operations below. See <a href="../../cm/api/index.htm#gettingstarted" target="_blank">Getting Started</a> and <a href="../../cm/api/aaref/Ref_CookiesOnThePlatform.htm#cookies_custom" target="_blank">Session Cookies</a>.</li>
	<li>Get the value from the <strong>Csrf-Token_{fedmemberid}</strong> cookie in the login response, and use it to compose the <strong>X-Csrf-Token_{fedmemberid}</strong> custom header, which you'll need for authentication. See <a href="../../cm/api/aaref/Ref_CSRFPreventionOnThePlatform.htm#sending_the_csrf_token" target="_blank">Sending the CSRF Token</a>.</li>
</ul>
<p><strong>Run the following API operations:</strong></p>
<ol>
	<li>Run the operation below to delete the existing API mappings:
	<pre>Accept: text/plain
DELETE
{protocol}:{hostname}/api/index/default/api/mapping</pre>
	<p>For example: http://open:9900/api/index/default/api/mapping</p></li>
	<li>Run the operation below to delete the existing app mappings:
	<pre>DELETE
{protocol}:{hostname}/api/index/default/app/mapping</pre></li>
	<li>Run the operation below to update the API mappings from the new files in the installation bundle:
	<pre>Content-Type: application/x-www-form-urlencoded
PUT
{protocol}:{hostname}/api/index/default/api/mapping</pre></li>
	<li>Run the operation below to update the app mappings from the new files in the installation bundle:
	<pre>Content-Type: application/x-www-form-urlencoded
PUT
{protocol}:{hostname}/api/index/default/app/mapping</pre></li>
	<li><strong>Upgrade from 8.3 to 8.4 only</strong>: Run the operation below to update the business organization mappings from the installation bundle:
	<pre>Content-Type: application/x-www-form-urlencoded
PUT
{protocol}:{hostname}/api/index/default/business/mapping</pre>
	<p><strong>Note</strong>: Since business organization objects were introduced in version 8.3, you can skip this step if you're upgrading from 8.2 to 8.4.</p>
		</li>
</ol>

<h4 id="s03_06_03">To reindex objects using a database script</h4>
<p>When you've completed the above steps, you'll need to reindex the API, app, and business objects by running this database command:</p>
<pre>delete from {database_name}.INDEX_STATUS where OBJECTTYPE in ('api', 'app', 'business');</pre>
<p><strong>For example:</strong></p>
<p><img src="images/03_06_04.jpg" alt="Example database script to reindex objects" /></p>
<p><a href="#top">Back to top</a></p>



<h3 id="s03_07">Step 3-6: Post-Upgrade Task for upgrades to 8.4: MongoDB Updates</h3>
<p>Version 8.4 includes some changes to the MongoDB database schema. To implement these updates, the upgrade process includes a new configuration action, <strong>Install Configuration Data and Indexes in MongoDB</strong>. Make sure you complete this configuration action along with all others when upgrading.</p>
<p>The upgrade wizard steps you through the configuration action; if you don't complete the installation in one session, be sure to go back and make sure all configuration actions are complete. In the Akana Administration Console, Configuration tab, at the bottom left, the <strong>Configuration Actions</strong> section should be empty when the upgrade process is complete.</p>
<p><a href="#top">Back to top</a></p>



<h3 id="s03_08">Step 3-7: Conditional, MongoDB/OAuth: Post-Upgrade Task for Data Migration</h3>
<p><strong>Note</strong>: This task was introduced in version 8.4.4 and is applicable for upgrades to 8.4.4 and later versions.</p>
<p>If youre migrating from RDBMS to MongoDB and you use OAuth, youll need to run a data migration task, introduced in the upgrade to version 8.4.4, to ensure that OAuth tokens issued before the upgrade can still be used.</p>
<p>After migrating the data, you'll need to update a configuration property and restart the container. Follow the steps below.</p>

<h4>To migrate OAuth data to MongoDB</h4>
<ol>
	<li>In the Akana Administration Console for the Policy Manager/Community Manager instance, <strong>Configuration Actions</strong>, run the <strong>Migrate OAuth Data to MongoDB</strong> task, as shown below.
	<p><img src="images/03_08_01.jpg" alt="Migrate OAuth Data to MongoDB configuration task" /></p></li>
	<li>In the Akana Administration Console, click the <strong>Configuration</strong> tab.</li>
	<li>Under <strong>Configuration Categories</strong>, find the <strong>com.soa.oauth.provider.server</strong> category.</li>
	<li>Find the <strong>com.soa.oauth.provider.server.config.datasource</strong> property and change the value from <strong>JDBC</strong> to <strong>NOSQL</strong>.</li>
	<li>Click <strong>Apply Changes</strong>.</li>
	<li>Restart the Policy Manager/Community Manager container and then, when PM/CM is started, restart the Network Director container.</li>
</ol>
<p>After updating this property, the server for the OAuth Provider is now the NOSQL database (MongoDB).</p>
<p><a href="#top">Back to top</a></p>




<hr class="divide_hr" />
<h2 id="h_upgrade_tasks_reference">Upgrade Procedures/Reference</h2>




<h2 id="support_contact">Contacting Akana Technical Support</h2>
<p>If you need to contact Technical Support, submit an email to <a href="mailto:support@akana.com">support@akana.com</a>.</p>
<p>When sending a support query, please provide the following information:</p>
<ul>
	<li>Your name</li>
	<li>Email address</li>
	<li>Subject</li>
	<li>As much information as possible regarding your question.</li>
</ul>
<p>You'll receive an acknowledgment email and one of our support staff will contact you.</p>
<p>You can also access the Support site at <a href="https://servicedesk.akana.com/servicedesk/customer/user/login" title="Akana technical support site" target="_blank">https://servicedesk.akana.com/servicedesk/customer/user/login</a>.</p>
<p><a href="#top">Back to top</a></p>



<h2 id="container_upgrade_sequence">Container upgrade sequence</h2>
<p>In terms of the sequence of containers, it's best to start by upgrading one of the Policy Manager containers. This accomplishes the database upgrade as well.</p>
<p>After that point, the sequence of containers really doesn't matter. These upgrade instructions suggest the following sequence once the first container has been updated:</p>
<ol>
	<li>First, any additional containers running Policy Manager and/or the API Platform.</li>
	<li>Then, any Network Director or Agent containers.</li>
</ol>
<p>However, the sequence is not important after the first container. You could upgrade the Network Director container at any point. There is no dependency; containers that have been upgraded will work with containers that haven't yet been upgraded. You can even upgrade additional containers in parallel.</p>
<p>Just make sure you upgrade an initial Policy Manager container first, with the associated database upgrade, and then follow any logical approach, making sure that each step completes successfully before starting the next one.</p>
<p><a href="#top">Back to top</a></p>



<h2 id="ts_01_error_some_model_objects">Troubleshooting: error: "Some of the model objects are not updated"</h2>
<p>If your Elasticsearch setup is not complete, you might encounter the message below after running the <strong>Upgrade CM Models</strong> task:</p>
<p><strong>Some of the model objects are not updated. Refer to log files for the specific errors.</strong></p>
<p><img src="images/ts_01_01_some_of_the_model.jpg" alt="Error: Some of the model objects are not upgraded" /></p>
<p>If you encounter this error, follow the steps below:</p>
<ol>
	<li>Make sure that you've installed the <strong>Akana Embedded Elasticsearch Node</strong> feature, shown below.
	<p><img src="images/ts_01_02_some_of_the_model.jpg" alt="Installing the Akana Embedded Elasticsearch Node feature" /></p></li>
	<li>Then, from <strong>Configuration</strong> &gt; <strong>Configuration Actions</strong>, run the <strong>Configure Elasticsearch Global Configuration</strong> task, shown below. This step was required in version 8.2 and is not required in 8.4; but if you are upgrading from 8.2 and didn't complete the step in 8.2, you'll need to complete it now.
		<p><img src="images/ts_01_03_some_of_the_model.jpg" alt="Configure Elasticsearch Global Configuration task" /></p></li>
	<li>In the <strong>Configure Elasticsearch Global Configuration</strong> page, shown below, accept the default values or change as needed, and then click <strong>Finish</strong>.
	<p><img src="images/ts_01_04_some_of_the_model.jpg" alt="Configure Elasticsearch Global Configuration page" /></p></li>
	<li>Run the <strong>Upgrade CM models</strong> task again.</li>
</ol>
<p><a href="#top">Back to top</a></p>



<h2 id="ts_02_error_new_containers">Upgrading by creating a new container and re-using the old container identity: note</h2>
<p>When you're upgrading by creating new containers, and then using the same identity as the old container, it's important that you delete the existing container from the Policy Manager workbench before creating the new container.</p>
<p>If you don't delete the old container before creating the new one, you might encounter an error on the provisioning step, similar to the one shown below (<strong>WSDL binding cannot be disassociated from service</strong>):</p>
<pre>[425] com.digev.fw.exception.GException: Wsdl binding [uddi:4b0aba1c-8ca7-e61c-5575-25361578c179] 
cannot be disassociated from service [uddi:soa.com:metadataattachment-servicekey]. 
Binding is attached to service endpoint.</pre>
<p>If you encounter this message, delete the old container, and then retry the provisioning.</p>
<p>If you're upgrading by creating completely new containers, with a new container identity, this is of course not a problem.</p>
<p><a href="#top">Back to top</a></p>



<hr class="divide_hr" />



<h2 id="related_topics">Related Topics</h2>
<div class="relatedlinks" id="install"><!-- #BeginLibraryItem "/Library/relatedtopics_install.lbi" -->
<ul>
	<li><a href="upgrading_akana_api_platform_all.htm">Upgrading the Akana API Platform (all versions)</a></li>
	<li><a href="upgrading_min_downtime.htm">Use Case: Upgrading with Minimum Downtime</a></li>
	<li><a href="upgrading_micro.htm">Minor-Version Update Notes</a></li>
</ul>
<ul>
	<li><a href="../platform_install/installing_akana_api_platform_all.htm">Installing the Akana API Platform (all versions)</a></li>
	<li><a href="../platform_install/implementation_planning.htm">Planning Your Implementation</a></li>
	<li><a href="../platform_install/install_cm_jython_script.htm">Installation Jython Script</a></li>
	<li><a href="../elasticsearch/install_es_config.htm">Installing and Configuring Elasticsearch</a></li>
	<li><a href="../elasticsearch/install_es_secure_tc.htm">Configuring Elasticsearch with Security</a></li>
</ul><!-- #EndLibraryItem --></div>