---
layout: page
title: Upgrading Akana API Platform 8.4x to 2018.0.x
description: Provides instructions for upgrading from Akana API Platform 8.2 to Akana API Platform 8.4.
product: sp
category: ref
sub-nav-class: Upgrade - Akana API Platform 8.2 and Later
weight: 5
type: page
nav-title: Upgrade 8.4x to 2018.0.x
---
<h2 id="top">Upgrading Akana API Platform from Version 8.4x to Version 2018.0.x</h2>
<p>{<span class="apidoc_red">Draft</span>}</p>
<p>Learn how to upgrade from Akana API Platform 8.4x to 2018.0.x.</p>
<p>In previous versions, upgrade instructions addressed upgrading existing containers. When moving to version 2018.0.x, we recommend that you create new containers. These instructions address the scenario of creating new containers for your 2018.0.x installation.</p>
<p>This upgrade addresses a simple container scenario of:</p>
<ul>
	<li>One container with Policy Manager and Community Manager installed</li>
	<li>One container running the API Gateway (Network Director)</li>
	<li>One container running the scheduled jobs</li>
</ul>
<p><strong>Note</strong>: If you're upgrading Policy Manager for DataPower, follow the steps in this document that you would use for upgrading Network Director.</p>
<p><strong>Note</strong>: This document covers instructions for 2018.0.0. For 8.4x, see <a href="upgrading_akana_api_platform_82_84.htm">Upgrading Akana API Platform from Version 8.2 to Version 8.4x</a>.</p>
<!--<p><strong>Micro-Upgrade</strong>: If you're upgrading to a micro version&#8212;for example, 8.4.1 to 8.4.22&#8212;it's important to follow through the entire upgrade procedure. For additional notes and information about upgrading to a micro version, see <a href="upgrading_micro.htm">Micro-Version Upgrade</a>. {Commenting this out for the initial release of 2018.0.0 as it's inapplicable for an initial release. 9/4/18}</p>-->

<p>
<a href="../admin_console/using_admin_console.htm" class="button secondary">Using Admin Console</a>
<a href="../admin_console/installing_tools.htm" class="button secondary">Installing Tools</a>
<a href="../admin_console/installing_plugins.htm" class="button secondary">Installing Plug-ins</a></p>

<p>
<a href="../../ag/assets/PM_ConfigurationCategories_6x_7x.pdf" class="button secondary">Configuration Categories</a>
<a href="../admin_console/config_actions.htm" class="button secondary">Configuration Actions</a></p>

<h5 class="stamp">Supported Platforms: 2018.0.x</h5>
<div class = "divider1"></div>
<h3 style="color: gray;">Table of Contents</h3>




<h5 style="color: gray;"><a href="#h_upgrade_planning">Planning the Upgrade</a></h5>


<ol class="table_of_contents">
	<li><a href="#s01_00">Overview</a></li>
	<li><a href="#s01_01">Step 1-1: Review release notes</a></li>
	<li><a href="#s01_02">Step 1-2: Plan the upgrade for additional features</a></li>
	<li><a href="#s01_03">Step 1-3: Gather ZIP files and create folder</a></li>
</ol>



<h5 style="color: gray;"><a href="#h_upgrade_performing">Performing the Upgrade</a></h5>



<ol class="table_of_contents">
	<li><a href="#s02_00">Overview</a></li>
	<li><a href="#s02_01">Step 2-1: Turn off scheduled jobs</a></li>
	<li><a href="#s02_02">Step 2-2: Back up and stop all containers for previous version</a></li>
	<li><a href="#s02_03">Step 2-3: Extract new ZIP files in sequence</a></li>
	<li><a href="#s02_04">Step 2-4: Copy applicable version 8.4x files to version 2018 folder</a></li>
	<li><a href="#s02_05">Step 2-5: Clear Configurator cache (if needed)</a></li>
	<li><a href="#s02_06">Step 2-6: Upgrade container</a></li>
	<li><a href="#s02_07">Step 2-7: Upgrade additional containers</a></li>
	<li><a href="#s02_08">Step 2-8: (Conditional): Unregister and re-register the Windows service</a></li>
	<li><a href="#s02_09">Step 2-9: Start the containers</a></li>
	<li><a href="#s02_10">Step 2-10: Clear browser cache</a></li>
	<li><a href="#s02_11">Step 2-11: Launch the Akana Administration Console</a></li>
	<li><a href="#s02_12">Step 2-12: Refresh repository</a></li>
	<li><a href="#s02_13">Step 2-13: Verify that features were updated correctly</a></li>
	<li><a href="#s02_14">Step 2-14: Run pending installation tasks and restart container</a></li>
	<li><a href="#s02_15">Step 2-15: Upgrade all containers before installing the upgrade tool</a></li>
	<li><a href="#s02_16">Step 2-16: Install and run upgrade tool: "Akana 8.4 to 2018 model upgrade" (CM containers only)</a></li>
	<li><a href="#s02_17">Step 2-17: Turn scheduled jobs back on</a></li>
	<li><a href="#s02_18">Step 2-18: Update container metadata and authentication options</a></li>
</ol>



<h5 style="color: gray;"><a href="#h_post_upgrade_tasks">Post-Upgrade Tasks</a></h5>



<ol class="table_of_contents">
	<li><a href="#s03_00">{<span class="apidoc_red">Not sure what will go in this whole section...</span>}</a></li>
	<li><a href="#s03_01">Step 3-1: Post-Upgrade Tasks for upgrades to 8.4: Provisioning</a></li>
	<li><a href="#s03_02">Step 3-2: Post-Upgrade Tasks for upgrades to 8.4: Upgrade CM Models</a></li>
	<li><a href="#s03_04">Step 3-3: Post-Upgrade Task for upgrades to 8.4: Rebuild CM Styles</a></li>
	<li><a href="#s03_05">Step 3-4: Repeat configuration actions for additional containers and restart all containers</a></li>
	<li><a href="#s03_06">Step 3-5: Post-Upgrade task when upgrading to 8.4: delete and install object mappings</a></li>
	<li><a href="#s03_07">Step 3-6: Post-Upgrade Task for upgrades to 8.4: MongoDB Updates</a></li>
	<li><a href="#s03_08">Step 3-7: Conditional, MongoDB/OAuth: Post-Upgrade Task for Data Migration</a></li>
</ol>



<h5 style="color: gray;"><a href="#h_upgrade_tasks_reference">Upgrade Procedures/Reference:</a></h5>



<ol class="table_of_contents">
	<li><a href="#how_do_i_contact_technical_support">Contacting Akana Technical Support</a></li>
	<li><a href="#container_upgrade_sequence">Container upgrade sequence</a></li>
	<li><a href="#ts_02_error_new_containers">Upgrading by creating new containers: notes</a></li>
</ol>




<div class = "divider1"></div>
<h3 id="h_upgrade_planning">Planning the Upgrade</h3>




<h3 id="s01_00">Overview</h3>
<p>In previous versions, upgrade instructions addressed upgrading existing containers. When moving to version 2018.0.0, we recommend that you create new containers. These instructions address the scenario of creating new containers for your 2018.0.x installation.</p>
<p>There are some steps you might need to take before starting the upgrade process, and some information you'll need to consider to determine how to proceed, including:</p>
<ul>
	<li><a href="#s01_01">Review the Akana API Platform release notes.</a></li>
	<li><a href="#s01_02">Plan the upgrade</a></li>
	<li><a href="#s01_03">Gather ZIP files and create folder.</a></li>
	<li>Check if there are any constraints or requirements associated with the type of database you're using, such as permissions required. For details, see <a href="../platform_install/installing_akana_api_platform_v84.htm#database_notes">Database Notes</a> (install doc).</li>
</ul>
<p><a href="#top">back to top</a></p>



<h3 id="s01_01">Step 1-1: Review release notes</h3>
<p>Review the release notes so that you are aware of changes to the platform. Check for upgrade notes.</p>
<p>Release notes are available from the Rogue Wave Support Center (<a href="https://library.roguewave.com" target="_blank">https://library.roguewave.com</a>).</p>
<p><a href="#top">back to top</a></p>



<h3 id="s01_02">Step 1-2: Plan the upgrade</h3>
<p>Before you start downloading and installing, plan your upgrade. In particular, you'll need to:</p>
<ul>
	<li>Decide what containers you'll have, and which features will be installed in which containers. For a recommended simple configuration, see <a href="../deployment/deployment_clustered.htm">Sample Deployment Scenario</a>.</li>
	<li>Determine where you'll install Elasticsearch, needed for the search feature. For full information on Elasticsearch, see <a href="../platform_install/install_es_config.htm">Installing and Configuring Elasticsearch</a>.</li>
	<li>If you have a specific add-on feature installed, such as the Integration Services option pack, SiteMinder Security Provider, or SAML Web SSO Security Provider feature, it's important that you download the new release version package for the same feature.</li>
	<li>Take all steps needed to save out container settings <span class="apidoc_red">xxx</span> so that you can reproduce the configuration on the new container, where applicable. {<span class="apidoc_red">need much more info on this</span>}</li>
</ul>
<p><strong>Note</strong>: <span class="apidoc_red">The SAML Web SSO feature remains at version 8.0. There is no upgrade to version 8.4</span>. {<span class="apidoc_red">this was an old note. Do we have a new SAML now?</span>}</p>
<p>{<span class="apidoc_red">Questions</span>}:</p>
<ol>
	<li><strong>What do they have to note from the previous installation, to reconfigure in the upgraded installation?</strong></li>
	<li><strong>What is the best way to accomplish #1?</strong></li>
	<li><strong>At what point do they switch over the traffic to the new containers?</strong></li>
</ol>
<p><a href="#top">back to top</a></p>



<h3 id="s01_03">Step 1-3: Gather ZIP files {<span class="apidoc_red">file?</span>}and download to a temporary folder</h3>
<p>The first step is to download the required ZIP files&nbsp;and download to a temporary folder. From there, you'll unzip the files into your new installation folder. You'll need to:</p>
<ul>
	<li>Create a temporary folder for the downloaded ZIP file.</li>
	<li>Create a folder for your 2018.0.x installation; for example, <strong>aap201800</strong>.</li>
	<li>Download the ZIP file for version 2018.0.0. </li>
</ul>
<p>Depending on the scenario, you might also need one or more of the following files:</p>
<ul>
	<li><strong>Plug-ins</strong>: The ZIP file, and any updates, for any plug-ins you want to use in your installation.</li>
	<li><strong>Updates</strong>: not applicable to version 2018.0.0 itself, but for future updates.</li>
</ul>
<p>For detailed instructions on this step, refer to the installation guide, <a href="../platform_install/installing_akana_api_platform.htm#gather_zip_files">Gather ZIP files and download to a temporary folder</a>.</p>
<p><strong>Note</strong>: For notes about limitations and extra steps for specific databases, see <a href="../platform_install/installing_akana_api_platform.htm#supported_databases">Supported databases</a> (install doc). If you're using a MySQL database with API Platform and the Lifecycle Repository feature, see <a href="../platform_install/installing_akana_api_platform.htm#notes_database_mysql_rm">Database notes: MySQL with Lifecycle Repository</a>.</p>
<p><a href="#top">back to top</a></p>




<div class = "divider1"></div>
<h3 id="h_upgrade_performing">Performing the Upgrade</h3>




<h3 id="s02_00">Overview</h3>
<p><strong>Note</strong>: The instructions in this document are for upgrade from Akana API Platform 8.4x to Akana API Platform 2018.x. If you're upgrading from an earlier version, you'll need to perform additional steps first, to upgrade to version 8.4. See <a href="upgrading_akana_api_platform_82_84.htm">Upgrading Akana API Platform from Version 8.2 to Version 8.4x</a>.</p>
<p>At a high level, to perform the upgrade, you'll complete the following actions:</p>
<ol>
	<li>Install the Akana API Platform 2018.0.0 in a new location.</li>
	<li>Create </li>
	<li>{<span class="apidoc_red">whatever you need to do to get the properties to the new container</span>}</li>
	<li>Perform the upgrade steps from the AP84 installation, following the exact sequence given below.</li>
</ol>
<p><a href="#top">back to top</a></p>



<h3 id="s02_01">Unzip installation files in the correct sequence</h3>
<p>The next step is to extract the files, following the exact sequence below.</p>
<p><strong>Note</strong>: You'll need a password to unzip the files. If you don't know the&nbsp;password, contact your Akana representative.</p>
<h5>To unzip the installation files</h5>
<ol>
	<li>In the folder for your installation, unzip the Akana Platform 8.4 file.</li>
	<li>In the folder for your installation, unzip the Akana Platform 8.4.11 file.</li>
	<li>In the temporary folder, unzip the Akana Lifecycle Manager 8.0.6 file. The directory structure will include:
		<ul>
			<li>Lifecycle Manager 8.0.6 ZIP file: for example, <strong>lifecyclemanager_8.0.6.xxxxx.zip</strong>.</li>
			<li>Java&nbsp;Clients ZIP file: for example, <strong>javaclients_8.0.6.00410.zip</strong>.</li>
			<li>Other files, such as documentation.</li>
		</ul>
		</li>
	
	<li>From the temporary folder, copy the main Lifecycle Manager file to the folder for your installation.</li>
	<li>In the folder for your installation, unzip the main Lifecycle Manager Platform file.</li>
</ol>
<p>For information about the folders and folder contents for the Akana API Platform, see <a href="../../sp/platform_install/installing_akana_api_platform.htm#installation_folder_structure">Installation folder structure</a>. {<span class="apidoc_red">need to update with the folder structure</span>}</p>
<p><a href="#top">Back to top</a></p>



<h3 id="s02_02">Create containers</h3>
<p>Create the containers in this sequence:</p>
<ol>
	<li>The first Community&nbsp;Manager/Policy Manager container</li>
	<li>Network Director container</li>
	<li>OAuth container</li>
	<li>Scheduled Jobs container</li>
</ol>
<p>{<span class="apidoc_red">check with EN re sequence of creating containers</span>}</p>
<p>To create a container, follow the applicable instructions in the install guide:</p>
<ul>
	<li><a href="../platform_install/installing_akana_api_platform.htm#creating_container_windows">Creating a container via the GUI</a></li>
	<li><a href="../platform_install/installing_akana_api_platform.htm#creating_container_silent">Creating a container using silent install (Linux)</a></li>
</ul>
<p>xxx</p>
<p><a href="#top">back to top</a></p>











<p>---------------------------- old stuff below this line ---</p>



<h3 id="s02_01">Install the PM/ND container</h3>
<p>Before upgrading, you must turn off scheduled jobs in the configuration settings, including the following two scheduled jobs in this sequence:</p>
<ol>
	<li>com.soa.scheduler.quartz</li>
	<li>simple.scheduler.enabled</li>
</ol>
<p>When upgrade is complete, you'll turn these properties back on again (see <a href="#s02_17">Step 2-17: Turn scheduled jobs back on</a>). </p>
<p><strong>Note</strong>: Perform this step for all AP84 containers with Policy Manager features installed.</p>
<h5>To turn off scheduled jobs</h5>
<ol>
	<li>Log in to the Akana Administration Console using Administrator credentials.</li>
	<li>Click the <strong>Configuration</strong> tab.</li>
	<li>In the <strong>Configuration Categories</strong> section, find <strong>com.soa.scheduler.quartz</strong>. </li>
	<li>Locate the <strong>org.quartz.scheduler.enabled</strong> property and change it to <strong>false</strong>.</li>
	<li>Click <strong>Apply Changes</strong>.  </li>
	<li>In the <strong>Configuration Categories</strong> section, find <strong>com.soa.scheduler</strong>. </li>
	<li>Locate the <strong>simple.scheduler.enabled</strong> property and change it to <strong>false</strong>, as shown below.
      <p><img src="images/02_01_config_categ.jpg" alt="Turning off scheduled jobs" /></p></li>
	<li>Click <strong>Apply Changes</strong>.</li>
</ol>
<p><a href="#top">back to top</a></p>



<h3 id="s02_02">Step 2-2: Back up and stop all containers for previous version</h3>
<p>The next step is to back up and stop the current version, before you upgrade. Follow the steps below.</p>
<h5>To back up and stop version 8.4x</h5>
<ol>
	<li>Stop any containers that are currently running. 
<p>This is required to update the database schema to AP82. Stopping the containers ensures that the database is not locked while the update is in progress. For more information, refer to <a href="http://docs.akana.com/sp/container_management/start_stop_container_instance.htm" title="Starting and Stopping a Container Instance" target="_blank">Starting and Stopping a Container Instance</a>.</p></li>
	<li>Back up your AP82 database, using your database management tool, and save the backup file to a safe location. For example, if you're using MySQL, the backup command might look something like the below:
<pre>C:\Program Files\MySQL\MySQL Server 5.6\bin>mysqldump.exe -e -u root -p -h localhost AP82 &gt; C:\backups\ap82-20170331</pre>
</li>
	<li>Back up your AP82 release directory, and save the backup file to a safe location.</li>
</ol>
<p><a href="#top">back to top</a></p>



<h3 id="s02_03">Step 2-3: Extract new ZIP files in sequence</h3>
<p>Now you're ready to install the new version. Make sure you install from the various ZIP files in the correct sequence.</p>
<p><strong>Note</strong>: the filenames used below are examples. When you download files from the Rogue Wave Support Center (<a href="https://library.roguewave.com" target="_blank">https://library.roguewave.com</a>), you might have an updated variation.</p>
<h5>To extract the new ZIP files</h5>
<p><strong>Note</strong>: When unzipping files, if you are prompted to replace a file, choose All to accept all the new files.</p>
<ol>
	<li>Go to the folder with the downloaded ZIP files, which you created earlier. See <a href="#s01_03">Step 1-3: Gather ZIP files and create folder</a>. 
    <p>Make sure the folder includes all the ZIP files you'll need for upgrade. You should have at least two files, and possibly more, as detailed in <a href="#upgrade_zips_82_84">ZIP files for upgrade to version 8.4</a>.</p></li>
	<li><strong>Extract the Akana platform files</strong>:
    <ol>
	<li><strong>Main platform file</strong>: extract <strong>akana-platform-win-jre-8.4.xxx.zip</strong> or comparable file for Linux or other operating system.</li>
	<li><strong>Possible updates</strong>: If there are any updates for the Akana Platform, extract the update next.</li>
</ol></li>
	<li><strong>Extract the Akana API Platform files</strong> (contains all necessary files for Policy Manager and API Platform/Community Manager installation):
<ol>
	<li><strong>Main API Platform file</strong>: extract <strong>akana-api-platform-8.4.xxx.zip</strong>.</li>
	<li><strong>Possible updates</strong>: If there are any updates for the Akana API Platform, extract the update next.</li>
</ol></li>
	<li>Extract the ZIP files for any add-ons you're using.</li>
</ol>
<p><strong>Note</strong>: After the installation is complete, do not launch the Configure Container Instance Wizard/configure the API Platform container until you've completed the next step, below.</p>
<p><a href="#top">back to top</a></p>



<h3 id="s02_04">Step 2-4: Copy applicable version 8.4x files to version 2018.0.0 folder</h3>
<p>The next step is to copy container instances to your new installation.</p>
<p><strong>Note</strong>: Do not copy the Configurator instance.</p>
<h5>To copy version 8.4x files to version 2018.0.0 folder</h5>
<ol>
	<li>Go to the AP84 backup directory, and locate the AP84 container instances. For example:
AP82/instances/{instance}</li>
	<li>Copy the AP84 container instances. Note:
    <ul>
	<li><strong>Include</strong> AP84, Network Director, and Agent container instances. </li>
	<li><strong>Do not include</strong> the AP84 configurator or the AP84 default container folder.
    
    <p>An example is shown below.</p>
<p><img src="images/02_04_update_instances.jpg" alt="Copy container instances" /></p></li>
</ul></li>
	<li>In the AP2018 container instances folder (AP2018/instances/{pm_instance}, paste the container instances that you copied.</li>
	<li>Delete the log folder so that the logs will only include information for the new version, not for the old version.</li>
</ol>
<p><a href="#top">back to top</a></p>



<h3 id="s02_05">Step 2-5: Clear Configurator cache (if needed)</h3>
<p>Before performing the upgrade, make sure the configurator cache is clear. At this point, there won't be any cache unless you launched the Configurator at the end of <a href="#s02_03">Step 2-3</a>. To be sure, follow the steps below.</p>
<h5>To clear configurator cache</h5>
<ol>
	<li>Locate the configurator cache folder: \instances\configurator\cache, as shown below.
<p><img src="images/02_05_configurator_cache.jpg" alt="Configurator cache folder" /></p></li>
	<li>Delete the folder if it exists (if there is no cache, the folder will not be there).</li>
</ol>
<p><a href="#top">back to top</a></p>



<h3 id="s02_06">Step 2-6: Upgrade container</h3>
<p>You'll need to perform the upgrade procedure on each container you're upgrading to AP84, using the <strong>Configure Container Instance</strong> wizard.</p>
<p><strong>Note</strong>: These instructions follow a sequence of upgrading the first Policy Manager container, then additional Policy Manager and Community Manager containers, and then Network Director and Agent containers. However, once you've done an initial Policy Manager upgrade to upgrade the database, the sequence of containers really doesn't matter. See <a href="#container_upgrade_sequence">Container upgrade sequence</a> below.</p>
<p><strong>Note</strong>: Before you upgrade, make sure you've completed all previous steps, including copying the container instances (see <a href="#s02_04">Step 2-4: Copy applicable version 8.4 files to version 2018 folder</a>).</p>
<p>There are three ways you can upgrade the container:</p>
<ul>
	<li>Via the user interface: see <a href="#s02_06_01">Upgrade container to Akana API Platform 8.4 (GUI)</a>.</li>
	<li>Silent upgrade: see <a href="#s02_06_02">Upgrade container to Akana API Platform 8.4 (silent upgrade)</a>.</li>
	<li>Command line upgrade: see <a href="#s02_06_03">Upgrade container to Akana API Platform 8.4 (command line)</a>.</li>
</ul>


<h3 id="s02_06_01">Upgrade container to Akana API Platform 8.4 (GUI)</h3>
<p>Upgrade via the GUI launches the Configurator wizard, which walks you through the upgrade process.</p>
<h5>To upgrade the container to Akana API Platform 8.4 (via the GUI)</h5>
<ol>
	<li>Open up a command prompt.</li>
	<li>Go to the new folder where you unzipped the version 8.4 files, then navigate to the \bin subfolder and run the following command:
<pre>startup configurator</pre></li>
	<li>The Configurator starts, and the <strong>Welcome to Configure Container Instance Wizard</strong> page displays. Click <strong>Next</strong>.</li>
	<li>At the Instance Name screen, specify the name of the Akana container instance the upgrade will be applied to, as shown in the example below (same name as previous installation). Leave the Container Key field blank; the upgrade process will use the container key for the container being upgraded. Click <strong>Next</strong>.
<p><img src="images/02_06_01_InstanceName.jpg" alt="Instance Name page" /></p></li>
	<li>At the <strong>Instance Already Exists page</strong>, to apply the AP82 to AP84 upgrade, click <strong>Update</strong>, as shown below, and then click <strong>Next</strong>.
<strong>Note</strong>: This updates the instance you copied over in <a href="#s02_04">Step 2-4: Copy applicable version 8.2 files to version 8.4 folder</a>.
<p><img src="images/02_06_02_instance_already_exists.jpg" alt="Instance Already Exists message" /></p></li>
	<li>At the <strong>Instance Configuration Summary</strong> page, shown below, verify that the instance has been stopped, and then click <strong>Finish</strong>.
<p><img src="images/02_06_03_Instance_Config_Summary.jpg" alt="Instance Configuration Summary page" /></p></li>
	<li>When the container update process is complete, the <strong>Update Complete</strong> page displays with a summary of the number of bundles that were updated.</li>
	<li>Click <strong>OK</strong> to close the wizard.</li>
</ol>
<p><a href="#top">back to top</a></p>



<h3 id="s02_06_02">Upgrade container to Akana API Platform 8.4 (silent upgrade)</h3>
<p>You can set up the Configure Container Instance Wizard update process to run in an automated mode (silent mode).</p>
<p>To do this you essentially need to set up a properties file that contains a set of property values that the wizard uses to automatically configure a container instance.</p>
<h5>To upgrade to Akana API Platform 8.4 using silent mode</h5>
<ol>
	<li>Define a properties file for upgrade in silent mode:
<ol>
	<li>Choose a file name; for example, upgrade.properties.</li>
	<li>In the file, add the following default content:
<pre>container.instance.name=[container_instance_name]
wizard.mode=update</pre>
<p>For example:</p>
<pre>container.instance.name=policymanager
wizard.mode=update</pre></li>
</ol></li>
	<li>Determine system properties you want to use when running the upgrade in silent mode. There are two possible properties, which together are used to perform the silent upgrade:
<ol>
	<li>silent (If true, silent configuration will be performed)</li>
	<li>properties (path/filename for properties file to be used for configuration)</li>
</ol></li>
	<li>Run the upgrade in silent mode, using either of the following commands, depending on the operating system:
<ul>
	<li>Windows:
<pre>\bin>startup.bat configurator "-Dsilent=true" "-Dproperties={property file directory location}\upgrade.properties"</pre></li>
	<li>Unix:
<pre>/bin>startup.sh configurator -Dsilent=true -Dproperties=opt/{property file directory location}/upgrade.properties</pre></li>
</ul></li>
	<li>Repeat for Network Director or Agent containers:
<ol>
	<li>Before upgrading each instance, clear configurator cache. See <a href="#s02_05">Step 2-5: Clear Configurator cache (if needed)</a>.</li>
	<li>Then, for each container, repeat the steps above.</li>
</ol></li>
	<li>Optional post-upgrade step for silent mode users not using the Admin Console:
<ol>
	<li>If you will not be using the Akana Administration Console, you can install the Policy Manager 8.4.0 schema manually using a third-party database schema management tool.</li>
	<li>For assistance in installing the schema, contact Akana Customer Support.</li>
</ol></li>
</ol>
<p><strong>Note</strong>: If you are not using the Akana Administration Console, you are done with the upgrade; skip the rest of the upgrade steps.</p>


<h3 id="s02_06_03">Upgrade container to Akana API Platform 8.4 (command line)</h3>
<p>You can also perform the upgrade process from the command line. Follow the steps below.</p>
<h5>To upgrade to Akana API Platform 8.4 from the command line</h5>
<ol>
	<li>Execute the following in the \bin folder depending on your operating system:
<ul>
	<li>Windows:
<pre>startup.bat configurator "-Dsilent=true" "-Dcontainer.instance.name={Instance name}"  "-Dwizard.mode=update"</pre></li>
	<li>Unix:
<pre>startup.sh configurator -Dsilent=true -Dcontainer.instance.name={instance name} -Dwizard.mode=update</pre></li>
</ul></li>
</ol>
<p><a href="#top">back to top</a></p>



<h3 id="s02_07">Step 2-7: Upgrade additional containers</h3>
<p>Repeat the upgrade process for all additional containers. A suggested sequence is:</p>
<ol>
	<li>First, any additional containers running Policy Manager and/or the API Platform.</li>
	<li>Then, any Network Director or Agent containers.</li>
</ol>
<p><strong>Note</strong>: These instructions follow a sequence of upgrading the first Policy Manager container, then additional Policy Manager and Community Manager containers, and then Network Director and Agent containers. However, once you've done an initial Policy Manager upgrade to upgrade the database, the sequence of containers really doesn't matter. See <a href="#container_upgrade_sequence">Container upgrade sequence</a> below.</p>

<h5>To upgrade additional containers</h5>
<ol>
	<li>Before upgrading each instance, clear configurator cache. See <a href="#s02_05">Step 2-5: Clear Configurator cache (if needed)</a>.</li>
	<li>Then, for each container, repeat <a href="#s02_06">Step 2-6: Upgrade container</a>.</li>
</ol>
<p><a href="#top">back to top</a></p>



<h3 id="s02_08">Step 2-8: (Conditional, Windows only): Unregister and re-register the Windows service</h3>
<p>If your containers are registered as a Windows service, so that the container will start automatically when Windows starts, you must unregister the old version and register the new version, for each container.</p>
<p>If you're not sure which containers are registered as a Windows service, you can check in the Windows Control Panel (<strong>Administrative Tools</strong> &gt; <strong>Services</strong>). To change the services, you must run as Administrator.</p>

<h5 id="proc_register_unregister_windows">To unregister and register the Windows service</h5>
<ol>
	<li>Open a command prompt in Administrator mode (If you don't use Administrator mode, Windows prompts for Admin permission before unregistering/registering the service, but doesn't actually start the service).</li>
	<li>Unregister the previous version as a windows service:
    <pre>.\{AP82_install_folder}\bin\unregisterContainerServiceYAJWS.bat {instance_name}</pre></li>
	<li>Register the new version as a Windows service:
  <pre>.\{AP84_install_folder}\bin\registerContainerServiceYAJWS.bat {instance_name}</pre></li>
	<li>If you're running in Administrator mode, Windows registers the service and also starts it.  </li>
	<li>Repeat steps 2 and 3 for each additional container that's registered as a Windows service.</li>
</ol>
<p><a href="#top">back to top</a></p>



<h3 id="s02_09">Step 2-9: Start the containers</h3>
<p><strong>Note</strong>: If you registered your containers as Windows services, in the previous step, the containers should already be running.</p>
There are several ways you can start a container: Windows, as Windows service, or Unix. Follow the applicable procedure below.
<h5>To start the container (Windows)</h5>
<ol>
	<li>Navigate to the \{AP84_install_folder}\bin\ folder.</li>
	<li>Type the following:
<pre>startup {instance_name}</pre></li>
</ol>
<h5>To start the container (as Windows service)</h5>
<ol>
	<li>Launch the Program Group (<strong>Settings</strong> &gt; <strong>Control Panel</strong> &gt; <strong>Administrative Tools</strong> &gt; <strong>Services</strong>).</li>
	<li>Select the Akana Container Instance (the instance name is displayed as the Container Key).</li>
	<li>From the <strong>Actions</strong> menu, select <strong>Start</strong>.</li>
</ol>
<h5>To start the container (Unix)</h5>
<ol>
	<li>Navigate to the /{AP84_install_folder}/bin/ folder.</li>
	<li>Type the following:
<pre>startup.sh {instance_name}</pre></li>
</ol>
<h5>To start the container (Unix, Background)</h5>
<ol>
	<li>Navigate to the /bin folder.</li>
	<li>Type the following:
<pre>startup.sh {instance_name} -bg</pre></li>
</ol>
<p><a href="#top">back to top</a></p>



<h3 id="s02_10">Step 2-10: Clear browser cache</h3>
<p>Before launching the Akana Administration Console, clear the browser cache and then refresh the page, or start a new session in a browser private window. This ensures that you see the user interface changes included in the update.</p>
<p>This completes the product installation. The next steps walk you through additional updates you'll need to make to complete the process, including updating database schemas and data.</p>
<p><a href="#top">back to top</a></p>



<h3 id="s02_11">Step 2-11: Launch the Akana Administration Console</h3>
<p>Now it's time to launch the Administration Console and complete the installation tasks.</p>
<p><strong>Note</strong>: The rest of the installation tasks are completed on containers running PM/CM only. There is no need to run them on Network Director containers.</p>
<h5>To launch the Akana Administration Console</h5>
<ol>
	<li>Launch the Akana Administration Console for the updated container instance:
<pre>http://{hostname}:{port}/admin</pre></li>
	<li>Log in to the Akana Administration Console as an Administrator. The Akana Administration Console launches and displays the <strong>Available Features</strong> tab, as shown below.
<p><img src="images/02_11_Available_Features_Tab.jpg" alt="Available Features tab" /></p></li>
</ol>
<p><a href="#top">back to top</a></p>



<h3 id="s02_12">Step 2-12: Refresh repository</h3>
<p>Verify that the repository is there. Refresh if needed.</p>
<h5>To verify/refresh the repository</h5>
<ol>
	<li>Click the <strong>Repository</strong> tab and verify that the <strong>Akana Platform Repository 8.4.0</strong> and the <strong>Akana API Platform Repository 8.4.0</strong> are both present, as shown below.
    <p><img src="images/02_12_repository.jpg" alt="Repository tab" /></p></li>
	<li>Conditional: if you don't see both these repositories, click <strong>Refresh</strong> to update.</li>
</ol>
<p>Further installation steps are conditional:</p>
<ul>
	<li>If your container <strong>doesn't</strong> have Policy Manager features installed (Akana Policy Manager Console and Akana Policy Manager Services), the upgrade is complete. </li>
	<li>If your container <strong>does</strong> have Policy Manager features installed (Akana Policy Manager Console and Akana Policy Manager Services), continue.</li>
</ul>
<p><a href="#top">back to top</a></p>



<h3 id="s02_13">Step 2-13: Verify that features were updated correctly</h3>
<p>At this point, check that all the features installed in your implementation have been correctly upgraded to the new version you're installing:</p>
<ol>
	<li>In the Akana Administration Console, go to<strong> Installed Features</strong>.</li>
	<li>Look at the <strong>Version</strong> column to make sure each feature has the correct version number. An example is shown below.
<p><img src="images/02_13_features_installed.jpg" alt="8.4 features installed tab" /></p>
  </li>
</ol>
<p>If there are any issues, check that you followed all steps correctly.</p>
<p>If needed, <a href="#how_do_i_contact_technical_support">contact Technical Support</a>.</p>
<p><a href="#top">back to top</a></p>



<h3 id="s02_14">Step 2-14: Run pending installation tasks and restart container</h3>
<p>Once you've installed and configured the Policy Manager features (Akana Policy Manager Console and Akana Policy Manager Services) on your container, the next step is to run any pending installation tasks. Some tasks start automatically; some might need to be started manually.</p>
<p>Pending Installation tasks should include at least the below:</p>
<ul>
	<li><strong>Manage Schemas</strong>: Updates the database schemas for the new version. This task needs to be done only once.</li>
</ul>
<h5>To run pending installation tasks</h5>
<p><strong>Note</strong>: Pending installation tasks might vary according to your upgrade process. When you click <strong>Complete Configuration</strong>, the upgrade process leads you through tasks.</p>
<ol>
	<li>In the Akana Administration Console, go to<strong> Installed Features</strong> &gt; <strong>Pending Installation Tasks</strong>. At the bottom left, click <strong>Complete Configuration</strong>, as shown below.
<p><img src="images/02_14_01_admin_console_installedfeatures.jpg" alt="Click Complete Configuration" /></p></li>
	<li>The <strong>Manage Schemas</strong> wizard starts. In the <strong>Available Schemas</strong> section, add the schemas listed. It should look something like the below. There might be variations depending on the features you're using. Click <strong>Finish</strong>.
    <p><img src="images/02_14_02_available_schemas.jpg" alt=" Available Schemas section" /></p></li>
	<li>The schemas are installed. At the summary page, click <strong>Next Task</strong> if there is another task. Otherwise, click <strong>Finish</strong>.</li>
	<li>Restart the container.
    <strong>Note</strong>: If the container doesn't restart automatically, restart it manually.</li>
	<li>Check to make sure all the bundles have started correctly: In the Admin Console, go to the <strong>System</strong> tab. It should show a lifecycle state of STARTED for all bundles, with no errors listed, as shown below.
  <p><img src="images/02_14_03_CheckBundlesRestarted.jpg" alt="Check that bundles are running" /></p></li>
</ol>
<p><a href="#top">back to top</a></p>



<h3 id="s02_15">Step 2-15: Upgrade additional containers</h3>
<p>Make sure:</p>
<ul>
	<li>All containers are upgraded.</li>
	<li>Pending installation tasks are complete for all containers.</li>
	<li>All bundles start correctly for each container.</li>
</ul>
<p>Essentially, make sure all steps, from <a href="#s02_05">Step 2-5: Clear Configurator cache (if needed)</a> through to <a href="#s02_14">Step 2-14: Run pending installation tasks and restart container</a>, are complete for every container.</p>
<p><a href="#top">back to top</a></p>



<h3 id="s02_16">Step 2-16: Install and run upgrade tool: "Akana 8.2 to 8.4 model upgrade" (CM containers only)</h3>
<p>{<span class="apidoc_red">Not sure if there is a comparable step for upgrade to 2018.0.0: research. Note 9/4/18</span>}</p>
<!--<p>{{<span class="apidoc_red">MM 3/27/17: Upgrade CM Models need to be run once, order should not matter.</span>}}</p>-->
<p>The next step is to run the 8.2 to 8.4 upgrade tool, to update database objects from version 8.2 to 8.4.</p>
<p>This step is applicable only if Community Manager is installed on the container. If the container doesn't include Community Manager, skip to <a href="#s02_17">Step 2-17: Turn scheduled jobs back on</a>.</p>
<p>Before running this tool, change the <strong>failure.data.capture.enabled</strong> setting in the configuration file. Changing this setting will save memory for logging events during the upgrade process. It's important to change this setting; if you don't, there might be memory issues during upgrade. If you want to, you can change the setting back afterwards. When set to <strong>true</strong>, this setting indents entries in the log file.</p>
<p>Follow these three steps:</p>
<ol>
	<li><a href="#s02_16_01">Step A: To turn off the <strong>failure.data.capture.enabled</strong> configuration setting</a></li>
	<li><a href="#s02_16_02">Step B: To install and run the 8.2 to 8.4 upgrade tool</a></li>
	<li><a href="#s02_16_03">Step C: To restore the <strong>failure.data.capture.enabled</strong> configuration setting</a></li>
</ol>
<p><strong>Note</strong>: Perform these steps only once, on one container that has database connectivity and has Policy Manager Service installed.</p>


<h5 id="s02_16_01">Step A: To turn off the failure.data.capture.enabled configuration setting</h5>
<ol>
	<li>Log in to the Akana Administration Console for your upgraded installation, using Administrator credentials.</li>
	<li>Click the <strong>Configuration</strong> tab.</li>
	<li>On the left, under <strong>Configuration Categories</strong>, find the <strong>com.soa.framework</strong> category.</li>
	<li>Locate the <strong>failure.data.capture.enabled</strong> property and change it to <strong>false</strong>, as shown below.
      <p><img src="images/02_16_01_failure_data_captured.jpg" alt="Changing the failure.data.capture.enabled property" /></p></li>
	<li>Click <strong>Apply Changes</strong>.</li>
</ol>

<h5 id="s02_16_02">Step B: To install and run the 8.2 to 8.4 upgrade tool</h5>
<ol>
	<li>Launch the Akana Administration Console for your upgraded installation, using Administrator credentials.</li>
	<li>Click the <strong>Available Features</strong> tab.</li>
	<li>From the <strong>Filter</strong> drop-down, select <strong>Tool</strong>.</li>
	<li>Select <strong>Akana 8.2 to 8.4 model upgrade</strong>, as shown below, and click <strong>Install Feature</strong>. The upgrade tool is installed.
      <p><img src="images/02_16_02_Upgrade_Tool.jpg" alt="8.2 to 8.4 upgrade tool" /></p></li>
	<li>At the <strong>Installation Complete</strong> message, click <strong>Configure</strong>.</li>
	<li>At the <strong>Perform 8.2 to 8.4 upgrade</strong> page, make sure <strong>Upgrade APIs</strong> is checked, as shown below, and click <strong>Finish</strong>.
    <p><img src="images/02_16_03_UpgradeTool.jpg" alt="Upgrade tool configuration" /></p></li>
	<li>At the system restart prompt, click <strong>OK</strong> to restart.</li>
</ol>


<h5 id="s02_16_03">Step C: To restore the failure.data.capture.enabled configuration setting</h5>
<p>Log in to the Akana Administration Console, using the instructions in <a href="#s02_16_01">Step A: To turn off the <strong>failure.data.capture.enabled</strong> configuration setting</a>. Change the setting back to <strong>true</strong>, and save the changes.</p>
<p><a href="#top">back to top</a></p>



<h3 id="s02_17">Step 2-17: Turn scheduled jobs back on</h3>
<p>Now it's time to turn back on the properties that you turned off in <a href="#s02_01">Step 2-1</a>. Restart the scheduled jobs in the opposite sequence; first the simple scheduler, and then the Quartz scheduler.</p>
<p><strong>Note</strong>: Perform this step for all the AP82 containers with Policy Manager features installed, which have now been upgraded to AP84. Before performing this step, make sure the container was restarted.</p>
<h5>To turn scheduled jobs back on</h5>
<ol>
	<li>Log in to the Akana Administration Console using Administrator credentials.</li>
	<li>Click the <strong>Configuration</strong> tab.</li>
	<li>In the Configuration Categories section, find <strong>com.soa.scheduler</strong>. </li>
	<li>Locate the <strong>simple.scheduler.enabled</strong> property and change it to <strong>true</strong>.</li>
	<li>Click <strong>Apply Changes</strong>.</li>
	<li>In the <strong>Configuration Categories</strong> section, find <strong>com.soa.scheduler.quartz</strong>. </li>
	<li>Locate the <strong>org.quartz.scheduler.enabled</strong> property and change it to <strong>true</strong>.</li>
	<li>Click <strong>Apply Changes</strong>.</li>
</ol>
<p><a href="#top">back to top</a></p>



<h3 id="s02_18">Step 2-18: Update container metadata and authentication options</h3>
<p>The final step in the upgrade process is to update the Metadata URL and Authentication Options of each container you upgraded, in Policy Manager. This updates the container capabilities to support the latest features.</p>
<h5>To update container metadata and authentication options</h5>
<ol>
	<li>Log in to the Policy Manager Management Console as the Administrator.</li>
	<li>In the left pane, from the <strong>Containers</strong> folder, select the AP84 container.</li>
	<li>In the right pane, from the <strong>Actions</strong> Portlet, select <strong>Update Container Metadata</strong>, as shown below.
<p><img src="images/02_18_01_update_container_metadata.jpg" alt="Update Container Metadata" /></p></li>
	<li>Enter the metadata URL for the container being updated (<strong>http://{pm_host}:{pm_port}/metadata</strong> or <strong>http://{nd_host}:{nd_port}/metadata</strong>), or the metadata path for the Network Director. An example is shown below.
<p><img src="images/02_18_02_metadata_import.jpg" alt="Metadata path for the ND" /></p></li>
	<li>Conditional: If Authentication options are being used or updated, select the authentication options.</li>
	<li>If the metadata URL is not accessible from Policy Manager, you can update the metadata from a file:
<ol>
	<li>First, access the metadata URL from a machine that has access to the container and save the metadata document to a file.</li>
	<li>Then, upload the file to Policy Manager.</li>
</ol></li>
</ol>
<p>That completes the upgrade.</p>
<p>After upgrading, run the post-install tasks on one of the containers with the Akana API Platform feature installed, as covered in the next group of tasks.</p>
<p><a href="#top">back to top</a></p>




<div class = "divider1"></div>
<h3 id="h_post_upgrade_tasks">Post-Upgrade Tasks</h3>




<h3 id="s03_00">Upgrade tasks when upgrading to 8.4: Overview</h3>
<p>Once you've completed the product version update, there are additional post-upgrade tasks you'll need to complete. Run these tasks on one of the containers with the Akana API Platform feature installed. Some of these steps are conditional depending on platform features you're using. They include:</p>
<ul>
	<li><a href="#s03_01">Step 3-1: Post-Upgrade Tasks for upgrades to 8.4: Provisioning</a></li>
	<li><a href="#s03_02">Step 3-2: Post-Upgrade Tasks for upgrades to 8.4: Upgrade CM Models</a></li>
	<li><a href="#s03_04">Step 3-3: Post-Upgrade Task for upgrades to 8.4: Rebuild CM Styles</a></li>
	<li><a href="#s03_05">Step 3-4: Repeat configuration actions for additional containers and restart all containers</a></li>
	<li><a href="#s03_06">Step 3-5: Post-Upgrade task when upgrading to 8.4: delete and install object mappings</a></li>
	<li><a href="#s03_07">Step 3-6: Post-Upgrade Task for upgrades to 8.4: MongoDB Updates</a></li>
	<li><a href="#s03_08">Step 3-7: Conditional, MongoDB/OAuth: Post-Upgrade Task for Data Migration</a></li>
</ul>
<p><a href="#top">back to top</a></p>



<h3 id="s03_01">Step 3-1: Post-Upgrade Tasks for upgrades to 8.4: Provisioning</h3>
<p>If you're upgrading from any previous version to version 8.4, you'll need to complete the <strong>Provisioning</strong> task as part of the upgrade process,  in all containers where the Policy Manager feature is installed.</p>
<p>The provisioning step must be completed for each container running PM/CM.</p>
<h5>To complete the Provisioning configuration action</h5>
<ol>
	<li>In the Akana Administration Console, click the <strong>Configuration</strong> tab.</li>
	<li>In the <strong>Configuration Actions</strong> section, choose the <strong>Provisioning</strong> configuration action, as shown below.
  <p><img src="images/03_01_Manual_Provisioning.jpg" alt="Running Provisioning manually" /></p></li>
	<li>On the <strong>Provisioning</strong> page, make sure <strong>Perform Provisioning</strong> is checked, as shown below, and then click <strong>Finish</strong>.
  <p><img src="images/03_02_provisioning.jpg" alt="Provisioning Summary" /></p></li>
	<li>When provisioning is complete, click <strong>Close</strong>.  </li>
</ol>
<p><a href="#top">back to top</a></p>



<h3 id="s03_02">Step 3-2: Post-Upgrade Tasks for upgrades to 8.4: Upgrade CM Models</h3>
<p>If you're upgrading from any previous version to version 8.4, you'll need to complete the <strong>Upgrade CM Models</strong> configuration action as part of the upgrade process, in all containers where the Community Manager feature is installed.</p>

<h5>To complete the Upgrade CM Models configuration action</h5>
<ol>
	<li>In the Akana Administration Console, click the <strong>Configuration</strong> tab.</li>
	<li>In the <strong>Configuration Actions</strong> section, choose  <strong>Upgrade CM Models</strong>.</li>
	<li>When done, click <strong>Close</strong>.</li>
</ol>
<p><a href="#top">back to top</a></p>



<h3 id="s03_04">Step 3-3: Post-Upgrade Task for upgrades to 8.4: Rebuild CM Styles</h3>
<p>As part of every upgrade, if you are using the developer portal, you'll need to run the <strong>Rebuild CM Styles</strong> configuration action as part of the upgrade process, in all containers where the Community Manager feature is installed.</p>
<p> This makes sure that you have the latest style updates, for all themes and tenants.</p>
<h5>To rebuild CM styles</h5>
<ol>
	<li>In the Akana Administration Console, click the <strong>Configuration</strong> tab.</li>
	<li>In the <strong>Configuration Actions</strong> section, choose <strong>Rebuild CM Styles</strong>.</li>
	<li>When done, click <strong>Finish</strong>.</li>
</ol>
<p><a href="#top">back to top</a></p>




<h3 id="s03_05">Step 3-4: Repeat configuration actions for additional containers and restart all containers</h3>
<p>You might need to repeat some of the configuration actions for additional containers.</p>

<h5>To complete configuration actions</h5>
<ol>
	<li>Repeat these tasks as needed for additional containers:
    <ol>
    	<li><a href="#s03_01">Step 3-1</a></li>
    	<li><a href="#s03_02">Step 3-2</a></li>
    	<li><a href="#s03_04">Step 3-3</a></li>
    </ol>
  </li>
	<li>Stop and restart all containers.</li>
</ol>
<p><a href="#top">back to top</a></p>



<h3 id="s03_06">Step 3-5: Post-Upgrade task when upgrading to 8.4: delete and install object mappings</h3>
<!--<p>{MM 3/27/17: Delete mappings can be done at any time after the upgrade.}</p>-->
<p>Because of specific changes in the Elasticsearch mappings in version 8.3 and 8.4, as part of the upgrade process you'll need to delete the object mappings, and then add the updated mappings. This is because an additional object, Organizations, was added.</p>
<p>You'll need to delete the existing Elasticsearch app and API mappings and then update app, API, and business organization mappings from the installation bundle.</p>
<p>There are three steps to this:</p>
<ol>
	<li>In the Policy Manager console, grant admin permissions to send API calls, to the current user. This is needed so that Step 2 will be successful. If you don't complete this step, the API calls return a 401 (unauthorized) response. See <a href="#s03_06_01">To grant Admin permission</a> below.</li>
	<li>Delete mappings using the API: see <a href="#s03_06_02">To delete mappings using the API</a> below.</li>
	<li>Run a database script: see<a href="#s03_06_03"> To reindex objects using a database script</a> below.</li>
</ol>



<h5 id="s03_06_01">To grant Admin permission</h5>
<ol>
	<li>Log in to the Policy Manager console as the Administrator.</li>
	<li>Click the <strong>Workbench</strong> tab and then, on the left, click <strong>Registry</strong>.</li>
	<li>On the right, click the <strong>Security</strong> tab, as shown below.
<p><img src="images/03_06_01_add_permissions.jpg" alt="Add permissions: Security tab" /></p>
  </li>
	<li>In the right pane, scroll down to the <strong>Role Memberships</strong> section, and find the System Administrator role. On the right, click <strong>Manage Role</strong>, as shown below.
    <p><img src="images/03_06_02_add_permissions.jpg" alt="Add permissions: modifying the permission" /></p>
  </li>
	<li>In the <strong>Object Based Security Role</strong> page, use the search feature to locate the user. In the example below, choosing <strong>Contains</strong> with no value and clicking <strong>Save</strong> returns a full list of users. Click the username in the left pane and click the arrow icon (<strong>&gt;&gt;</strong>) to move the admin user to the right pane, to assign the role.
    <p><img src="images/03_06_03_add_permissions.jpg" alt="Add permissions: assigning user to role" /></p>
  </li>
	<li>Click <strong>Apply</strong>. The admin user now has the System Administrator role and can use the API.</li>
  </ol>
<p><strong>Note</strong>: You can also grant permissions in the developer portal: Administration &gt; Users. See <a href="http://docs.akana.com/cm/learnmore/bus_admin_organizations.htm#business_assign_roles_to_users">How do I assign security roles to users for my organization?</a> However, you might find that the System Administrator permission isn't displayed on the list.</p>

<h5 id="s03_06_02">To delete mappings using the API</h5>
<p><strong>Note</strong>: When running the API operations below:</p>
<ul>
	<li>Replace <strong>{protocol}:{hostname}</strong> with the URL for the container.</li>
	<li>Log in first. You'll need values from the login response to authenticate so that you can run these operations. For information on the login operation, refer to the API documentation: <span class="apidoc_code"><a href="http://docs.akana.com/cm/api/login/m_login_login.htm" target="_blank">POST /api/login</a></span>.</li>
	<li>If the client you're using doesn't automatically detect the login cookie (<strong>AtmoAuthToken_{fedmemberid}</strong>), get the cookie from the login response and send it in the request for each of the operations below. See <a href="http://docs.akana.com/cm/api/index.htm#gettingstarted" target="_blank">Getting Started</a> and <a href="http://docs.akana.com/cm/api/aaref/Ref_CookiesOnThePlatform.htm#cookies_custom" target="_blank">Session Cookies</a>.</li>
	<li>Get the value from the <strong>Csrf-Token_{fedmemberid}</strong> cookie in the login response, and use it to compose the <strong>X-Csrf-Token_{fedmemberid}</strong> custom header, which you'll need for authentication. See <a href="http://docs.akana.com/cm/api/aaref/Ref_CSRFPreventionOnThePlatform.htm#sending_the_csrf_token" target="_blank">Sending the CSRF Token</a>.</li>
</ul>
<p><strong>Run the following API operations:</strong></p>
<ol>
	<li>Run the operation below to delete the existing API mappings:
  <pre>Accept: text/plain
DELETE
{protocol}:{hostname}/api/index/default/api/mapping</pre>
  <p>For example: http://open:9900/api/index/default/api/mapping</p></li>
	<li>Run the operation below to delete the existing app mappings:
  <pre>DELETE
{protocol}:{hostname}/api/index/default/app/mapping</pre></li>
	<li>Run the operation below to update the API mappings from the new files in the installation bundle:
  <pre>Content-Type: application/x-www-form-urlencoded
PUT
{protocol}:{hostname}/api/index/default/api/mapping</pre></li>
	<li>Run the operation below to update the app mappings from the new files in the installation bundle:
  <pre>Content-Type: application/x-www-form-urlencoded
PUT
{protocol}:{hostname}/api/index/default/app/mapping</pre></li>
	<li><strong>Upgrade from <span class="apidoc_red">8.3 to 8.4</span> only</strong>: Run the operation below to update the business organization mappings from the installation bundle:
  <pre>Content-Type: application/x-www-form-urlencoded
PUT
{protocol}:{hostname}/api/index/default/business/mapping</pre>
  <p><strong>Note</strong>: Since business organization objects were introduced in version 8.3, you can skip this step if you're upgrading from 8.2 to 8.4.</p>
    </li>
</ol>

<h5 id="s03_06_03">To reindex objects using a database script</h5>
<p>When you've completed the above steps, you'll need to reindex the API, app, and business objects by running this database command:</p>
<pre>delete from {database_name}.INDEX_STATUS where OBJECTTYPE in ('api', 'app', 'business');</pre>
<p><strong>For example:</strong></p>
<p><img src="images/03_06_04.jpg" alt="Example database script to reindex objects" /></p>
<p><a href="#top">back to top</a></p>



<h3 id="s03_07">Step 3-6: Post-Upgrade Task for upgrades to 8.4: MongoDB Updates</h3>
<p>Version 8.4 includes some changes to the MongoDB database schema. To implement these updates, the upgrade process includes a new configuration action, <strong>Install Configuration Data and Indexes in MongoDB</strong>. Make sure you complete this configuration action along with all others when upgrading.</p>
<p>The upgrade wizard steps you through the configuration action; if you don't complete the installation in one session, be sure to go back and make sure all configuration actions are complete. In the Akana Administration Console, Configuration tab, at the bottom left, the <strong>Configuration Actions</strong> section should be empty when the upgrade process is complete.</p>
<p><a href="#top">back to top</a></p>



<h3 id="s03_08">Step 3-7: Conditional, MongoDB/OAuth: Post-Upgrade Task for Data Migration</h3>
<p><strong>Note</strong>: This task was introduced in version 8.4.4 and is applicable for upgrades to 8.4.4 and later versions.</p>
<p>If you’re migrating from RDBMS to MongoDB and you use OAuth, you’ll need to run a data migration task, introduced in the upgrade to version 8.4.4, to ensure that OAuth tokens issued before the upgrade can still be used.</p>
<p>After migrating the data, you'll need to update a configuration property and restart the container. Follow the steps below.</p>

<h5>To migrate OAuth data to MongoDB</h5>
<ol>
	<li>In the Akana Administration Console for the Policy Manager/Community Manager instance, <strong>Configuration Actions</strong>, run the <strong>Migrate OAuth Data to MongoDB</strong> task, as shown below.
  <p><img src="images/03_08_01.jpg" alt="Migrate OAuth Data to MongoDB configuration task" /></p></li>
	<li>In the Akana Administration Console, click the <strong>Configuration</strong> tab.</li>
	<li>Under <strong>Configuration Categories</strong>, find the <strong>com.soa.oauth.provider.server</strong> category.</li>
	<li>Find the <strong>com.soa.oauth.provider.server.config.datasource</strong> property and change the value from <strong>JDBC</strong> to <strong>NOSQL</strong>.</li>
	<li>Click <strong>Apply Changes</strong>.</li>
	<li>Restart the Policy Manager/Community Manager container and then, when PM/CM is started, restart the Network Director container.</li>
</ol>
<p>After updating this property, the server for the OAuth Provider is now the NOSQL database (MongoDB).</p>
<p><a href="#top">back to top</a></p>




<div class = "divider1"></div>
<h3 id="h_upgrade_tasks_reference">Upgrade Procedures/Reference</h3>




<h3 id="how_do_i_contact_technical_support">Contacting Akana Technical Support</h3>
<p>If you need to contact Technical Support, submit an email to <a href="mailto:support@akana.com">support@akana.com</a>.</p>
<p>When sending a support query, please provide the following information:</p>
<ul>
	<li>Your name</li>
	<li>Email address</li>
	<li>Subject</li>
	<li>As much information as possible regarding your question.</li>
</ul>
<p>You'll receive an acknowledgment email and one of our support staff will contact you.</p>
<p>You can also access the Support site at <a href="https://servicedesk.akana.com/servicedesk/customer/user/login" title="Akana technical support site" target="_blank">https://servicedesk.akana.com/servicedesk/customer/user/login</a>.</p>
<p><a href="#top">Back to top</a></p>



<h3 id="container_upgrade_sequence">Container upgrade sequence</h3>
<p>In terms of the sequence of containers, it's best to start by upgrading one of the Policy Manager containers. This accomplishes the database upgrade as well.</p>
<p>After that point, the sequence of containers really doesn't matter. These upgrade instructions suggest the following sequence once the first container has been updated:</p>
<ol>
	<li>First, any additional containers running Policy Manager and/or the API Platform.</li>
	<li>Then, any Network Director or Agent containers.</li>
</ol>
<p>However, the sequence is not important after the first container. You could upgrade the Network Director container at any point. There is no dependency; containers that have been upgraded will work with containers that haven't yet been upgraded. You can even upgrade additional containers in parallel.</p>
<p>Just make sure you upgrade an initial Policy Manager container first, with the associated database upgrade, and then follow any logical approach, making sure that each step completes successfully before starting the next one.</p>
<p><a href="#top">Back to top</a></p>



<!--<h3 id="xxx">Troubleshooting: error: xxx</h3>
<p>xxx</p>
<p><a href="#top">Back to top</a></p>-->



<h3 id="ts_02_error_new_containers">Upgrading by creating new containers: notes</h3>
<p>If you're upgrading by creating new containers, rather than upgrading existing containers, it's important that you delete the existing container from the Policy Manager workbench before creating the new container.</p>
<p>If you don't delete the old container before creating the new one, you might encounter an error on the provisioning step, similar to the one shown below (<strong>WSDL binding cannot be disassociated from service</strong>):</p>
<pre>[425] com.digev.fw.exception.GException: Wsdl binding [uddi:4b0aba1c-8ca7-e61c-5575-25361578c179] 
cannot be disassociated from service [uddi:soa.com:metadataattachment-servicekey]. 
Binding is attached to service endpoint.</pre>
<p>If you encounter this message, delete the old container, and then retry the provisioning.</p>
<p><a href="#top">Back to top</a></p>



<!--<p>{Future procedures for this section:}</p>
<p>Checking to make sure all the bundles have started correctly</p>
<p>Stopping the scheduled jobs</p>
<p>Starting the scheduled jobs</p>-->



<div class = "divider1"></div>



<h3 id="related_topics">Related Topics</h3>
<div class="relatedlinks" id="install">
<ul>
	<li><a href="../upgrade/upgrading_akana_api_platform_84_2018.htm">Upgrading Akana API Platform from Version 8.4x to Version 2018.0.x</a></li>
	<li><a href="../upgrade/upgrading_akana_api_platform_82_84.htm">Upgrading Akana API Platform from Version 8.2 to Version 8.4x</a></li>
	<li><a href="../upgrade/upgrading_min_downtime.htm">Use Case: Upgrading with Minimum Downtime</a></li>
	<li><a href="../upgrade/upgrading_micro.htm">Micro-Version Upgrade Notes: 2018.0.0</a></li>
	<li><a href="../upgrade/upgrading_micro_84x.htm">Micro-Version Upgrade Notes: 8.4x</a></li>
</ul>
<ul>
	<li><a href="../platform_install/installing_akana_api_platform.htm">Installing the Akana API Platform 2018.0.0</a></li>
	<li><a href="../platform_install/installing_akana_api_platform_v84.htm">Installing the Akana API Platform 8.4x</a></li>
	<li><a href="../platform_install/installing_akana_api_platform_v82.htm">Installing the Akana API Platform 8.2x</a></li>
	<li><a href="../platform_install/implementation_planning.htm">Planning Your Implementation</a></li>
	<li><a href="../platform_install/install_cm_jython_script.htm">Installation Jython Script</a></li>
	<li><a href="../platform_install/install_es_config.htm">Installing and Configuring Elasticsearch</a></li>
	<li><a href="../platform_install/install_es_secure_tc.htm">Configuring Elasticsearch with security</a></li>
</ul>
</div>