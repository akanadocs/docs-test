---
layout: page
title: Platform Hardening
description: A guide on how to harden the platform for secure deployments.
product: sp
category: ref
sub-nav-class: Platform Management
weight: 16
type: page
nav-title: Platform Hardening
---
<h1 id="top">Akana Platform Hardening Guide</h1>
<p>This document summarizes ways to harden the platform for secure deployments.</p>
<hr class="divide_hr" />



<h2 style="color: gray;">Table of Contents</h2>
<ol class="table_of_contents">
	<li><a href="#introduction">Introduction</a></li>
	<li><a href="#deployment_architecture">Deployment Architecture</a>
	<ul>
		<li><a href="#install_network_director_on_a_separate_container">Install Network Director on a separate container</a></li>
		<li><a href="#install_internet_facing_and_administration_applications_on_separate_containers">Install Internet-facing and administration applications on separate containers</a></li>
		<li><a href="#configure_all_listeners_internal_and_external_as_htts_only">Configure all listeners, internal and external as HTTPS only</a></li>
		<li><a href="#config_admin_sep_port">Configure the Akana Administration Console (/admin) on a separate port</a></li>
		<li><a href="#admin_console_domain_disable_login">Disable the Akana Administration Console domain as a login domain</a></li>
	</ul></li>
	<li><a href="#h_config_settings_container">Configuration Settings in the Admin Console for the Container</a>
	<ul>
		<li><a href="#jre_unlimited_strength">Add the unlimited strength policy to the JDK</a></li>
		<li><a href="#ignore_cookies">Configure the product to ignore downstream cookies</a></li>
		<li><a href="#secure_cookies">Configure secure cookies</a></li>
		<li><a href="#disabling_ssl_renegotiation">Disabling SSL renegotiation</a></li>
		<li><a href="#restrict_cipher_suites">Restrict the cipher suites used</a></li>
		<li><a href="#tls12_only">Enforcing TLS 1.2</a></li>
		<li><a href="#disabling_ssl">Disabling SSL protocols</a></li>
		<li><a href="#disabling_outbound">Limiting outbound SSL/TLS/Cipher support</a></li>
		<li><a href="#limit_scripting_language">Limiting the scripting language allowed</a></li>
		<li><a href="#prevent_forward_proxying">Prevent Forward Proxying</a></li>
		<li><a href="#nd_header_propagation">Header Propagation in Network Director</a></li>
		<li><a href="#credential_cache">Tune the API Security Credential Cache</a></li>
		<li><a href="#anti_virus_policy_config_scan_uploaded_files">Configure the Anti-Virus policy to scan for uploaded files</a></li>
		<li><a href="#enabling_csrf_protection">Enabling CSRF protection</a></li>
		<li><a href="#adding_xss_exclusions">Adding XSS exclusions</a></li>
		<li><a href="#configuring_x_frame_options_header">Configuring X-FRAME-OPTIONS Header</a></li>
		<li><a href="#configuring_server_header">Configuring Server Header</a></li>
		<li><a href="#metadata_service_secure">Securing the metadata service</a></li>
		<li><a href="#config_xslt_limit">Configuration setting to limit XSLT transformation</a></li>
	</ul></li>
	<li><a href="#h_config_settings_cm_ui">Configuration Settings in the Community Manager developer portal User Interface</a>
	<ul>
		<li><a href="#configuring_challenge_questions_and_answers">Enforcing Challenge Questions and Answers</a></li>
		<li><a href="#challenge_question_answer_constraints">Configuring Constraints on Security Challenge Questions and Answers</a></li>
		<li><a href="#configuring_account_login_rules">Configuring Account Login Rules</a></li>
		<li><a href="#configuring_password_complexity_rules">Configuring Password Complexity Rules</a></li>
		<li><a href="#turning_off_user_account_enumeration">Turning off User Account Enumeration</a></li>
		<li><a href="#disallowing_user_profile_modification">Disallowing User Profile Modification</a></li>
		<li><a href="#comments_limit_file_type">Limiting file types allowed for upload</a></li>
		<li><a href="#cm_security_allowlist">Enforcing an allowlist for cross-site scripting prevention</a> (2019.1.11 and later)</li>
		<li><a href="#malicious_pattern_policy_on_apis">Adding the Malicious Pattern Detection policy to Community Manager developer portal APIs that support file upload</a></li>
	</ul>
	</li>
</ol>
<hr class="divide_hr" />



<h2 id="introduction">Introduction</h2>
<p>Akana is a recognized leader in API Management and SOA Governance Automation solutions. Our platform-independent solution set includes the API Gateway, which is further broken down into Policy Manager, the centralized administration console, and Network Director, an intermediary that integrates with Policy Manager to provide high-performance, scalable API security and management capabilities. The solution also includes Community Manager, which provides a branded Community Manager developer portal for the consumption of API by the developer.</p>
<p>This document describes the best practices and configuration settings to harden Akana's API Gateway and Community Manager products. For an example of a deployment in a clustered environment, see <a href="../deployment/deployment_clustered.htm">Sample Deployment Scenario</a>.</p>



<h2 id="deployment_architecture">Deployment Architecture</h2>
<p>There are several best practices that cover the deployment of the product in a hardened environment.</p>
<p>An external HSM keystore can be used in place of the out of the box Policy Manager keystore (database).</p>


<h3 id="install_network_director_on_a_separate_container">Install Network Director on a Separate Container</h3>
<p>API traffic processing should be handled separately from Web traffic and Admin traffic. To this end, the Network Director should not be installed on the same container as Community Manager, or Policy Manager features:</p>
<p><img src="images/ph_201800_hardening_admin_console.png" alt="Akana Administration Console" title="Akana Administration Console" /></p>
<p><a href="#top">Back to top</a></p>



<h3 id="install_internet_facing_and_administration_applications_on_separate_containers">Install Internet-facing and Administration Applications on Separate Containers</h3>
<p>There are two components to this:</p>
<ol>
	<li>The Community Manager should not be installed on the same container as Policy Manager Console</li>
	<li>The Community Manager User Interface and APIs provide both consumer-facing and administrative functions. If needed by your security constraints, the administrative functions can be disabled in Community Manager. This will allow you to install different instances of Community Manager on different containers â€“ and disable the administration functionality in the Internet-facing instance. </li>
</ol>
<p>To disable the administrative functionality in the Community Manager:</p>
<p>In the Akana Administration Console, configure the following:</p>
<pre>com.soa.atmosphere -&gt;
atmosphere.config.denyUserRoles=SiteAdmin,BusinessAdmin,ApiAdmin,System Administrator,Security Administrator,Site Administrator</pre>
<p><a href="#top">Back to top</a></p>



<h3 id="configure_all_listeners_internal_and_external_as_htts_only">Configure all listeners, internal and external as HTTPS only</h3>
<p>This is accomplished in two places in the product: Firstly, the listeners for the applications in the container are configured from within Policy Manager at <strong>Containers</strong> &gt; <strong>{container_name}</strong> &gt; <strong>Details</strong> &gt; <strong>Inbound Listeners</strong>. Options for configuring port and PKI are available. Settings for two-way SSL mutual authentication are also available. It is best to choose either <strong>Accept client certificates</strong> or <strong>Require client certificates</strong>, based on customer security requirements.</p>
<p><strong>Scope</strong>: All Containers</p>
<pre>#Config for pm
#Thu Jul 10 23:47:51 PDT 2014
product.home=file\:/Users/example/soa/sm80/
org.eclipse.jetty.server.Request.maxFormContentSize=500000
felix.cm.dir=${felix.cache.rootdir}/cm
org.osgi.service.http.port.secure=9900
com.soa.provision.file.dir=${felix.cache.rootdir}/deploy
product.home.dir=/Users/janemead/soa/b962/sm80
com.soa.snapshot.directory=${felix.cache.rootdir}/snapshot
com.soa.provision.noInitialDelay=true
com.soa.http.host=127.0.0.1
com.soa.http.bind.all=false
com.soa.provision.bundles.start=true
com.soa.provision.poll=2000
org.eclipse.jetty.servlet.SessionCookie=JSESSIONID_pm
felix.shutdown.hook=false
container.name={container_name}</pre>
<p>Note above the *.secure syntax used for the settings.</p>
<p>Secondly, the listeners for the applications in the container are configured from within Policy Manager at <strong>Containers</strong> &gt; <strong>{container_name}</strong> &gt; <strong>Details</strong> &gt; <strong>Inbound Listeners</strong>. Options for configuring port and PKI are available.</p>
<p><a href="#top">Back to top</a></p>



<h3 id="config_admin_sep_port">Configure the Akana Administration Console (/admin) on a separate port</h3>
<p>As shown above, this is configurable in the <strong>system.properties</strong> file for each container. The Akana Administration Console (/admin) and the other features installed in the container should ideally be configured on different ports. This will allow you to isolate the Akana Administration Console from the Internet.</p>
<p><strong>Scope</strong>: All Containers</p>
<p>To do this, there are four steps.</p>
<h4>To configure the Akana Administration Console on a separate port</h4>
<ol>
	<li>Update the <strong>/instances/{container_name}/system.properties</strong> file by setting the <strong>com.soa.http.host</strong> value to the hostname for your Akana Administration Console.
		<p><strong>Sample file:</strong></p>
	<pre>#Config for pm
#Thu Jul 10 23:47:51 PDT 2016
product.home=file\:/Users/example/soa/sm80/
org.eclipse.jetty.server.Request.maxFormContentSize=500000
felix.cm.dir=${felix.cache.rootdir}/cm
org.osgi.service.http.port.secure=14443
com.soa.provision.file.dir=${felix.cache.rootdir}/deploy
product.home.dir=/Users/janemead/soa/b962/sm80
com.soa.snapshot.directory=${felix.cache.rootdir}/snapshot
com.soa.provision.noInitialDelay=true
com.soa.http.host=10.1.1.2
com.soa.http.bind.all.secure=false
com.soa.provision.bundles.start=true
com.soa.provision.poll=2000
org.eclipse.jetty.servlet.SessionCookie=JSESSIONID_pm
felix.shutdown.hook=false
container.name={container_name}</pre>
	<p><strong>Modified value for hostname:</strong></p>
	<pre>com.soa.http.host={localhost}</pre>
	</li>
	<li>In the same file, set the <strong>org.osgi.service.http.port.secure</strong> value to a different port, not the one that the application is running on.
		<p><strong>Modified value for port:</strong></p>
	<pre>org.osgi.service.http.port.secure=23312</pre>
	</li>

	<li>Go into the Akana Administration Console. Click <strong>Configuration</strong>, then find the <strong>com.soa.admin.console</strong> category. Find the <strong>admin.console.localhost.only</strong> value and set it to <strong>true</strong>.</li>
	<li>Restart the container.</li>
</ol>
<p><a href="#top">Back to top</a></p>


<h3 id="admin_console_domain_disable_login">Disable the Akana Administration Console domain as a login domain</h3>
<p>For additional security, you can disable the Admin Console domain as a login domain. This prevents users from logging in via the default domain.</p>
<p>Before disabling the Admin Console domain, make sure you've correctly set up and enabled a valid login domain that users can use, such as an LDAP domain.</p>
<p>For instructions for configuring a security identity provider via the Policy Manager console, refer to: <a href="../../ag/security_config/identity_systems.htm#id_system_config_about" target="_self">About Identity System Configuration</a>.</p>
<p>The Administrator for the Akana Administration Console can then assign the System Administrator role for the registry organization to users from the security identity provider, in the console. For instructions, see <a href="../../ag/security_admin/roles.htm#s03_06_01" target="_self">To grant System Administrator permission</a>.</p>
<h4>To disable the Admin Console domain as a login domain:</h4>
<ol>
	<li>Log in to the Akana Administration Console.</li>
	<li>Click the <strong>Configuration</strong> tab.</li>
	<li>On the left, under Configuration Categories, scroll down to find the <strong>com.soa.admin.console</strong> category.</li>
	<li>Set the <strong>admin.console.domain.enabled</strong> property to <strong>false</strong>.</li>
	<li>Click <strong>Apply Changes</strong>.</li>
</ol>
<p><a href="#top">Back to top</a></p>

<h2 id="h_config_settings_container">Configuration Settings in the Admin Console for the Container</h2>
<p>This section covers settings and tuning parameters relating to hardening, that you can configure in the Admin Console for the container, or at the command line for the container. It includes:</p>
<div class="relatedlinks" id="api_admin">
<ul>
	<li><a href="#jre_unlimited_strength">Add the unlimited strength policy to the JDK</a></li>
	<li><a href="#ignore_cookies">Configure the product to ignore downstream cookies</a></li>
	<li><a href="#secure_cookies">Configure secure cookies</a></li>
	<li><a href="#disabling_ssl_renegotiation">Disabling SSL renegotiation</a></li>
	<li><a href="#restrict_cipher_suites">Restrict the cipher suites used</a></li>
	<li><a href="#tls12_only">Enforcing TLS 1.2</a></li>
	<li><a href="#disabling_ssl">Disabling SSL protocols</a></li>
	<li><a href="#disabling_outbound">Limiting outbound SSL/TLS/Cipher support</a></li>
	<li><a href="#limit_scripting_language">Limiting the scripting language allowed</a></li>
	<li><a href="#prevent_forward_proxying">Prevent Forward Proxying</a></li>
</ul>
<ul>
	<li><a href="#nd_header_propagation">Header Propagation in Network Director</a></li>
	<li><a href="#credential_cache">Tune the API Security Credential Cache</a></li>
	<li><a href="#anti_virus_policy_config_scan_uploaded_files">Configure the Anti-Virus policy to scan for uploaded files</a></li>
	<li><a href="#enabling_csrf_protection">Enabling CSRF protection</a></li>
	<li><a href="#adding_xss_exclusions">Adding XSS exclusions</a></li>
	<li><a href="#configuring_x_frame_options_header">Configuring X-FRAME-OPTIONS Header</a></li>
	<li><a href="#configuring_server_header">Configuring Server Header</a></li>
	<li><a href="#metadata_service_secure">Securing the metadata service</a></li>
	<li><a href="#config_xslt_limit">Configuration setting to limit XSLT transformation</a></li>
</ul>
</div>



<h3 id="jre_unlimited_strength">Add the unlimited strength policy to the JDK</h3>
<p>To support long passwords when importing PKI from a Java keystore, you will need to install the Java Cryptography Extension (JCE) Unlimited Strength Jurisdiction Policy Files. This is dependent on the JRE version being used and is available from Oracle. To install, copy the <strong>US_export_policy.jar</strong> and <strong>local_policy.jar</strong> files to the /lib/security directory for the JRE.</p>
<p><strong>Scope</strong>: All Containers</p>
<p><a href="#top">Back to top</a></p>



<h3 id="ignore_cookies">Configure the product to ignore downstream cookies</h3>
<p>This prevents the product from automatically storing and forwarding any cookies retrieved from the downstream APIs and Services.</p>
<p><strong>Scope</strong>: All Containers</p>
<p>In the Akana Administration Console, configure the following:</p>
<pre>com.soa.http.client.core -&gt;
http.client.params.cookiePolicy=ignoreCookies</pre>
<p><a href="#top">Back to top</a></p>



<h3 id="secure_cookies">Configure secure cookies</h3>
<p>This sets the product to only use secure cookies. </p>
<p><strong>Scope</strong>: All Containers</p>
<p>In the Akana Administration Console, configure the following:</p>
<pre>com.soa.platform.jetty -&gt;
session.manager.factory.secureCookies=true</pre>
<p><a href="#top">Back to top</a></p>



<h3 id="disabling_ssl_renegotiation">Disabling SSL renegotiation</h3>
<p>There are no common reasons for supporting client-initiated SSL renegotiation, so wherever possible it's more secure to disable this setting so that it isn't supported.</p>
<p><strong>Scope</strong>: All Containers</p>
<p>In the Akana Administration Console, configure the following:</p>
<pre>com.soa.platform.jetty -&gt;
http.incoming.transport.config.allowRenegotiate=false</pre>
<p><a href="#top">Back to top</a></p>



<h3 id="restrict_cipher_suites">Restrict the cipher suites used</h3>
<p>Use only stronger cipher suites for SSL</p>
<p><strong>Scope</strong>: All Containers</p>
<p>In the Akana Administration Console, configure the following:</p>
<pre>com.soa.platform.jetty -&gt;
http.incoming.transport.config.cipherSuites=TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384,TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_DHE_DSS_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_DHE_DSS_WITH_AES_128_GCM_SHA256,TLS_DHE_DSS_WITH_AES_256_CBC_SHA256,TLS_DHE_RSA_WITH_AES_128_CBC_SHA,TLS_ECDHE_RSA_WITH_3DES_EDE_CBC_SHA,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA,TLS_RSA_WITH_AES_128_CBC_SHA256,TLS_RSA_WITH_AES_256_CBC_SHA256,TLS_RSA_WITH_AES_128_CBC_SHA,TLS_RSA_WITH_AES_256_CBC_SHA</pre>
<p><strong>Note</strong>: Cipher suites that use AES_256 require installation of the JCE Unlimited Strength Jurisdiction Policy Files. See <a href="http://www.oracle.com/technetwork/java/javase/downloads/jce8-download-2133166.html" title="Java cryptography documentation" target="_blank">Java Cryptography Architecture Oracle Providers Documentation for Java Platform Standard Edition 8</a>. This must be added to the JRE.</p>
<p><a href="#top">Back to top</a></p>



<h3 id="tls12_only">Enforcing TLS 1.2</h3>
<p>Depending on the level of security required, you may way to restrict the protocol to TLS 1.2 only. Note - This will limit the accessibility of the platform to certain clients.</p>
<p>The above examples show two options:</p>
<ul>
	<li><a href="#tls12_01">Enabling TLS v1.2 only</a></li>
	<li><a href="#tls12_lb">Enforcing TLS 1.2 behind a secure load balancer</a></li>
</ul>

<h4 id="tls12_01">Enabling TLS v1.2 only</h4>
<p>In the example below, only TLS v1.2 is enabled. Note that this option is only applicable if you don't have load balancing.</p>
<p><strong>Scope</strong>: All Containers</p>
<p>Enable TLSv1.2 only, with no load balancing:</p>
<pre>com.soa.platform.jetty -&gt;
http.incoming.transport.config.enabledProtocols=TLSv1.2</pre>
<p><strong>Note</strong>: Cipher suites that use AES_256 require installation of the JCE Unlimited Strength Jurisdiction Policy Files. See <a href="http://www.oracle.com/technetwork/java/javase/downloads/jce8-download-2133166.html" title="Java cryptography documentation" target="_blank">Java Cryptography Architecture Oracle Providers Documentation for Java Platform Standard Edition 8</a>. This must be added to the JRE.</p>

<h4 id="tls12_lb">Enforcing TLS 1.2 behind a secure load balancer</h4>
<p>In the example below, protocols are limited to TLS v1.2 and one additional protocol needed by the load balancer.</p>
<p><strong>Scope</strong>: All Containers</p>
<p>Enable TLSv1.2, with load balancing in place. Some secure load balancers require the <strong>SSLv2Hello</strong>protocol, so that needs to be included.</p>
<p>As long as SSL is not enabled, the SSLv2Hello is only used during the initial handshake, and the protocol is not downgraded or renegotiated to use SSLv2 or SSLv3.</p>
<pre>com.soa.platform.jetty -&gt;
http.incoming.transport.config.enabledProtocols=SSLv2Hello,TLSv1.2</pre>
<p><strong>Note</strong>: Cipher suites that use AES_256 require installation of the JCE Unlimited Strength Jurisdiction Policy Files. See <a href="http://www.oracle.com/technetwork/java/javase/downloads/jce8-download-2133166.html" title="Java cryptography documentation" target="_blank">Java Cryptography Architecture Oracle Providers Documentation for Java Platform Standard Edition 8</a>. This must be added to the JRE.</p>
<p><a href="#top">Back to top</a></p>



<h3 id="disabling_ssl">Disabling SSL protocols</h3>
<p>The example below configures the product to disable SSL v3. Specific TLS protocols are enabled. In this example, SSLv2HELLO is still enabled, for the load balancer.</p>
<p><strong>Scope</strong>: All Containers</p>
<p>In the Akana Administration Console, configure the following:</p>
<pre>com.soa.platform.jetty -&gt;
http.incoming.transport.config.enabledProtocols=SSLv2HELLO,TLSv1,TLSv1.1, TLSv1.2</pre>
<p><a href="#top">Back to top</a></p>



<h3 id="disabling_outbound">Limiting outbound SSL/TLS/Cipher support</h3>
<p>You may also want to limit the protocols and ciphers the product will use for outbound connections.</p>
<p><strong>Scope</strong>: All Containers</p>
<p>Configure the available protocols for outbound connections:</p>
<pre>com.soa.http.client.core -&gt;
https.socket.factory.enabledProtocols=TLSv1.2</pre>
<p>Configure the available cipher suites for outbound connections:</p>
<pre>com.soa.http.client.core -&gt;
https.socket.factory.cipherSuites=TLS_RSA_WITH_AES_256_CBC_SHA256, TLS_RSA_WITH_AES_256_GCM_SHA384, TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256</pre>
<p><strong>Note</strong>: Cipher suites that use AES_256 require installation of the JCE Unlimited Strength Jurisdiction Policy Files. See <a href="http://www.oracle.com/technetwork/java/javase/downloads/jce8-download-2133166.html" title="Java cryptography documentation" target="_blank">Java Cryptography Architecture Oracle Providers Documentation for Java Platform Standard Edition 8</a>. This must be added to the JRE.</p>
<p><a href="#top">Back to top</a></p>



<h3 id="limit_scripting_language">Limiting the scripting language allowed</h3>
<p>In the Akana Administration Console, the Administrator can limit the scripting languages supported by the API platform. For example, you could choose not to support Jython. Limiting the supported scripting languages helps close the door on possible malignant efforts to hack the system using those scripting languages.</p>
<p>For maximum security, limit this setting to <strong>js</strong> only.</p>
<p>The setting is in the Akana Administration Console: <strong>Configuration</strong> &gt; <strong>com.soa.script.framework</strong>, as shown below.</p>
<p><img src="images/ph_84_limit_scripting_language.jpg" alt="Limit the scripting language allowed" /></p>
<p>By default, all scripting languages supported by the platform are shown, as comma-separated values. To update, remove one or more values and click <strong>Apply Changes</strong>.</p>
<p><a href="#top">Back to top</a></p>



<h3 id="prevent_forward_proxying">Prevent Forward Proxying</h3>
<p>Prevent unauthenticated users from initiating arbitrary internal connections from the Community Manager developer portal.</p>
<p><strong>Scope</strong>: Community Manager Containers</p>
<p>You can prevent forward proxying:</p>
<ul>
	<li>Via the Community Manager developer portal user interface: <strong>Administration</strong> &gt; <strong>Site</strong>, as shown below. Changing this setting in the user interface affects all containers for the installation.
	<p><img src="images/ph_cm_site_limit_forward_proxy.png" alt="Limit forward proxy setting" /></p></li>
	<li>In the Akana Administration Console for each container. Configure the following setting:
		<pre>com.soa.atmosphere.forwardproxy -&gt;
forward.proxy.allowedHosts=&lt;Network Director Host(s) and/or Load Balancer host&gt;</pre></li>
</ul>
<p>Values are comma separated.</p>
<p><a href="#top">Back to top</a></p>



<h3 id="nd_header_propagation">Header Propagation in Network Director</h3>
<p>Configure a translation of the X-Forwarded-Host header.</p>
<p><strong>Scope</strong>: Network Director Containers</p>
<p>In the Akana Administration Console, configure the following:</p>
<pre>com.soa.http.client.core ->
header.formatter.interceptor.templates=replace=X-Forwarded-Host:{host}</pre>
<p><a href="#top">Back to top</a></p>



<h3 id="credential_cache">Tune the API Security Credential Cache</h3>
<p>You can configure the expiration period and refresh time for the security cache for API calls.</p>
<p><strong>Scope</strong>: Network Director Containers</p>
<p>In the Akana Administration Console, optionally configure the following:</p>
<pre>com.soa.api.security -&gt;
com.soa.api.security.cache.expirationPeriod=3600000
com.soa.api.security.cache.refreshTime=300000</pre>
<p><a href="#top">Back to top</a></p>



<h3 id="anti_virus_policy_config_scan_uploaded_files">Configure the Anti-Virus policy to scan for uploaded files</h3>
<p>The Anti-Virus policy scans for files that are uploaded from the Community Manager developer portal.</p>
<p><strong>Scope</strong>: All Community Manager Containers</p>
<p>In the Policy Manager Console, create an Anti-Virus Operational Policy and configure the policy.</p>
<p><img src="images/ph_84_modify-av-policy.png" alt="Create Anti Virus policy" title="Create Anti Virus policy" /></p>
<p>In the Policy Manager Console organization tree, attach this policy to the Community Manager services listed below, in the <strong>Akana Policy Manager</strong> &gt; <strong>Akana API Platform</strong> &gt; <strong>Services node</strong>, and to the one Policy Manager service listed below, in the <strong>Akana Policy Manager</strong> &gt; <strong>Services</strong> node. An example is shown below.</p>
<p><img src="images/ph_84_attach-av-policy.png" alt="Attach Anti Virus policy" title="Attach Anti Virus policy" /></p>
<p>You can also assign the Anti-Virus policy at the operation level. For example, in the Workflow Service, you could assign the policy to one operation, <span class="apidoc_code">addWorkloadDefinitionConfiguration</span>. Go to the <strong>Akana Policy Manager</strong> &gt; <strong>Akana API Platform</strong> &gt; <strong>Services node</strong>, locate the WorkflowAPI Service. On the right, click Operations, and locate the operation on the list. Click to go into the operation details, and then assign the policy to the operation, as shown below.</p>
<p><img src="images/ph_attach_antivirus_policy_operation_level.png" alt="Attaching an Anti-Virus policy at the operation level in Policy Manager" title="Attaching an Anti-Virus policy at the operation level in Policy Manager" /></p>

<p>The tables below show the services and operations that should have the Anti-Virus policy attached:</p>
<ul>
	<li><a href="#hardening_av_file_upload_cm">Community Manager services/operations that include file upload</a></li>
	<li><a href="#hardening_av_file_upload_pm">Policy Manager services/operations that include file upload</a></li>
</ul>

<h4 id="hardening_av_file_upload_cm">Community Manager services/operations that include file upload</h4>
<p>The table below shows the Community Manager services that include file upload and should therefore have the anti-virus policy attached.</p>
<table class="doctable">
	<thead>
		<tr>
			<th>Service</th>
			<th>Operation Name</th>
		</tr>
	</thead>
	<tbody>
		<tr>
			<td>ApplicationAPI Service</td>
			<td>saveKeyInfo</td>
		</tr>
		<tr>
			<td>BoardAPI Service</td>
			<td>addArtifact</td>
		</tr>
		<tr>
			<td>&#160;</td>
			<td>addCommentArtifact</td>
		</tr>
		<tr>
			<td>&#160;</td>
			<td>addFirstArtifact</td>
		</tr>
		<tr>
			<td>&#160;</td>
			<td>addFirstCommentArtifact</td>
		</tr>
		<tr>
			<td>ClientServicesAPI Service</td>
			<td>assignClientIdentity</td>
		</tr>
		<tr>
			<td>&#160;</td>
			<td>loadAliasesForKeystore</td>
		</tr>
		<tr>
			<td>ConsoleResourceAPI Service</td>
			<td>upload</td>
		</tr>
		<tr>
			<td>&#160;</td>
			<td>uploadRoot</td>
		</tr>
		<tr>
			<td>ContentAPI Service</td>
			<td>add</td>
		</tr>
		<tr>
			<td>&#160;</td>
			<td>upload</td>
		</tr>
		<tr>
			<td>DropboxApi Service</td>
			<td>addPicture</td>
		</tr>
		<tr>
			<td>&#160;</td>
			<td>readFileDetails</td>
		</tr>
		<tr>
			<td>&#160;</td>
			<td>readUrl</td>
		</tr>
		<tr>
			<td>&#160;</td>
			<td>readWsdl</td>
		</tr>
		<tr>
			<td>&#160;</td>
			<td>readWsdlZip</td>
		</tr>
		<tr>
			<td>&#160;</td>
			<td>readZipFileDetails</td>
		</tr>
		<tr>
			<td>ModelAPI Service</td>
			<td>readFileDetails</td>
		</tr>
		<tr>
			<td>&#160;</td>
			<td>updateImage</td>
		</tr>
		<tr>
			<td>OAuthClientApi Service</td>
			<td>createSessionKey</td>
		</tr>
		<tr>
			<td>TenantAdministrationAPI Service</td>
			<td>importPackage</td>
		</tr>
		<tr>
			<td>Workflow Service</td>
			<td>addWorkloadDefinitionConfiguration</td>
		</tr>
	</tbody>
</table>

<h4 id="hardening_av_file_upload_pm">Policy Manager services/operations that include file upload</h4>
<p>The table below shows the Policy Manager services that include file upload and should therefore have the anti-virus policy attached.</p>
<table class="doctable">
	<thead>
		<tr>
			<th>Service</th>
			<th>Operation Name</th>
			</tr>
	</thead>
	<tbody>
		<tr>
			<td>Container Management Service</td>
			<td>addContainerMultipart</td>
		</tr>
		<tr>
			<td>&#160;</td>
			<td>modifyContainerCertificateMultipart</td>
		</tr>
		<tr>
			<td>&#160;</td>
			<td>modifyContainerMetadataMultipart</td>
		</tr>
		<tr>
			<td>&#160;</td>
			<td>modifyContainerMultipart</td>
		</tr>
		<tr>
			<td>&#160;</td>
			<td>uploadContainerListenerPKI</td>
		</tr>
	</tbody>
</table>
<p><a href="#top">Back to top</a></p>



<h3 id="enabling_csrf_protection">Enabling CSRF Protection</h3>
<p>You can enable and disable CSRF protection in the Policy Manager and Community Manager User Interfaces.</p>
<p><strong>Scope</strong>: All Community Manager and Policy Manager Containers</p>
<p>Due to the fact that Policy Manager is not Internet-facing, this setting is disabled by default. You can enable CSRF protection for Policy Manager in the Akana Administration Console for the Policy Manager container:</p>
<pre>com.soa.console.csrf -&gt;
org.owasp.csrfguard.Enabled=true</pre>
<p>In the Community Manager developer portal, this setting is configured by the Site Admin. Choose:</p>
<ul>
	<li><strong>Administration</strong> &gt; <strong>Settings</strong> &gt; <strong>Security</strong> &gt; <strong>CSRF Support for Read Requests</strong></li>
	<li><strong>Administration</strong> &gt; <strong>Settings</strong> &gt; <strong>Security</strong> &gt; <strong>CSRF Support for Write Requests</strong></li>
</ul>
<p>For an illustration, see <a href="#cm_security_allowlist">Enforcing an allowlist for cross-site scripting prevention</a> below.</p>
<p><a href="#top">Back to top</a></p>



<h3 id="adding_xss_exclusions">Adding XSS exclusions</h3>
<p>Cross-site-scripting (XSS) is a way to inject client-side script into Web pages viewed by other users.</p>
<p><strong>Scope</strong>: All Community Manager and Policy Manager Containers</p>
<p>To configure any exceptions to the exclusion policy:</p>
<pre>com.soa.console.xss -&gt;
exceptionURLs=[COMMA DELIMITED LIST]</pre>
<p>To configure any new keywords that should be excluded:</p>
<pre>com.soa.console.xss -&gt;
keywords=[COMMA DELIMITED LIST]</pre>
<p>To turn XSS validation on/off:</p>
<pre>com.soa.console.xss -&gt;
validate=[true|false]</pre>
<p><a href="#top">Back to top</a></p>



<h3 id="configuring_x_frame_options_header">Configuring X-FRAME-OPTIONS Header</h3>
<p>The X-FRAME-OPTIONS header plays a role in determining if and how the user interface can be embedded within an iFrame in a third-party site.</p>
<p><strong>Scope</strong>: All Community Manager and Policy Manager Containers</p>
<p>To configure Community Manager:</p>
<pre>com.soa.atmosphere.console -&gt;
atmosphere.console.config.xFrameOptions=[DESIRED HEADER]</pre>
<p>To configure Policy Manager:</p>
<pre>com.soa.console.xss -&gt;
xFrameOptions=[DESIRED HEADER]</pre>
<p><a href="#top">Back to top</a></p>



<h3 id="configuring_server_header">Configuring Server Header</h3>
<p>You might want to prevent the Server header from being returned in responses.</p>
<p><strong>Scope</strong>: All Community Manager and Policy Manager Containers.</p>
<p>In the Akana Administration Console for each container, configure the following:</p>
<pre>com.soa.platform.jetty -&gt; jetty.server.sendServerVersion = false</pre>
<p><strong>Note</strong>: this property does not exist by default, so you will probably need to add it.</p>
<p><a href="#top">Back to top</a></p>



<h3 id="metadata_service_secure">Secure the metadata service</h3>
<p>The Metadata API includes details about the container, such as public keys, internal IP addresses and file locations, which you probably don't want to share broadly. This information could potentially aid an attacker in fingerprinting and enumerating the Policy Manager application or discovering how some of the Java servlets are configured.</p>
<p>For additional security, we recommend that you secure this API for all containers. Follow the steps below.</p>

<h4>To secure the metadata service (must be done separately for each container):</h4>
<ol>
	<li>Log in to the Akana Administration Console.</li>
	<li>Click the <strong>Configuration</strong> tab.</li>
	<li>On the left, under Configuration Categories, scroll down to find the <strong>com.soa.container.metadata.service</strong> category.</li>
	<li>Add a new property:
		<ul>
			<li>Property name: <strong>metadata.basic.auth.filter.enabled</strong></li>
			<li>Property value: <strong>true</strong></li>
		</ul>
		</li>
	<li>Click <strong>Apply Changes</strong>.</li>
</ol>
<p><a href="#top">Back to top</a></p>



<h3 id="config_xslt_limit">Configuration setting to limit XSLT transformation</h3>
<p>A configuration setting prevents XSLT transformation, by default. This helps protect against malicious attacks.</p>
<p><strong>Scope</strong>: All Containers</p>
<p>The configuration setting to prevent XSLT transformation:</p>
<pre>com.soa.framework.xsl.transform -&gt;
java.extension.enabled=false</pre>
<p>In the Akana Administration Console:</p>
<p><img src="images/ph_8413_xslt.jpg" alt="java.extension.enabled setting" /></p>
<p>By default, this is set to <strong>false</strong>, to disallow XSLT transformation.</p>
<p><a href="#top">Back to top</a></p>




<h2 id="h_config_settings_cm_ui">Configuration Settings in the Community Manager developer portal User Interface</h2>
<p>This section covers settings and tuning parameters relating to hardening, that you can configure in the Community Manager developer portal (Community Manager). It includes:</p>
<ul>
	<li><a href="#configuring_challenge_questions_and_answers">Enforcing Challenge Questions and Answers</a></li>
	<li><a href="#challenge_question_answer_constraints">Configuring Constraints on Security Challenge Questions and Answers</a></li>
	<li><a href="#configuring_account_login_rules">Configuring Account Login Rules</a></li>
	<li><a href="#configuring_password_complexity_rules">Configuring Password Complexity Rules</a></li>
	<li><a href="#turning_off_user_account_enumeration">Turning off User Account Enumeration</a></li>
	<li><a href="#disallowing_user_profile_modification">Disallowing User Profile Modification</a></li>
	<li><a href="#comments_limit_file_type">Limiting file types allowed for upload</a></li>
	<li><a href="#cm_security_allowlist">Enforcing an allowlist for cross-site scripting prevention</a> (2019.1.11 and later)</li>
	<li><a href="#malicious_pattern_policy_on_apis">Adding the Malicious Pattern Detection policy to Community Manager developer portal APIs that support file upload</a></li>
</ul>


<h3 id="configuring_challenge_questions_and_answers">Enforcing Challenge Questions and Answers</h3>
<p>Challenge Questions/Answers are often required to increase security around password reset. When signing up to the platform, the user must provide the answer to one or more security questions, if the platform is set up to require them. The user's answers are stored in the database, and the user must answer one or more security questions on demand to perform certain functions such as resetting a password or changing the user profile.</p>
<p>
In Community Manager, choose <strong>Admin</strong> &gt; <strong>Settings</strong> &gt; <strong>Users</strong> &gt; <strong>Enforce Challenge Questions on Login</strong>:</p>
<p><img src="images/ph_cm_settings_user_challenge_questions.png" alt="User Settings" /></p>
<p>Set <strong>Enforce Challenge Questions on Login</strong> to <strong>Enabled</strong>.</p>
<p>Additional settings can be found under <strong>Admin</strong> &gt; <strong>Settings</strong> &gt; <strong>Security</strong>:</p>
<ul>
<li>Encrypt Challenge Answers (enabled/disabled</li>
<li>Challenge Count</li>
</ul>
<p>For an illustration, see <a href="#cm_security_allowlist">Enforcing an allowlist for cross-site scripting prevention</a> below.</p>
<p>For more information, see <a href="../../cm/learnmore/site_admin_settings.htm#settings_config_security_business">How do I configure settings for business security?</a> (Community Manager developer portal help)</p>
<p><a href="#top">Back to top</a></p>



<h3 id="challenge_question_answer_constraints">Configuring Constraints on Security Challenge Questions and Answers</h3>
<p>For each security question set up in the Community Manager developer portal, as well as specifying the actual question, the Site Admin can configure constraints such as minimum and maximum number of letters, numbers, and special characters allowed or required in the answers, whether answers are case-sensitive, and whether spaces are allowed.</p>
<p>The Site Admin can delete questions; however, if any users have already set up answers to questions that are then deleted, those questions and answers are still available for account verification purposes.</p>
<p>Security question settings can be found under <strong>Administration</strong> &gt; <strong>Settings</strong> &gt; <strong>Challenges</strong>:</p>
<p><img src="images/ph_846_security_config.jpg" alt="Configuring constraints on security challenge answers" /></p>
<p><strong>Note</strong>: In the Community Manager developer portal, the security challenge feature doesn't allow users to give the same answer twice. This is a precaution against users being lazy and using a default value, which is less secure, rather than setting up authentic answers to the questions.</p>
<p>For more information about configurable settings in the Community Manager developer portal, see <a href="../../cm/learnmore/site_admin_settings.htm">Site Resource Settings</a> (Site Admin help).</p>
<p><a href="#top">Back to top</a></p>


<h3 id="configuring_account_login_rules">Configuring Account Login Rules</h3>
<p>The account login rules may include many options regarding failure attempts allowed, including account suspension times, and other settings.</p>
<p><strong>Scope</strong>: Community Manager</p>
<p>Login policies can be set:</p>
<ul>
	<li>Via the Community Manager developer portal user interface: <strong>Admin</strong> &gt; <strong>Settings</strong> &gt; <strong>Login</strong>, as shown below.
	<p><img src="images/ph_cm_settings_login.png" alt="Login Policy page" /></p>
	</li>
	<li>Via an <a href="../../cm/api/businesses/m_businesses_updateLoginPolicy.htm">API call</a> into the system.</li>
</ul>
<p><a href="#top">Back to top</a></p>


<h3 id="configuring_password_complexity_rules">Configuring Password Complexity Rules</h3>
<p>Password requirements (rules) may include many options such as length, characters allowed/required, and password change period.</p>
<p><strong>Scope</strong>: Community Manager</p>
<p>Password rules can be set:</p>
<ul>
	<li>Via the Community Manager developer portal user interface: <strong>Admin</strong> &gt; <strong>Settings</strong> &gt; <strong>Password</strong>, as shown below.
	<p><img src="images/ph_cm_settings_password_policy.png" alt="Password Policy page" /></p></li>
	<li>Via an <a href="../../cm/api/businesses/m_businesses_updatePasswordPolicy.htm">API call</a> into the system.</li>
</ul>
<p><a href="#top">Back to top</a></p>


<h3 id="turning_off_user_account_enumeration">Turning off User Account Enumeration</h3>
<p>User Account Enumeration occurs when the Community Manager user interface provides direct feedback to a user during the signup and registration processes to the effect that a user account already exists or is already registered. If this is turned off, no useful feedback is provided to the user, minimizing the security risk, but decreasing usability.</p>
<p><strong>Scope</strong>: All Community Manager Containers</p>
<p>In Community Manager, choose <strong>Admin</strong> &gt; <strong>Settings</strong> &gt; <strong>Security</strong> &gt; <strong>Allow User Enum</strong>.</p>
<p>For an illustration, see <a href="#cm_security_allowlist">Enforcing an allowlist for cross-site scripting prevention</a> below.</p>
<p>For more information, see <a href="../../cm/learnmore/site_admin_settings.htm#settings_config_security_business">How do I configure settings for business security?</a> (Community Manager developer portal help)</p>
<p><a href="#top">Back to top</a></p>


<h3 id="disallowing_user_profile_modification">Disallowing User Profile Modification</h3>
<p>User Profile Modification permits a user access to their own profile for modification. In some circumstances, you may wish to prevent this (e.g. when user accounts are pre-provisioned).</p>
<p><strong>Scope</strong>: All Community Manager Containers</p>
<p>In Community Manager, User Profile Modification configuration can be found under <strong>Admin</strong> &gt; <strong>Settings</strong> &gt; <strong>Security</strong>: Allow users to modify their own profiles (enabled/disabled).</p>
<p>For an illustration, see <a href="#cm_security_allowlist">Enforcing an allowlist for cross-site scripting prevention</a> below.</p>
<p>For more information, see <a href="../../cm/learnmore/site_admin_settings.htm#settings_config_security_business">How do I configure settings for business security?</a> (Community Manager developer portal help)</p>
<p><a href="#top">Back to top</a></p>



<h3 id="comments_limit_file_type">Limiting file types allowed for upload</h3>
<h4 class="stamp">Valid in Version: 2019.1.0 and later</h4>
<p>In the Community Manager developer portal, you can restrict the media types allowed for uploading to comments, discussions, tickets, alerts, or reviews. The default allows any media type.</p>
<p>This setting is configured by the Site Admin. Choose <strong>More</strong> &gt; <strong>Admin</strong> &gt; <strong>Settings</strong> &gt; <strong>Security</strong> &gt; <strong>Limit file types allowed for upload</strong>.</p>
<p>For an illustration, see <a href="#cm_security_allowlist">Enforcing an allowlist for cross-site scripting prevention</a> below.</p>
<p>For more information, see <a href="../../cm/learnmore/site_admin_settings.htm#settings_config_security_business">How do I configure settings for business security?</a> (Community Manager developer portal help)</p>
<p><a href="#top">Back to top</a></p>



<h3 id="cm_security_allowlist">Enforcing an allowlist for cross-site scripting prevention</h3>
<h4 class="stamp">Valid in Version: 2019.1.11 and later</h4>
<p>In the Community Manager developer portal, you can enforce an allowlist for cross-site scripting prevention.</p>
<p>When you enable this feature, only the characters specified in the allowlist are allowed, other than defaults such as characters, numbers, and common punctuation.</p>
<p>This setting is configured by the Site Admin. Choose <strong>More</strong> &gt; <strong>Admin</strong> &gt; <strong>Settings</strong> &gt; <strong>Security</strong> &gt; <strong>Enforce allowlist for cross-site scripting prevention</strong>.</p>
<p><img src="images/ph_cm_settings_security.png" alt="Community Manager developer portal Security Settings page" title="Community Manager developer portal Security Settings page" /></p>
<p>For more information, see <a href="../../cm/learnmore/site_admin_settings.htm#settings_config_security_business">How do I configure settings for business security?</a> (Community Manager developer portal help)</p>
<p><a href="#top">Back to top</a></p>




<h3 id="malicious_pattern_policy_on_apis">Adding the Malicious Pattern Detection policy to Community Manager developer portal APIs that support file upload</h3>
<p>It's a good idea to attach the HTTP Malicious Pattern Detection Policy to all Community Manager developer portal APIs that support upload. This provides a layer of protection against upload of malicious content.</p>
<p>The following services in the Akana API Platform API include operations that support upload:</p>
<ul>
		<li>ApplicationAPI (Apps service) (certificate upload)</li>
		<li>ApiRESTApi (APIs service)</li>
		<li>BoardAPI (Boards service) (image and file upload)</li>
		<li>BusinessAPI (Businesses service) (certificate upload)</li>
		<li>ClientServicesAPI (Client Services service) (keystore upload from Test Client)</li>
		<li>ConsoleResourceAPI (Console Resources service) (file upload)</li>
		<li>OAuthClientApi (keystore upload from Test Client)</li>
		<li>ContentAPI (Content service) (file upload, API docs and UI customization files)</li>
		<li>GroupAPI (Groups service)</li>
		<li>WorkflowAPI (Workflow service)</li>
		<li>DropboxApi (Dropbox service) (image and file upload)</li>
		<li>UserAPI (Users service)</li>
		<li>TenantAdministrationAPI (Tenant Administration service)</li>
</ul>
<p>Links to details about the above services are available in either or both of the following locations:</p>
<ul>
	<li>Authored API documentation: On the <a href="../../cm/api/index.htm">Akana API Platform API</a> home page</li>
	<li>Landing page for generated API documentation: <a href="../../ag/generated_docs/apidoc_restApiDocs.htm" title="Landing page for generated REST API docs" target="_blank">http://docs.akana.com/ag/apidoc_restApiDocs.htm</a></li>
</ul>
<h4>To attach the policy to a service</h4>
<ol>
	<li>Define the policy. For information about this policy, see <a href="../../ag/policies/policy_op_http_malicious_pattern_detection.htm">Using the HTTP Malicious Pattern Detection Policy</a>.</li>
	<li>In Policy Manager, in the Organization Tree, locate your Akana API Platform services. An example is shown below.
	<p><img src="images/ph_201800_services.jpg" alt="Locating CM services in PM" /></p></li>
	<li>Click through to the applicable service. In the <strong>Policy Attachments</strong>, <strong>Operational</strong> section, click <strong>Manage</strong>.</li>
	<li>Add the policy and save your changes.</li>
</ol>
<p><a href="#top">Back to top</a></p>