---
layout: page
title: Monitoring the health of a container
description: Learn how to use the Akana System Health tool to monitor container health.
product: sp
category: learn
weight: 6
sub-nav-class: Monitoring
type: page
nav-title: System Health Tool
---
<h1 id="top">Monitoring the Health of a Container: Akana System Health Tool</h1>
<p>This technical note provides information about the Akana System Health tool and its associated API.</p>
<div class = "divider1"></div>



<h2 style="color: gray;">Table of Contents</h2>
<ol class="table_of_contents">
	<li><a href="#summary">Overview</a></li>
	<li><a href="#configuration">Configuration</a></li>
	<li><a href="#panels">Panels</a></li>
	<li><a href="#settings">Settings</a></li>
	<li><a href="#system_health_tool_api">System Health Tool API</a></li>
	<li><a href="#links">System Health Tool API: Links</a></li>
	<li><a href="#thresholds">Thresholds</a></li>
	<li><a href="#checking_health_stats">Checking Health Statistics</a></li>
	<li><a href="#custom_panel">Custom Panel</a></li>
	<li><a href="#field_info">System Health tool: additional information</a></li>
	<li><a href="#next">What's Next?</a></li>
	<li><a href="#monitoring_load_balancing">Monitoring Container Status with Load Balancing</a></li>
</ol>
<div class = "divider1"></div>



<h2 id="summary">Overview</h2>
<p>Before API Platform version 8.2, container health statistics were only available visually through the Monitoring Tool (see <a href="using_admin_monitoring_tool.htm" title="monitoring tool">Using the Admin Monitoring Tool</a>). 
Since these statistics were only available through the GUI, there was no way to use the data for operational use. With the introduction of the System Health Tool in version 8.2, you can now retrieve these health statistics by making a GET call to any Akana container. In addition, the System Health Tool allows thresholds to be configured for any monitored attributes, providing the means to get information on any values that fall outside normal or expected ranges.</p>
<p>This is a feature of the core platform and can be leveraged by all containers, including Policy Manager, Community Manager, and Envision. A primary use case for this tool is to check the health of the container to determine if it is ready to handle traffic.</p>
<p>The health statistics available are the same as the Monitoring Tool, which means that any standard OSGi <a href="https://osgi.org/javadoc/r4v42/org/osgi/service/monitor/Monitorable.html">Monitorable</a> instance in the system can be tracked, including but not limited to:</p>
<ul>
	<li>Outgoing HTTP connection pool statistics</li>
	<li>Incoming HTTP thread pools</li>
	<li>Database connection pools</li>
	<li>Container memory usage</li>
	<li>Usage monitoring queues</li>
	<li>JMS connections</li>
	<li>Container configuration state</li>
	<li>Container lifecycle</li>
</ul>
<p><strong>Note</strong>: The system health statistics reflect real-time information about the container. The System Health Tool does not store this information. You can either view real-time information, or you can have an external monitoring tool call the System Health Tool so that you can store and track the data.</p>
<p>All real-time. If they have their own monitoring tool they can call the health APIs and store the info in their monitoring tool. </p>
<p><a href="#top">Back to top</a></p>



<h2 id="configuration">Configuration</h2>
<p>All containers for version 8.2 and later have the System Health Tool installed when any of the PM, CM, or ND features are installed. No additional configuration is required.</p>
<p>You can explore this feature through the <strong>Health</strong> tab in the Akana Administration Console:</p>
<p><img src="images/health_screenshot_1.png" alt="Health tab" /></p>
<p><a href="#top">Back to top</a></p>



<h2 id="panels">Panels</h2>
<p>A panel is a grouping of various types of system health information. Each panel can have any combination of types of system health information that you want to monitor.</p>
<p>Depending on the features installed, the <strong>Health</strong> tab will include a number of pre-configured panels. You can expand them to view detailed monitoring information, as shown below.</p>
<p><img src="images/health_screenshot_3.png" alt="detailed monitoring information" /></p>
<p><a href="#top">Back to top</a></p>



<h2 id="settings">Settings</h2>
<p>The slider in the top right corner allows you to change the frequency of the polling interval. In addition, each panel has a toggle to enable or disable authentication when accessing the 
System Health Tool API using the links provided.</p>
<p><img src="images/health_screenshot_2.png" alt="settings" /></p>
<p><a href="#top">Back to top</a></p>



<h2 id="system_health_tool_api">System Health Tool API</h2>
<p>You can access the API by using a GET method on <strong>/admin/health</strong> context for any Akana container. For example, if the container Akana Administration Console URL is <strong>http://acme.akana.com:9900/admin</strong>, the URL for the System Health Tool API is <strong>http://acme.akana.com:9900/admin/health/measurables/akana.system.health</strong>.</p>
<p>For an example request and response to a System Health tool status call, see <a href="#checking_health_define_resp_code_examples">Using Response Codes to Monitor Status: Examples</a> below.</p>
<p>The API response provides an overview of the available health monitors (named <strong>measurables</strong>), and a set of links that provide access to more detailed information. Each of the measurables in the response corresponds to a monitoring panel shown on the Akana Administration Console.</p>
<p>For more information about the System Health tool API, refer to the generated documentation. Go to <a href="../../ag/apidoc_restApiDocs.htm">REST API Documentation</a>. In the <strong>Akana Platform API Documentation</strong> section (second section), choose the version for your installation, and then choose <strong>Health Service</strong>.</p>
<p><a href="#top">Back to top</a></p>



<h2 id="links">System Health Tool API: Links</h2>
<p>You can follow each of the links on the response to view different health dimensions as well as the configuration info.</p>
<p>For example, to get detailed information on the <strong>akana.system.health</strong> category, you would perform an HTTP GET using the <strong>self</strong> link. In the above example, the link is <strong>http://acme.akana.com:9900/admin/health/measurables/akana.system.health</strong>.</p>
<p>Or, for example, if you want to view all the available configurable options, you can fetch <strong>http://acme.akana.com:9900/admin/health/available</strong>.</p>
<p>For more information about the System Health tool API, refer to the generated documentation. Go to <a href="../../ag/apidoc_restApiDocs.htm">REST API Documentation</a>. In the <strong>Akana Platform API Documentation</strong> section (second section), choose the version for your installation, and then choose <strong>Health Service</strong>.</p>
<p><a href="#top">Back to top</a></p>



<h2 id="thresholds">Thresholds</h2>
<p>Each health monitor may have a set of threshold settings. These settings are used to indicate current health status using three values: <strong>NORMAL</strong>, <strong>WARNING</strong>, or <strong>FAILURE</strong>.</p>
<p>System default health monitors have the threshold ranges predefined. To view or modify the values, go to the Akana Administration Console and click the status icon, as shown below.</p>
<p><img src="images/health_screenshot_5.png" alt="warning threshold" /></p>
<p>Thresholds are defined using the Apache Java Expression Language syntax. For more information, refer to <a href="http://commons.apache.org/proper/commons-jexl/reference/syntax.html">the JEXL overview on the Apache Commons site</a>. Currently, only a single variable named <strong>value</strong> is accessible, which is the current value of the monitored property.</p>
<p><a href="#top">Back to top</a></p>



<h2 id="checking_health_stats">Checking Health Statistics</h2>
<p>You can check the system health information by following the links provided in the health monitor's panel.</p>
<p>An example of how you can use this feature is to provide load balancers with an appropriate status based on the health of any aspect of container operation.</p>
<p><img src="images/health_screenshot_4.png" alt="links" /></p>



<h3 id="checking_health_define_resp_code">Using query parameters to define the HTTP response status code</h3>
<p>If the health category is NORMAL, WARNING, or FAILURE, you can use an optional set of query parameters to control the HTTP status code returned for each of the thresholds. This avoids the need to parse the JSON response content, allowing decisions to be made solely on the response code.</p>
<p>The following query parameters are valid for specifying response HTTP status when you run the GET operation on the health category:</p>
<ul>
	<li>normal-status</li>
	<li>warning-status</li>
	<li>failure-status</li>
</ul>
<p>In the example below, the GET call to check container readiness sets a warning status of 503 and a failure status of 503. This will return 503 until the health check is in the NORMAL state, at which point it will return 200.</p>
<p><strong>GET http://acme.akana.com:9900/admin/health/measurables/akana.service.container.readiness?brief=true&amp;warning-status=503&amp;failure-status=503</strong></p>
<p><a href="#top">Back to top</a></p>



<h2 id="custom_panel">Custom Panel</h2>
<p>To display a custom set of system health statistics, you can create your own panel. To create a new panel, click the <strong>plus</strong> icon. Once the panel has been created, you can then add your own combination of health monitors.</p>
<p>The sample custom panel below is configured on the Policy Manager container and is called <strong>Health Monitoring for ACME</strong>. The failure threshold is set to anything below the currently provisioned number of PM APIs.</p>
<p>The threshold below defines a normal condition where there is greater than 20% of capacity remaining in the pool.</p>
<p><img src="images/health_screenshot_6.png" alt="links" /></p>
<p>The threshold below defines a warning condition where between 20% and 5% of capacity remains in the pool.</p>
<p><img src="images/health_screenshot_7.png" alt="links" /></p>
<p>The threshold below defines a failure condition when less than 5% of capacity remains in the pool.</p>
<p><img src="images/health_screenshot_8.png" alt="links" /></p>
<p>To check the status of this custom panel, you would simply follow the links provided, which in this case might be 
<strong>http://acme.akana.com:9900/admin/health/measurables/health.monitoring.for.acme</strong>.</p>
<p><a href="#top">Back to top</a></p>



<h2 id="field_info">System Health tool: additional information</h2>
<p>Each of the settings in the System Health tool has field-level help. This field-level help is also available in the generated documentation, in the /docs folder of your installation and online. You can review:</p>
<ul>
	<li>System Health Tool API generated documentation: See <a href="../../ag/apidoc_restApiDocs.htm" title="Link to generated REST API doc landing page" target="_blank">http://docs.akana.com/ag/apidoc_restApiDocs.htm</a>; follow the link for the Akana Platform REST APIs (bottom of the page) for the version you're on, and choose Health Service.</li>
</ul>
<p>The Health Monitor API returns information for a specific container. When reviewing container health, make sure you review the information for the correct container, or for all containers if needed. Note that each container might not have all the health statistics, depending on the container. For example, an ND container won&rsquo;t have any DB stats as it doesn&rsquo;t connect to the database.</p>

<h4 id="system_health_recs">General recommendations</h4>
<p>How you use the System Health tool is entirely your own choice. However, here are some general recommendations of key items that it might be a good idea to monitor:</p>
<ul>
	<li>It's a good idea to monitor CPU and memory at the VM level. Notes re <strong>com.soa.vmstats</strong>:
<ul>
			<li>The memory usage might fluctuate a lot depending on the use of the container.</li>
			<li>A high memory usage does not indicate a specific issue other than that the container is under load or processing data of some sort.</li>
		</ul>
	</li>
	<li>For containers connecting to the database, it's a good idea to monitor <strong>com.soa.db.stats</strong> – <strong>available.pool.headroom.pct</strong> OR <strong>available.pool.headroom</strong>. This shows how many connections are being used by the DB. If it gets too high, potentially the container will run out of database connections in the pool, and errors might start occurring.</li>
	<li><strong>akana.health.lifecycle – lifecycle.state</strong>: this indicates that the container is <strong>STARTED</strong> (or not).</li>
	<li><strong>com.soa.container.config.config.stats – configuration.state</strong>: make sure that the state is <strong>CONFIGURED</strong>.</li>
	<li><strong>com.soa.transport.http.client</strong> – <strong>pool.headroom</strong> OR <strong>pool.headroom.pct</strong>: this indicates the available connections in the pool for outbound HTTP traffic from the container. For a Network Director container, this generally means connections to Policy Manager and connections to the backend service. For PM/CM, it is still for outbound HTTP traffic but less of a concern. In either case, if the available space is starting to reach its max the container potentially might not have connections available to make any outbound HTTP traffic.</li>
	<li><strong>soa.jetty.connector</strong> – <strong>connections.open</strong> OR <strong>connections.open.max</strong>: this indicates the connections being used for each inbound listener on the container. If the connections are near the max configured number, there might not be connections available for inbound traffic. </li>
</ul>
<p><a href="#top">Back to top</a></p>



<h2 id="next">What's Next?</h2>
<p>Container health data can be polled and collected into a data store. You can use the collected data to gain valuable operational insight.</p>
<p><a href="#top">Back to top</a></p>



<h2 id="monitoring_load_balancing">Monitoring Container Status with Load Balancing</h2>
<p>In a typical production Akana deployment, the Akana containers are deployed in a cluster and behind a load balancer. The diagram below shows the Network Director behind a load balancer. An application invokes an API hosted on the Network Director through the load balancer.</p>
<p>It is important that the Network Director is functioning, and all the APIs are deployed on it, before any API is invoked. This helps avoid 404 errors being returned to the application/consumer.</p>
<p>This configuration is applicable for any of the Akana containers that are behind a load balancer (for example, Policy Manager, Community Manager, OAuth Provider).</p>
<p><img src="images/health_flowchart.png" alt="Container health with load balancing: flowchart" /></p>
<p>To ensure that the Network Director or container is ready to receive requests, the load balancers should be configured to monitor the state of the container using the Load Balancer's system health check URL. This URL returns one of the following:</p>
<ul>
	<li>An HTTP 200 status code if the container ready to process inbound traffic.</li>
	<li>An HTTP 503 status code if the container is still coming up.</li>
</ul>
<p>All the Akana containers that are configured behind a Load Balancer should use the Load Balancer's system health check URL to monitor system health status. </p>
<p>Configure the following container system health check URL in the Load Balancer and check for the following status codes.</p>
<p><strong>Method</strong>: GET</p>
<p><strong>URL</strong>: <span class="apidoc_code">http(s)://&lt;container_admin_host&gt;:&lt;container_port&gt;/admin/health/measurables/akana.service.container.readiness?normal-status=200&amp;failure-status=503&amp;warning-status=503&amp;brief=true</span></p>
<p><strong>HTTP Status Codes</strong>:</p>
<ul>
	<li><strong>200</strong>&#8212;Container is ready, the services/apis are deployed and the container can receive requests.</li>
	<li><strong>503</strong>&#8212;Container is still not ready to receive requests. </li>
</ul>


<h3 id="checking_health_define_resp_code_examples">Using Response Codes to Monitor Status: Examples</h3>
<p>An example of the request and responses are below.</p>


<h4>Request</h4>
<pre>GET https://10.1.16.24:8867/admin/health/measurables/akana.service.container.readiness?normal-status=200&amp;failure-status=503&amp;warning-status=503&amp;brief=true HTTP/1.1
Host: 10.1.16.24:8867
Connection: Keep-Alive
User-Agent: Apache-HttpClient/4.1.1 (java 1.5)</pre>

<h4>Response headers: Container is still coming up and is not ready to receive requests</h4>
<pre>HTTP/1.1 503 Service Unavailable
Date: Tue, 05 Nov 2019 17:13:46 GMT
Content-Type: application/json
Transfer-Encoding: chunked</pre>

<h4>Response content: Container is still coming up and is not ready to receive requests</h4>
<pre>{
  "id":"akana.service.container.readiness",
  "name":"Service Container Readiness",
  "path":"akana.service.container.readiness",
  "state":"FAILURE",
  "childCount":7,
  "editable":false,
  "options":{
    "enableAuth":true,
    "links":[
      {
        "rel":"self",
        "href":"https://10.1.16.24:8867/admin/health/measurables/akana.service.container.readiness/configuration"
      }
    ]
  },
  "links":[
    {
      "rel":"self",
      "href":"https://10.1.16.24:8867/admin/health/measurables/akana.service.container.readiness"
    },
    {
      "rel":"brief",
      "href":"https://10.1.16.24:8867/admin/health/measurables/akana.service.container.readiness?brief=true"
    },
    {
      "rel":"children",
      "href":"https://10.1.16.24:8867/admin/health/measurables/akana.service.container.readiness/children"
    },
    {
      "rel":"options",
      "href":"https://10.1.16.24:8867/admin/health/measurables/akana.service.container.readiness/configuration"
    }
  ]
}</pre>


<h4>Response headers: Container is ready to receive traffic</h4>
<pre>HTTP/1.1 200 OK
Date: Tue, 05 Nov 2019 17:12:20 GMT
Content-Type: application/json
Vary: Accept-Encoding, User-Agent
Transfer-Encoding: chunked</pre>


<h4>Response content: Container is ready to receive traffic</h4>
<pre>{
  "id":"akana.service.container.readiness",
  "name":"Service Container Readiness",
  "path":"akana.service.container.readiness",
  "state":"NORMAL",
  "childCount":7,
  "editable":false,
  "options":{
    "enableAuth":true,
    "links":[
      {
        "rel":"self",
        "href":"https://10.1.16.24:8867/admin/health/measurables/akana.service.container.readiness/configuration"
      }
    ]
  },
  "links":[
    {
      "rel":"self",
      "href":"https://10.1.16.24:8867/admin/health/measurables/akana.service.container.readiness"
    },
    {
      "rel":"brief",
      "href":"https://10.1.16.24:8867/admin/health/measurables/akana.service.container.readiness?brief=true"
    },
    {
      "rel":"children",
      "href":"https://10.1.16.24:8867/admin/health/measurables/akana.service.container.readiness/children"
    },
    {
      "rel":"options",
      "href":"https://10.1.16.24:8867/admin/health/measurables/akana.service.container.readiness/configuration"
    }
  ]
}</pre>
<p><a href="#top">Back to top</a></p>