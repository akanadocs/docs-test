---
layout: page
title: Using the External Keystore Feature
description: Learn how to enable your own hardware security module (HSM) as an external keystore for storing and managing Policy Manager PKI keys and certificates.
product: sp
category: learn
sub-nav-class: Security
weight:	6
type: page
nav-title: Using the External Keystore Feature
---
<h2 id="top">Using the External Keystore Feature</h2>
<p>Learn how to enable your own hardware security module (HSM) as an external keystore for storing and managing Policy Manager PKI keys and certificates.</p>
<div class = "divider1"></div>
 <h3 style="color: gray;">Table of Contents</h3>
<ol class="table_of_contents">
	<li><a href="#introduction">Introduction</a></li>
	<li><a href="#prereq_hsm">Step 1: Prerequisites - HSM Device</a></li>
	<li><a href="#prereq_pm">Step 2: Prerequisites - Platform Installation</a></li>
	<li><a href="#create_containers">Step 3: Create Policy Manager / Network Director Containers</a></li>
	<li><a href="#install_externalkeystore">Step 4: Install External Keystore Feature</a></li>
	<li><a href="#install_pmfeatures">Step 5: Install Policy Manager Features</a></li>
	<li><a href="#configure_keystore">Step 6: Configure External Keystore Options</a></li>
	<li><a href="#verify_keystore">Step 7: Verify External Keystore Installation</a></li>
	<li><a href="#assignadminkeys">Step 8: Assign Keys for Administrator Account</a></li>
	<li><a href="#configurend">Step 9: Configure Network Director</a></li>
</ol>
<div class = "divider1"></div><p></p>



<h3 id="introduction">Introduction</h3>
<p>Policy Manager provides an <strong>External Keystore Feature</strong> that allows you to enable a Hardware Security Module (HSM) security provider as your cryptography solution for storing and managing Policy Manager PKI keys and certificates. After the feature is installed, all key management tasks performed using the <strong>Manage PKI Keys Wizard</strong> for each identity (service, organization, container, or user) will be stored in the designated external keystore.
</p>
<p>Some important points to note:</p>
<ul>
	<li>Policy Manager and Network Director must be installed in separate containers.</li>
	<li>The <strong>External Keystore Feature</strong> must be installed in each of these containers.</li>
	<li>Policy Manager and Network Director containers can be stored on the same hardware device (if you are using a simple USB version of HSM).</li>
	<li> It is also possible to use different HSM devices (i.e., different external keystore) for Policy Manager, Network Director, and Agent containers. In this case, the key / aliases must be synced between each HSM device.</li>
</ul>
<p><strong>Note: This topic provides a simple use case for a Policy Manager / Network Director installation where both products are installed on the same hardware device. Policy Manager and Network Director are installed in separate containers, the External Keystore Feature is installed on each container, and are both referencing the same keystore.</strong></p>
<p>Here's how it works:</p>
<ul>
	<li>First you perform a list of prerequisite steps to configure your HSM (see <a href="#prereq_hsm">Step 1: Prerequisites - HSM Device</a>) and for the Platform (see <a href="#prereq_pm">Step 2: Prerequisites - Platform Installation</a>).</li>
	<li> When Policy Manager is initially installed, it creates a default keystore where all the PKI keys and certificates are stored. To replace the Policy Manager keystore with your own HSM, you must install and configure the <strong>External Keystore Feature</strong> prior to installing the <strong>Policy Manager Console</strong> and <strong>Policy Manager Services</strong> features and configure a series of external keystore options (Provider Name, Key Store Type, Keystore Location, and Keystore Password) to integrate your HSM with Policy Manager. You obtain the external keystore information for your HSM as part of the prerequisite steps.</li>
	<li>After the feature is installed, all key management tasks performed using the Manage PKI Keys Wizard for any identity will be stored in the designated external keystore.</li>
</ul>
<p><a href="#top">back to top</a></p>



<h3 id="prereq_hsm">Step 1: Prerequisites - HSM Device</h3>
<p>HSM modules come in different forms including (i.e., plug-in card, external device attached to computer or server, networked HSM, etc.). Each module requires setup instructions that are unique to the device but generally the tasks are similar. The following list represents a list of general configuration tasks that should be completed on your HSM prior to installing the<strong> External Keystore Feature</strong>.
</p>
<p><strong><strong>Note:</strong> Steps marked with * represent input required to configure the External Keystore or java.security file.</strong></p>
<ul>
	<li><strong>Install Options</strong> - Represents the initial installation tasks for the HSM device or encryption engine software.</li>
	<li><strong>Configure Service Ports</strong> - Configure private and non-private ports.</li>
	<li><strong>Initialize Device</strong> - Generates secrets that protect operator cards and keys.</li>
	<li><strong>Select FIPS Service Level </strong>- The <strong>External Keystore Feature</strong> supports FIPS Service Level II and III. See the <a href="http://en.wikipedia.org/wiki/FIPS_140-2">FIPS 140-2 Wiki</a> for more information. <strong><strong>FIPS Support for importing external private keys:</strong></strong> FIPS 140-2 level II allows import of external private keys. You cannot import external private keys into an HSM that is FIPS-140-2 level III compliant.</li>
	<li><strong>Configure Operator Card Set</strong> - Cards that authorized personal are issued to operate the HSM device.</li>
	<li><strong>Start System Services</strong> - This represents service startup tasks for the device.</li>
	<li><strong>Obtain HSM Security Provider .jar file* </strong>- This file must be copied in the Policy Manager lib/ext folder as part of the security.provider configuration task (covered in Prerequisites - Platform Installation)</li>
	<li><strong>Obtain HSM Provider Name</strong>* - Obtain the official &quot;Provider Name&quot; from the HSM vendor. This name must be supplied when configuring the <strong>External Keystore Feature</strong>.</li>
	<li><strong>Obtain HSM Security Provider Name</strong>* - Obtain the official &quot;Security Provider&quot; name of the HSM. This name will be added to the java.security file in the Akana Platform installation directory.</li>
	<li><strong>Obtain HSM Key Store Type</strong>* - Obtain the &quot;Key Store Type&quot; from the HSM vendor. This name must be supplied when configuring the <strong>External Keystore Feature</strong>.</li>
</ul>
<p><a href="#top">back to top</a></p>



<h3 id="prereq_pm">Step 2: Prerequisites - Platform Installation</h3>
<ul>
	<li><strong>Copy HSM .jar File</strong> - Copy the HSM security.provider .jar file from the java\classes directory of your HSM to the<strong> \{release_folder}\jre\lib\extlib\ext</strong> folder of your Platform installation directory.</li>
	<li><strong>Add HSM Security Provider to java.security file </strong> - Go to <strong>{release_folder}\jre\lib\security</strong> of the Platform installation directory, load the java.security file into a text editor and add your HSM security provider. Note that provider order must be lower than SunJCE provider.
	<p><img src="images/prereq_pm_security_provider.jpg" alt="Example of adding security provider to java.security" /></p></li>
</ul>
<p><a href="#top">back to top</a></p>



<h3 id="create_containers">Step 3: Create Policy Manager / Network Director Containers</h3>
<ol>
	<li>Launch the <strong>Configure Container Instance Wizard </strong> and define container for Policy Manager and Network Director, then follow the configuration instructions for each container (below). For more information on configuring the container, refer to the installation documentation for your version.</li>
</ol>
<p><a href="#top">back to top</a></p>



<h3 id="install_externalkeystore">Step 4: Install External Keystore Feature</h3>
<ol>
	<li>Launch the <strong>Administration Console </strong>(http://&lt;hostname:&lt;port&gt;/admin/).</li>
	<li>On the <strong>Installed Features</strong> screen, select <strong>Plug-in</strong> from the <strong>Filter</strong> menu.</li>
	<li>Select the <strong>External Keystore Feature</strong> and click <strong>Install Feature</strong>.</li>
	<li>After the installation is complete, click <strong>Close</strong>. Do not select <strong>Configure</strong>.</li>
</ol>
<p><a href="#top">back to top</a></p>



<h3 id="install_pmfeatures">Step 5: Install Policy Manager Features</h3>
<ol>
	<li>On the <strong>Available Features</strong> screen, select <strong>Product Feature </strong> from the <strong>Filter</strong> menu.</li>
	<li>Install the Policy Manager features (<strong>Policy Manager Services</strong> and <strong>Policy Manager Console</strong>).</li>
	<li>When the installation is complete, click <strong>Configure</strong>. The <strong>External Keystore Options</strong> screen displays.</li>
</ol>
<p><a href="#top">back to top</a></p>



<h3 id="configure_keystore">Step 6: Configure External Keystore Options</h3>
<ol>
	<li>On the <strong>External Keystore Options </strong>screen, specify the Provider Name and Key Store Type (you obtained as part of the <a href="#prereq_hsm">HSM Device prerequisite tasks</a>), enter a Key Store Location, and assign a Key Store Password.
	<p><img src="images/external_keystore_options.jpg" alt="" /></p></li>
	<li>You must also set the Encyrption option.
		<ul>
			<li>If Encrypted=True, Policy Manager will attach the alias, and Network Director will obtain the private key directly from external keystore using the alias provided by Policy Manager.</li>
			<li>If Encrypted=False, Policy Manager will attach the encrypted private key directly to WSDL. If you are using an HSM external keystore, the &quot;Encryption&quot; option must by checked.</li>
			<li>If you are using another type of encryption engine, such as Sun JCE, encryption can be checked or unchecked.</li>
		</ul>
	</li>
	<li>After completing your entries, click <strong>Finish</strong>, then complete the remainder of the Policy Manager configuration. Refer to the installation instructions for your version.</li>
	<li>Restart the container as prompted by the configuration.</li>
</ol>
<p><a href="#top">back to top</a></p>



<h3 id="verify_keystore">Step 7: Verify External Keystore Installation</h3>
<ol>
	<li>After the system has restarted, verify that the PKI keys are not stored in the Database. Policy Manager only stores the alias and encrypted password for external keystore entries.
	<p><img src="images/verify_database.jpg" alt="" /></p></li>
	<li>You can also verify that the Policy Manager secret key is not being stored in the database. All the key and seed entries for the pmdomain user are null.
	<p><img src="images/verify_secret.jpg" alt="" /></p></li>
</ol>
<p><a href="#top">back to top</a></p>



<h3 id="assignadminkeys">Step 8: Assign Keys for Administrator Account</h3>
<ol>
	<li>When you install the <strong>External Keystore </strong>feature keys are not automatically assigned to the Policy Manager Administrator User account (as they are when you are using the Policy Manager default keystore), so you must generate them.
	<p><strong><strong>Note:</strong> This same process is performed for key management performed on service, organization, container, or user identities. </strong>Refer to <a href="key_management.htm">Key Management</a> for a list of <strong>Manage PKI Key Wizard</strong> options available for each identity type.</p></li>
	<li>Launch the Policy Manager Management Console and go to <strong>Security &gt; Users</strong>. Select the Administrator user account, and click <strong>Manage PKI Keys</strong>. Select a Key Management option based on your requirements.
		<ul>
			<li>If you select the<strong> Generate PKI Keys and X.509 Certificate</strong> option you can configure a new alias to assign keys. This alias will then be stored in your external keystore.</li>
			<li>You can also select an existing alias that is already defined in the keystore to assign the keys too on the <strong>Assign Keys from External Keystore</strong> screen. You can get to this screen by clicking <strong>Next</strong> on the Generate PKI Keys and X.509 Certificate screen without specifying a new alias.
			<p><img src="images/assign_keys_external.jpg" alt="" /></p></li>
		</ul>
	</li>
	<li>When you've completed your entries click <strong>Finish</strong>.</li>
</ol>
<p><a href="#top">back to top</a></p>



<h3 id="configurend">Step 9: Configure Network Director</h3>
<ol>
	<li>Launch the <strong>Administration Console </strong>(http://&lt;hostname:&lt;port&gt;/admin/) for the Network Director container instance.</li>
	<li>On the <strong>Available Features</strong> screen, select <strong>Network Director</strong> and <strong>External Keystore</strong> features, and click <strong>Install Features</strong>.</li>
	<li>When the installation is complete, click <strong>Configure</strong>. The <strong>External Keystore Options</strong> screen displays.</li>
	<li>Specify the Provider Name and Key Store Type (you obtained as part of the HSM Device prerequisite tasks), enter a Key Store Location, and assign a Key Store Password.
		<p><strong><strong>If you are using one external keystore for all container instances</strong></strong>, enter the same values you used to configure the external keystore on the Policy Manager container instance.</p>
		<p><strong><strong>If you are using a different external keystore for your Network Director container instance</strong></strong>, enter the unique values for the external keystore. After completing the configuration refer to the <strong>Generate Options &gt; Generate PKI Keys and X.509 Certificate &gt; External Keystore</strong> section of <a href="key_management.htm">Managing Keys and Certificates</a> to learn how to reference an alias in the Network Director keystore using the <strong>Manage PKI Keys Wizard</strong>.</p>
		<p><img src="images/external_keystore_options.jpg" alt="" /></p></li>
	<li>Click <strong>Finish</strong> and complete the remainder of the Network Director configuration.</li>
	<li>Register Network Director with Policy Manager using the <strong>Add Container Wizard</strong>.
		<p><img src="images/add_container_wizard.jpg" alt="" /></p></li>
	<li>Configure a contract, physical and virtual services, and host on Network Director.</li>
	<li>Send requests to Network Director and verify they are processed successfully.</li>
	<li>The configuration is now complete. All key management tasks performed by the <strong>Manage PKI Keys Wizard</strong> for each identity type will now be stored in the external keystore. <strong> </strong>Refer to <a href="key_management.htm">Managing Keys and Certificates</a> for <strong>Manage PKI Key Wizard</strong>e. available options for each identity type.</li>
</ol>
<p><a href="#top">back to top</a></p>




<div class = "divider1"></div>