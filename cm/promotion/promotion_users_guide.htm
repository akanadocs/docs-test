---
layout: page
title: Promotion Guide | Lifecycle Coordinator | Akana API Platform Help
description: Learn how to use the Lifecycle Coordinator feature to manage the promotion lifecycle
product: cm
category: learn
sub-nav-class: Lifecycle Coordinator
weight: 20
type: page
nav-title: Promotion Guide
---
<h2 id="top">Lifecycle Coordinator Promotion Guide</h2>
<p>Provides information about how to use the Lifecycle Coordinator feature to manage the promotion feature.</p>
<h5 class="stamp">API Platform Version: 8.4.3 and later</h5>
<div class = "divider1"></div>


<h3 style="color: gray;">Table of Contents</h3>
<ol class="table_of_contents">
  <li><a href="#overview">Overview</a></li>
  <li><a href="#core_components">Core Components and Component Interaction</a></li>
  <li><a href="#topology_model">Topology Model</a>
    <ol>
      <li><a href="#s03_01">Topology</a></li>
      <li><a href="#s03_02">Tenants</a></li>
      <li><a href="#s03_03">Environments</a></li>
      <li><a href="#s03_04">Promotion Profiles</a></li>
      <li><a href="#s03_05">Asset Filters</a></li>
      <li><a href="#s03_06">Rules</a></li>
      <li><a href="#s03_07_00">Asset Model</a></li>
    </ol>
  </li>
  <li><a href="#lc_installation">Lifecycle Coordinator Installation</a>
   <ol>
      <li><a href="#lc_install_feature">Installing the Lifecycle Coordinator feature</a></li>
      <li><a href="#lc_install_secure_api">Securing the Topology REST API</a></li>
      <li><a href="#com_soa_promotion">Remote container address (com.soa.promotion)</a></li>
      <li><a href="#com_akana_lifecycle_coordinator">Properties to secure the Topology REST API (com.akana.lifecycle.coordinator)</a> (8.4.15 and later)</li>
      <li><a href="#config_preserveKeys">Unique ID Mapping behavior</a></li>
      <li><a href="#config_defaultFromEmail">Default "From Email" setting</a></li>
      <li><a href="#config_tenant_synch_interval">Tenant Synchronization Interval</a> (8.4.16 and later)</li>
    </ol>
  </li>

  <li><a href="#topology_config">Topology Configuration</a>
    <ol>
      <li><a href="#s05_01">Tenants</a></li>
      <li><a href="#s05_02">Environments</a></li>
      <li><a href="#s05_03">Promotion Profiles</a></li>
      <li><a href="#s05_04">Rules</a></li>
      <li><a href="#s05_05">Filters</a></li>
      <li><a href="#s05_06">Organization Mapping</a> (8.4.13 and later)</li>
      <li><a href="#s05_07">Policy Mapping</a> (8.4.16 and later)</li>
    </ol>
  </li>
  <li><a href="#dz_configurations">Deployment Zone Configurations</a>
(8.4.12 and later)
  <ol>
      <li><a href="#s06_01">Using Filters with Deployment Zone Configurations</a></li>
      <li><a href="#s06_02">Default Endpoint Propagation</a></li>
      <li><a href="#s06_03">Using Rules with Deployment Zone Configurations</a></li>
      <li><a href="#s06_04">Duplicate Endpoints</a></li>
    </ol>
  </li>
  <li><a href="#topology_api">Topology API</a>
    <ol>
      <li><a href="#topologyapi_01">Finding the Topology API Documentation</a></li>
      <li><a href="#topologyapi_02">Using the Topology API</a></li>
    </ol>
  </li>
  <li><a href="#lm_console">Lifecycle Manager Console</a>
    <ol>
      <li><a href="#s07_01">Logging In</a></li>
      <li><a href="#s07_02">Viewing Assets and Iterations</a></li>
      <li><a href="#s07_03">Promotion Requests</a></li>
    </ol>
  </li>
</ol>
<div class = "divider1"></div>



<h3 id="overview">Overview</h3>
<p>Promotion is the process of propagating versions of a software asset, such as an API, through a series of environments that correspond to the stages of the asset's lifecycle. For example, an API might originate in a development environment, be promoted on to a QA test environment, and finally be promoted to the production environment. Each environment has its own data model that is controlled independently. The Lifecycle Coordinator is a separate configurable component that governs the promotion process and the transfer of data between environments.</p>
<p><a href="#top">Back to top</a></p>



<h3 id="core_components">Core Components and Component Interaction</h3>
<p>The core components in the promotion process are as follows:</p>
<ul>
  <li><a href="#promotion_package">Promotion Package</a></li>
  <li><a href="#source_environment">Source Environment</a></li>
  <li><a href="#target_environment">Target Environment</a></li>
  <li><a href="#lifecycle_coordinator">Lifecycle Coordinator</a></li>
</ul>
<h4 id="promotion_package">Promotion Package</h4>
<p>The Promotion Package holds the data that needs to be promoted from the Source Environment to the Target Environment. The package contains two different artifacts:</p>
<ul>
  <li><strong>The environment data</strong>: The portion of the Source Environment's data model that needs to be promoted.</li>
  <li><strong>A manifest</strong>: Contains configuration details that can be manipulated by rules within the Coordinator before importing the package into the target environment.</li>
</ul>


<h4 id="source_environment">Source Environment</h4>
<p>The Source Environment is the data container that holds the original information that needs to be promoted to the Target Environment. The Source Environment can be managed by its own product instance or it can be managed as a single tenant in a multi-tenant product instance.</p>

<h4 id="target_environment">Target Environment</h4>
<p>The Target Environment is the data container that is the destination of the promoted data from the Source Environment. The Target Environment can be managed by its own product instance or it can be managed as a single tenant in a multi-tenant product instance.</p>

<h4 id="lifecycle_coordinator">Lifecycle Coordinator</h4>
<p>The Lifecycle Coordinator is the component that requests an extraction, or export, of a promotion package from a Source Environment and then initiates the population, or import, of the promotion package to a Target Environment.</p>
<p>The Coordinator processes the manifests contained in the Promotion Package and in the Target Environment's promotion response to maintain a model that reflects the relationship between objects in both environments. On subsequent promotions of the same objects from the Source Environment the Coordinator consults its model and generate a new manifest that will be delivered to the Target Environment.</p>
<p>The Lifecycle Coordinator is a separate component from the environments but can be co-deployed on the same instance.</p>

<h4>Component Interaction</h4>
<p><img src="images/promotion_01.jpg" alt="Component interaction" /></p>
<p>When promotion is requested from the Source Environment, the Lifecycle Coordinator exports a Promotion Package from that Environment and imports the package in the Target Environment.</p>
<p>The Lifecycle Coordinator persists its own model of objects and their relationships in all the environments it has performed promotions for. The Coordinator consults its model to see if the objects identified in the Promotion Package's manifest are already present. If the objects are not in the model, the Coordinator adds them. If the objects are in the model the Coordinator extracts the corresponding object IDs of the Target Environment and create a new manifest with the Target Environment's object IDs.</p>
<p>The Lifecycle Coordinator initiates an import of the Promotion Package in the Target Environment using an Import API. The Target Environment uses the manifest to identify the objects in its own data model that are in the Promotion Package; if objects already exist, a Modify action is performed. If the Promotion Package objects are new to the Target Environment an Add action is performed. The object IDs in the manifest are used in the Target Environment, not the object IDs found in the export content, which are still the IDs found in the Source Environment.</p>
<p>Upon completion of the Import API call a response is returned to the Lifecycle Coordinator. A manifest is included in that response that identifies the objects and relationships that were the result of the import in the Target Environment. The Lifecycle Coordinator processes this manifest and updates its own model for subsequent promotion calls.</p>
<p>The Lifecycle Coordinator can be deployed in a container separate from the API Platform(s) it governs promotions over. In this deployment, the interactions between the Lifecycle Coordinator and API Platform(s) are performed using RESTful interfaces. The Coordinator can promote between environments in the same system:</p>
<p><img src="images/promotion_02.jpg" alt="Environments in the same system" /></p>
<p>Or the Coordinator can promote between environments in separate systems.</p>
<p><img src="images/promotion_03.jpg" alt="Environments in different systems" /></p>
<p>The Lifecycle Coordinator can also be deployed in the same container as the API Platform. Whether multiple tenants are associated with Environments or just one tenant the deployment and interaction is the same. All interactions are performed using in-memory interfaces.</p>
<p><a href="#top">Back to top</a></p>




<h3 id="topology_model">Topology Model</h3>

<h4 id="s03_01">Topology</h4>
<p>A Topology defines a sequence of Environments and the specific behavior for promotion between these Environments.</p>
<p><img src="images/promotion_04.jpg" alt="Promotion behavior between environments" /></p>

<h4 id="s03_02">Tenants</h4>
<p>Tenants are defined at the top level of the Topology and represent a Community Manager (CM) tenant that may be local (within the same container) or remote from the Lifecycle Coordinator. Tenants are referenced by Environments via an id assigned to the tenant in its definition. While an Environment must reference a tenant, the same Tenant may be referenced by more than one Environment. Tenants contain information allowing the Lifecycle Coordinator to communicate with the associated CM Tenant, this includes the tenant's address, name and admin credentials.</p>
<p>A Tenant that is local may also indicate that it should be used to as an authentication source for users approving promotion requests with the Lifecycle Coordinator.</p>

<h4 id="s03_03">Environments</h4>
<p>An Environment represents a logical container to which an asset is deployed at a specific stage of its lifecycle. An Environment must specify the Tenant that supports it.</p>
<p>Environments also define the possible transitions to the next Environment in the form of Promotion Profiles. At this time, only a single target Environment can be specified in the promotion chain (Environment fan-out is not currently supported).</p>

<h4 id="s03_04">Promotion Profiles</h4>
<p>Promotion Profiles represent a transition to the next (<strong>target</strong>) Environment. A promotionProfile specifies a target Environment and optionally a set of Rules to be applied to the manifest of the promotion package of the asset prior to promotion into the target Environment. A promotionProfile might also, optionally, specify an Asset Filter. This allows multiple promotionProfiles to be defined within an Environment with mutually exclusive filters, each with a different rule set. When promotion of an asset is requested from a source Environment, and more than one promotionProfile exists, the promotionProfile with an Asset Filter that the asset complies with is used. In the case where only one promotionProfile exists (with no Asset Filter specified), that promotionProfile is automatically selected for the promotion.</p>

<h4 id="s03_05">Asset Filters</h4>
<p>Asset Filters contain a set of criteria for the custom properties of the assets being promoted. For example, an API asset may use a custom property indicating that it is PCI compliant. An Asset Filter can define criteria for that property such that only API assets that are PCI compliant will match the filter. This Asset Filter can then be assigned to a Promotion Profile such that a different set of Rules are applied to PCI-compliant and non-compliant API assets.</p>
<p class="apidoc_note"><strong>Note</strong>: the use of Asset Filters requires custom properties to be enabled for the tenants involved in the promotion.</p>

<h4 id="s03_06">Rules</h4>
<p>A Promotion Profile may optionally contain a set of rules to guide the need for changes in relationships and properties when assets are promoted. A rule consists of a condition and a behavior. The rule is provided a context when evaluated made up of an asset's properties. The condition of the rule is a Boolean expression evaluated against that context. The behavior of the rule is an expression that alters that context. The expression language used by the rule engine is JEXL. A set of syntax examples can be found at <a href="#" title="https://commons.apache.org/proper/commons-jexl/reference/syntax.html" target="_blank">https://commons.apache.org/proper/commons-jexl/reference/syntax.html</a>. Each asset in a promotion package is run through the rule engine. If any asset meets the condition of the rule, the behavior is performed against it. Some examples of rules are below.</p
>
<table cellspacing="0px" class="doctable" style="width: 98%;">
  <thead>
    <tr>
      <th width="33%">Condition</th>
      <th width="33%">Behavior</th>
      <th width="33%">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>vsep.containerKey = "ND1"</td>
      <td>vsep.containerKey = "ND2"</td>
      <td>Changes hosting relationship from ND1 to ND2</td>
    </tr>
    <tr>
      <td>apiversion.implType = "Sandbox"</td>
      <td>vsep.containerKey = "ND2"</td>
      <td>Changes hosting relationship for sandbox implementations</td>
    </tr>
    <tr>
      <td>vsep.containerKey = "ND1" &amp;&amp; vsep.listenerName = "http"</td>
      <td>vsep.containerKey = "ND2";
vsep.listenerName = "https"</td>
      <td>Changes both the container and listener</td>
    </tr>
    <tr>
      <td>psep.url.startsWith("http://oldhost")</td>
      <td>psep.url.replace("http://oldhost", "http://newhost")</td>
      <td>Changes the host of a target endpoint</td>
    </tr>
    <tr>
      <td>apiversion.tags.contains("secret")</td>
      <td>apiversion.tags.add("probation")</td>
      <td>Adds a tag based on the presence of another.</td>
    </tr>
    <tr>
      <td>classifier:internal = "true"</td>
      <td>vsep.containerKey = "ND3"</td>
      <td>Sets container based on the value of a custom classifier</td>
    </tr>
  </tbody>
</table>

<h4 id="s03_07_00">Asset Model</h4>
<p>The Lifecycle Coordinator component is an extension of the Lifecycle Repository core functionality. As such, it uses an internal asset model to represent the topology and the assets promoted through the topology. Within the Lifecycle Coordinator, promotion requests result in the submission of an asset into the target environment, allowing for customized governance to be defined for this process.</p>
<p>In this section:</p>
<ul>
  <li><a href="#s03_07_01">Topology Asset Model</a></li>
  <li><a href="#s03_07_02">Promotable Asset Model</a></li>
  <li><a href="#s03_07_03">OrgGroup Assignment</a></li>
</ul>

<h5 id="s03_07_01">Topology Asset Model</h5>
<p>The topology asset model reflects the conceptual topology model defined earlier in this document with asset types for Environment, Tenant and Promotion Profile. The following diagram shows the asset structure for a Topology with three Environments (each box representing an asset):</p>
<p><img src="images/promotion_05.jpg" alt="Topology asset model, three environments" /></p>
<p>In addition to the relationships shown, Tenant assets contain connection information and credentials as classifiers while Promotion Profile assets hold Rules as a JSON artifact. Asset Filters are managed implicitly and optionally referenced by Promotion Profile assets.</p>


<h5 id="s03_07_02">Promotable Asset Model</h5>
<p>Promotable assets such as APIs are represented by specific asset-types. These asset types reference an Environment asset and contain <strong>Iteration</strong> assets representing each promotion of that asset. Note that there is a difference between <strong>versions</strong> of assets such as APIs and <strong>iterations</strong>: a single version of an API may be promoted multiple times, resulting in multiple iterations of that version. In the following asset diagram, the asset <strong>AnAPI (v1)</strong> has been promoted from development to integration test and then to production environments once, followed by another promotion from development to integration test. This resulted in two iterations in the development and integration test environments with a single iteration at production. Notice that the iteration at production indicates that its source iteration is iteration 1 in integration test, even though there is a newer iteration (iteration 2) in that environment.</p>
<p><img src="images/promotion_06.jpg" alt="Promotable asset model" /></p>
<p>Iterations contain several items:</p>
<ul>
  <li>A timestamp indicating when the promotion took place</li>
  <li>The user that requested the promotion</li>
  <li>The status of the promotion. Values for the status are:
    <ul>
      <li><strong>Promotion Pending</strong>: Promotion has been requested but has not been completed. It may be pending one or more approvals.
      <p><strong>Note</strong>: In the case where an approval process is in place and a promotion request is rejected, the Iteration will remain in a Promotion Pending state. However, the API platform UI will show it as <strong>Promotion Rejected</strong>, allowing promotion to be requested again.</p></li>
      <li><strong>Promoted</strong>: Promotion has completed.</li>
      <li><strong>Promotion Failed</strong>: There was a failure in the promotion process. Promotion can be requested again for assets in this state. The next promotion attempt will replace the failed iteration.</li>
    </ul>
      <p><strong>Note</strong>: The API Platform UI also indicates a <strong>Not Promoted</strong> state. This corresponds to an asset not yet existing in the target environment. Such assets will not be present in Lifecycle Coordinator.</p>
  </li>
  <li>The promotion package that was imported into the target environment is held as an artifact called archive.zip.</li>
  <li>In the case of a promotion failure the iteration includes a short summary of the exception causing the failure.</li>
  <li>A relationship to the source iteration in the source environment</li>
  <li>A relationship to the previous iteration (if one exists) in the target environment</li>
  <li>A relationship to the Promotion Profile selected for promotion of the asset.</li>
</ul>

<h5 id="s03_07_03">OrgGroup Assignment</h5>
<h5 class="stamp">API Platform Version: 8.4.13 and later</h5>
<p>When promotion is requested for an asset such as an API, the asset is assigned an owning OrgGroup within Lifecycle Coordinator. These OrgGroups correspond to the asset's Organization in the corresponding API Platform environment. This approach allows promotion approvers to be assigned at an organizational level within the Lifecycle Coordinator topology.</p>
<span class="apidoc_note"><strong>Note</strong>: OrgGroups are synchronized with the tenant Organization when a topology is created or updated. If an asset is promoted with an Organization for which there is no corresponding OrgGroup, Lifecycle Coordinator synchronizes the Organizations for the corresponding tenant in an attempt to resolve the missing OrgGroup.</span>
<p><a href="#top">Back to top</a></p>




<h3 id="lc_installation">Lifecycle Coordinator Installation</h3>
<p>This section includes:</p>
<ul>
  <li><a href="#lc_install_feature">Installing the Lifecycle Coordinator feature</a></li>
  <li><a href="#lc_install_secure_api">Securing the Topology REST API</a></li>
  <li><a href="#com_soa_promotion">Remote container address (com.soa.promotion)</a></li>
  <li><a href="#com_akana_lifecycle_coordinator">Properties to secure the Topology REST API (com.akana.lifecycle.coordinator)</a></li>
  <li><a href="#config_preserveKeys">Unique ID Mapping behavior</a></li>
  <li><a href="#config_defaultFromEmail">Default "From Email" setting</a></li>
  <li><a href="#config_tenant_synch_interval">Tenant Synchronization Interval</a></li>
</ul>
<h4 id="lc_install_feature">Installing the Lifecycle Coordinator feature</h4>
<p>For an on-premise installation of the Akana API Platform, the Lifecycle Coordinator feature must be separately installed from the Akana Administration Console:</p>
<p><img src="images/promotion_07.jpg" alt="Lifecycle Coordinator feature" /></p>
<p>Installing Lifecycle Coordinator implicitly installs the Lifecycle Repository feature as well. After selecting Lifecycle Coordinator for installation, the user is guided through a number of configuration tasks for the Lifecycle Repository feature.</p>


<h4 id="lc_install_secure_api">Securing the Topology REST API</h4>
<p>There is also a task to secure the Topology REST API, as shown below.</p>
<p><img src="images/promotion_08.jpg" alt="Set Topology API Credentials task" /></p>
<p>This sets up the credentials for basic authentication on calls to the Topology REST API.</p>


<h4 id="com_soa_promotion">Remote container address (com.soa.promotion)</h4>
<p>If the Lifecycle Coordinator is installed remotely, a URL to the remote container hosting the Lifecycle Coordinator instance must be configured for each container hosting tenants from which promotion can be requested.</p>
<p>To set this up:</p>
<ol>
  <li>In the Akana Administration Console, open the <strong>Configuration</strong> tab.</li>
  <li>Select the <strong>com.soa.promotion</strong> category.</li>
  <li>Set the <strong>remote.promoter.address</strong> property to the host address of the container hosting the Lifecycle Coordinator instance. An example is shown below.
<p><img src="images/promotion_09.jpg" alt="Setting remote.provider.address" /></p></li>
  <li>Save the changes.</li>
</ol>

<h4 id="com_akana_lifecycle_coordinator">Properties to secure the Topology REST API (com.akana.lifecycle.coordinator)</h4>
<p class="stamp">API Platform Version: 8.4.15 and later</p>
<p>You can set up the global configuration properties for Lifecycle Coordinator in the Akana Admin Console.</p>
<p>With the three properties listed below, you can configure the Topology REST API to require basic authentication for all requests.</p>
<ol>
  <li>In the Akana Administration Console, open the <strong>Configuration</strong> tab.</li>
  <li>Select the <strong>com.akana.lifecycle.coordinator</strong> category.</li>
  <li>Set the properties. For details, see <a href="#lc_property_details">com.akana.lifecycle.coordinator properties</a> below.
    </li>
  <li>Save the changes.</li>
</ol>
<h5 id="lc_property_details"><strong>com.akana.lifecycle.coordinator</strong> properties</h5>
<dl>
<dt>lifecycle.coordinator.config.apiUser</dt>
<dd>This field and the next are used to set the <strong>global</strong> basic authentication credentials for the Topology REST API. If  this property is left empty, the Topology API will not require authentication of requests.</dd>
<dt>lifecycle.coordinator.config.apiPassword properties</dt>
<dd>If a value was set for lifecycle.coordinator.config.apiUser, specify the password.</dd>
<dt>lifecycle.coordinator.config.enableTenantScopedAuthentication</dt>
<dd>Boolean. Used to allow delegation of authentication to the primary tenant  in the topology being acted on. The primary tenant is the tenant marked as the <strong>userAuthenticationSource</strong> in the topology. If no tenant is marked as the userAuthenticationSource, the initial tenant in the topology is used for authentication.</dd>
</dl>

<p>The following table summarizes the authentication behavior.</p>
<table cellspacing="0px" class="doctable" style="width: 98%;">
  <thead>
    <tr>
      <th width="20%">Global Credentials Set</th>
      <th width="20%">Tenant Scoped Authentication Enabled</th>
      <th width="59%">Behavior</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>No</td>
      <td>N/A</td>
      <td>Requests are not authenticated</td>
    </tr>
    <tr>
      <td>Yes</td>
      <td>false</td>
      <td>Requests must specify global credentials</td>
    </tr>
    <tr>
      <td>Yes</td>
      <td>true</td>
      <td><p>Requests can specify either of these:</p>
        <ul>
          <li>The email and password of a site admin user in the primary tenant of the topology being acted on.</li>
          <li>The global credentials</li>
        </ul>        </td>
    </tr>
  </tbody>
</table>


<p><strong>Note</strong>: Requests for the <strong>getTopologies</strong> method (<span class="apidoc_code">GET /lc/api/topologies</span>) must specify the global credentials since there is no specific topology being acted on.</p>


<h4 id="config_preserveKeys">Unique ID Mapping behavior</h4>
<p><span class="stamp">API Platform Version: 8.4.14 and later</span></p>
<p>The property <strong>lifecycle.coordinator.config.preserveKeys</strong> in the <strong>com.akana.lifecycle.coordinator</strong> configuration category is used to configure the default behavior for preserving the unique IDs of an API's constituent elements as the API is promoted across environments.</p>
<p>If this property is set to <strong>true</strong>, the unique IDs of the underlying Services and Organization are preserved. If it's set to <strong>false</strong>, these elements will be assigned new unique IDs when they are promoted, and a mapping between the keys used in each environment will be stored with the topology in Lifecycle Coordinator.</p>
<p><strong>Note</strong>: Â If multiple tenants referenced in the same topology exist in the same API Platform instance (that is, share the same database), the value should be changed to <strong>false</strong>, since there might be some overlap in key values. If <strong>preserveKeys</strong> is set to true, any overlap in key values would cause promotion errors.</p>


<h4 id="config_defaultFromEmail">Default "From Email" setting</h4>
<p>You can set the default <strong>from</strong> email address used in emails sent from Lifecycle Coordinator, in the <strong>repository.config.defaultFromEmail property</strong> of the <strong>com.soa.repository</strong> configuration category.</p>
<p>You can also override the <strong>from</strong> email address for a specific topology. To do this, go into the topology library as an admin user or superuser, click <strong>Support Center</strong>, click <strong>Configure Library</strong> and set the <strong>Sender Email</strong> field, as shown below.</p>
<p><img src="images/promotion_lm_from_email.jpg" alt="Setting From Email in LM" /></p>


<h4 id="config_tenant_synch_interval">Tenant Synchronization Interval</h4>
<h5 class="stamp">API Platform Version: 8.4.16 and later</h5>
<p>Lifecycle Coordinator periodically updates cached policy and organization information for tenants referenced in a topology. The specific interval for this update is controlled by the following property:</p>
<dl>
<dt>Configuration category</dt>
<dd>com.soa.repository</dd>


<dt>Configuration property</dt>
<dd>repository.config.tenantSyncInterval</dd>


<dt>Explanation:</dt>
<dd>Sets the interval between updates to cached policy and organizational information. The value is set in milliseconds.</dd>


<dt>Default value:</dt>
<dd>300000 (5 minutes)</dd>
</dl>
<p><a href="#top">Back to top</a></p>



<h3 id="topology_config">Topology Configuration</h3>
<p>The Lifecycle Coordinator feature provides a REST API for maintaining topologies. This allows topologies to be defined in JSON structure. The following example shows the definition of a topology consisting of two environments supported by two local tenants.</p>
<pre>{
  "name":"Topology1",
  "tenants":[
    {
      "name":"DevelopmentTenant",
      "id":"tenant1",
      "credentials":{
        "email":" administrator1@example.com ",
        "password":"password1"
      }
    },
    {
      "name":"ProductionTenant",
      "id":"tenant2",
      "userAuthenticationSource":true,
      "credentials":{
        "email":"administrator2@example.com",
        "password":"password2"
      }
    }
  ],
  "environments":[
    {
      "name":"development",
      "displayName":"Development",
      "description":"Development environment",
      "tenant":"DevelopmentTenant",
      "promotionProfiles":[
        {
          "name":"Default Production Promotion",
          "description":"Dev to production default profile",
          "targetEnvironment":"production"
        }
      ]
    },
    {
      "name":"production",
      "displayName":"Production",
      "description":"Production environment",
      "tenant":"ProductionTenant"
    }
  ]
}</pre>



<h4 id="s05_01">Tenants</h4>
<p>Tenant definitions in the topology provide the Lifecycle Coordinator the necessary information to communicate with the specified tenant. Tenants can be either local (on the same container as the Lifecycle Coordinator) or remote. When defining a tenant:</p>
<ul>
  <li><strong>Local</strong> tenant: Specify the tenantId in the <strong>id</strong> property, as in the topology example above.</li>
  <li><strong>Remote</strong> tenant: In addition to the tenantId in the <strong>id</strong> property as above, specify the address of the tenant in the <strong>address</strong> field.</li>
</ul>
<p>The example below shows both values:</p>
<pre>{
  "name":"ProductionTenant",
  "id":"tenant2",
  "address":"http://myProductionTenant:9900",
  "credentials":{
    "email":"administrator2@example.com",
    "password":"password2"
  }
}</pre>
<p class="apidoc_note"><strong>Note</strong>: The address value is unique to the tenant. It corresponds to the value specified for the <strong>address</strong> parameter when the tenant was created.</p>

<h5>Tenant Names</h5>
<p>Tenants require a <strong>name</strong> property which is used to identify the tenant by environments within the topology. This name must be unique within the topology, but need not correspond to the actual tenant name.</p>
<h5>Delegated Authentication</h5>
<p>The Boolean <strong>userAuthenticationSource</strong> property is used to indicate that authentication for the underlying Lifecycle Repository library console is to be delegated to the specified tenant. This means that users of the specified tenant may log-in to the topology library using their email and password for that tenant.</p>
<p>Only one tenant may have the <strong>userAuthenticationSource</strong> property set to <strong>true</strong> and that tenant must be local to the Lifecycle Coordinator.</p>

<h4 id="s05_02">Environments</h4>
<p>Environments reference a corresponding tenant and hold one or more promotionProfiles representing transitions to other environments.</p>


<h5>Environment Names</h5>
<p>The <strong>name</strong> property for an environment must be unique within the topology and should not be changed once defined. This is because this name is used as a key for mapping information between environments stored by the Lifecycle Coordinator. Given the invariability of the environment name, a <strong>displayName</strong> property is also supported. The display name is what appears to users in the API Platform UI and may be changed without affecting mapping information.</p>

<h4 id="s05_03">Promotion Profiles</h4>
<p>Promotion Profiles are defined within the <strong>promotionProfiles</strong> property of an Environment. The <strong>targetEnvironment</strong> property of a PromotionProfile must correspond to the <strong>name</strong> of another Environment in the Topology.</p>
<p>A PromotionProfile can optionally specify one or more filters by specifying filter names within the <strong>filterNames</strong> array property.</p>
<p>Rule definitions might optionally be provided using the <strong>rules</strong> array property.</p>
<p class="apidoc_note"><strong>Note</strong>: A PromotionProfile cannot create a cycle between Environments.</p>


<h4 id="s05_04">Rules</h4>
<p>Rules are defined inline within the <strong>rules</strong> array property of a PromotionProfile. Each Rule consists of a <strong>scope</strong> property indicating the property in the archive manifest it applies to, an optional <strong>condition</strong> property indicating the conditions for which the Rule applies and a required <strong>action</strong> property indicating the action to perform on the manifest property.</p>
<p>Examples in this section:</p>
<ul>
  <li><a href="#s05_04_01">Rule example #1</a>: changes the hostname for the physical service endpoint.</li>
  <li><a href="#s05_04_02">Rule example #2</a>: changes the name of the OAuth provider for a promoted API in the target environment.</li>
</ul>
<h5 id="s05_04_01">Rule example #1</h5>
<p>In this example, the rule changes the host name of the physical service endpoint (<strong>psep</strong>) for an API:</p>
<pre>{
  "scope":"psep",
  "condition":"psep.url.indexOf(\"foo.com\") > 0",
  "action":"psep.url = psep.url.replace(\"foo.com\",\"bar.com\")"
}</pre>
<p>Note the use of '\' to escape the double quotes in the condition and action.</p>

<h5 id="s05_04_02">Rule example #2</h5>
<p>The example below changes the name of the OAuth provider for a promoted API in the target environment.</p>
<p><strong>Note</strong>: Only use this rule if the configuration of the source and target OAuth Providers is identical, including scope definition. If the configuration is not identical, using this rule might cause promotion errors.</p>
<pre>{
  "scope" : "vs",
  "condition" : "vs.oauthProvider == 'SourceProvider'",
  "action" : "vs.oauthProvider = 'TargetProvider'"
}</pre>


<h4 id="s05_05">Filters</h4>
<p>The <strong>filters</strong> property of a Topology allows asset filters to be defined for use in PromotionProfile selection. Filters contain criteria which apply to the classifiers associated with an asset.</p>
<p>Filters correspond to the <strong>custom properties</strong> for an API in the API Platform UI.</p>
<p>The following example defines filters used to differentiate between APIs that are PCI compliant and those that are not based on a <strong>pci-compliant</strong> classifier:</p>
<pre>[
  {
    "name":"PCI Compliant",
    "classifier-criteria":[
      {
        "classifierName":"pci-compliant",
        "values":[
          {
            "value":"true"
          }
        ]
      }
    ]
  },
  {
    "name":"PCI Non-Compliant",
    "classifier-criteria":[
      {
        "classifierName":"pci-compliant",
        "values":[
          {
            "value":"false"
          }
        ]
      }
    ]
  }
]
</pre>
<p>With these filters defined, different transition paths between source and target Environments can be defined as in the following example <strong>promotionProfiles</strong> property for an Environment:</p>
<pre>{
  "promotionProfiles":[
    {
      "name":"PCI Production Promotion",
      "targetEnvironment":"Production",
      "filterNames":[
        "PCI Compliant"
      ],
      "rules":[
        {
          "scope":"vsep",
          "action":"vsep.containerKey = '{pci-container-key}' "
        }
      ]
    },
    {
      "name":"Non-PCI Production Promotion",
      "targetEnvironment":"Production",
      "filterNames":[
        "PCI Non-Compliant"
      ],
      "rules":[
        {
          "scope":"vsep",
          "action":"vsep.containerKey = '{standard-container-key}' "
        }
      ]
    }
  ]
}</pre>
<p><a href="#top">Back to top</a></p>



<h4 id="s05_06">Organization Mapping</h4>
<h5 class="stamp">API Platform Version: 8.4.13 and later</h5>
<p>Lifecycle Coordinator attempts to assign APIs in the target environment tenant to an Organization matching the name of the Organization in the source environment tenant. If it doesn't find an Organization of the same name, it assigns the API to the tenant Organization.</p>
<p>Within a promotion profile, you can define a rule to create a mapping of Organizations when promoting to the target environment. To do this, define a rule that modifies the <strong>api.orgName</strong> property.</p>
<p>For example, you could add the following rule to the rules of a PromotionProfile to map APIs from the source Organization <strong>GroupA</strong> to the target Organization <strong>GroupB</strong>.</p>
<pre>{
  "scope":"api",
  "condition":"api.orgName == 'GroupA'",
  "action":"api.orgName = 'GroupB'"
}</pre>



<h4 id="s05_07">Policy Mapping</h4>
<h5 class="stamp">API Platform Version: 8.4.16 and later</h5>
<p>A Promotion Profile can optionally contain a set of PolicyMappings that you can use to tailor the propagation and validation of policy references when an API is promoted to the target environment. You can use PolicyMappings to:</p>
<ul>
  <li>Map a policy reference in the source environment to a policy in the target environment.</li>
  <li>Remove a policy reference altogether when an API is promoted.</li>
</ul>
<p>A PolicyMapping has one of these two properties:</p>
<ul>
  <li><strong>sourcePolicy</strong>&#8212;Used to identify a specific policy in the source environment by either name or unique id.</li>
  <li><strong>sourcePolicyFilter</strong>&#8212;Used to specify a group of policies by type or subtype.</li>
</ul>
<p>Additionally, a PolicyMapping can specify a <strong>targetPolicy</strong> in the target environment either by name or unique id.  If a PolicyMapping does not specify a <strong>targetPolicy</strong> property, references to policies matching the <strong>sourcePolicy</strong> or <strong>sourcePolicyFilter</strong> property are ignored when an API is propagated to the next environment.</p>
<p>The following PromotionProfile shows an example of a PolicyMapping that maps references to the DetailedAuditPolicy in the source environment to the BasicAuditPolicy in the target environment:</p>
<pre>{
  "name": "Default Production Promotion",
  "description": "Dev to production default profile",
  "targetEnvironment": "production",
  "rules": [],
  "policyMappings": [
    {
      "sourcePolicy": {
        "policyName": "DetailedAuditing"
      },
      "targetPolicy": {
        "policyName": "BasicAuditing"
      }
    }
  ]
}</pre>

<p>In this example, the PolicyMapping uses the unique ids of the source and target policies:</p>
<pre>{
  "sourcePolicy": {
    "policyId": "urn:uuid:852afbc5-101e-11e8-887b-abe2ebb3db33"
  },
  "targetPolicy": {
    "policyId": "urn:uuid:763b7ca5-304f-16e8-457b-c542e456db33"
  }
}</pre>
<p>You can accomplish a  one-to-many mapping of policies using a policy filter:</p>
<pre>{
  "sourcePolicyFilter": {
    "policyType": "Operational Policy",
    "policySubtype" : "policy.auditservice"
  },
  "targetPolicy": {
    "policyName": "BasicAuditing"
    }
}</pre>
<p>A specific policy is disabled on promotion by omitting the targetPolicy property in the PolicyMapping:</p>
<pre>{
  "sourcePolicy": {
    "policyName": " DetailedAuditing "
  }
}</pre>

<h5>Default Mappings</h5>
<p>Policies that are available by default within a tenant, such as DetailedAuditing, BasicAuditing, and CORSAllowAll, are implicitly mapped to the corresponding default policies in the target tenant and do not need an explicit PolicyMapping. You can think of this default mapping as being of the form:</p>
<pre>{
  "sourcePolicy": {
    "policyId": "&lt;source tenant id&gt;-&lt;policy name&gt;"
  },
  "targetPolicy": {
    "policyId": "&lt;target tenant id&gt;-&lt;policy name&gt;"
  }
}
</pre>

<h5 id="s05_07_03">Tenant name change: original-tenant-name property</h5>
<p>Default policy mappings are determined based on the tenant name. If the name of a tenant was changed since its original creation (in the Developer Portal, <strong>Admin</strong> > <strong>Site</strong>), it's important to include the original tenant name in the tenant definition in the topology, using the <strong>original-tenant-name</strong> property. An example is shown below.</p>
<pre>{ 
  "id": "devtenant", 
  "name": "DevelopmentTenant", 
  "address": "http://devacmepaymentscorptenant:9457", 
  "properties": [ 
    { 
      "name": "original-tenant-name", 
      "value": "Tenant1" 
    } 
  ], 
  ... 
}</pre>


<h5>Policy Validation</h5>
<p>When an API is promoted, policy references must do one of the following:</p>
<ul>
  <li>Reference a default policy, such as DetailedAuditing</li>
  <li>Match the unique ID of an existing policy in the target environment</li>
  <li>Match a PolicyMapping defined for the selected PromotionProfile </li>
</ul>
<p>If none of the above criteria are met, a validation error is returned to the promoting user and the promotion is aborted.</p>
<p><a href="#top">Back to top</a></p>



<h3 id="dz_configurations">Deployment Zone Configurations</h3>
<h5 class="stamp">API Platform Version: 8.4.12 and later</h5>
<p>Within a promotion profile, deployment zone configurations can be used to tailor the propagation of an API's endpoints to the target environment. During API promotion, applicable deployment zone configurations are selected based on:</p>
<ul>
  <li>The name of an API endpoint's deployment zone in the source environment.</li>
  <li>Optionally, filters that apply to the metadata of the API.</li>
</ul>
<p>A deployment zone configuration contains a list of deployment zone names in the target environment. When a deployment zone configuration is determined to be applicable for an endpoint of the API being promoted, the endpoint is populated into the specified target environment deployment zones.</p>
<p><strong>Note</strong>: The target deployment zone must have a listener that matches the listener name of the endpoint. If necessary, use rules in the deployment zone configuration to adjust listener names.</p>
<p>The structure of the deployment zone configurations allows endpoints in a source environment to be fanned out to a target environment. For example, a staging environment might only support a single deployment zone while the production environment supports many deployment zones across different geographic regions.</p>
<p>Consider the following example PromotionProfile:</p>
<pre>{
  "name":"Default Production Promotion",
  "targetEnvironment":"production",
  "deploymentZoneConfigurations":[
    {
      "sourceDeploymentZoneName":"StagingDZ",
      "targetDeploymentZoneNames":[
        "ProdWestDZ",
        "ProdEastDZ"
      ]
    }
  ]
}</pre>
<p>In this example, a single deployment zone configuration has been defined to propagate endpoints in in the <strong>StagingDZ1</strong> deployment zone in the source environment to both <strong>ProdWestDZ</strong> and <strong>ProdEastDZ</strong> in the target environment.</p>


<h4 id="s06_01">Using Filters with deployment zone configurations
</h4><p>The filtering capability of deployment zone configurations allows for target deployment zones to be determined based on the metadata of the API. For example, security metadata associated with the API might determine the specific deployment zones that the API is deployed to.</p>
<p>In the following example, the filters named <strong>PII</strong> and <strong>Not PII</strong> are used in selecting the deployment zones an API's endpoints are propagated to in the target environment, based on whether the API is marked as processing personal identity information.</p>
<pre>"deploymentZoneConfigurations": [
  {
    "filterNames": [
      "pii"
    ],
    "sourceDeploymentZoneName": "StagingDZ",
    "targetDeploymentZoneNames": [
      "PIIDZ"
    ]
  },
  {
    "filterNames": [
      "not-pii"
    ],
    "sourceDeploymentZoneName": "StagingDZ",
    "targetDeploymentZoneNames": [
      "NotPIIDZ"
    ]
  }
]
</pre>


<p>For the above example, the filters in the topology are defined as shown below.</p>
<pre>"filters": [
  {
    "name": "pii",
    "classifier-criteria": [
      {
        "classifierName": "pii",
        "values": [
          {
            "value": "true"
          }
        ]
      }
    ]
  },
  {
    "name": "not-pii",
    "classifier-criteria": [
      {
        "classifierName": "pii",
        "values": [
          {
            "value": "false"
          }
        ]
      }
    ]
  }
]
</pre>


<h4 id="s06_02">Default Endpoint Propagation</h4>
<p>If an endpoint's source deployment zone doesn't match a defined deployment zone configuration, the promotion processing will propagate the endpoint to a deployment zone in the target environment with the same name, if one exists. You can think of this as an implicit deployment zone configuration for every deployment zone in the source environment of the form:</p>
<pre>{
  "sourceDeploymentZoneName":"{source DeploymentZone name}",
  "targetDeploymentZoneNames":[
    "{source DeploymentZone name}"
  ]
}</pre>

<p>You can disable endpoints from a source deployment zone completely by defining a deployment zone configuration that specifies no target deployment zone names. For example:</p>
<pre>{
  "sourceDeploymentZoneName":"TestDZ",
  "targetDeploymentZoneNames":[

  ]
}</pre>



<h4 id="s06_03">Using Rules with deployment zone configurations
</h4><p>A deployment zone configuration can optionally contain RuleDefinitions to be applied to the properties of the endpoints being promoted with this deployment zone configuration.</p>
<p>At this level, you can use rules to alter a listener name, the endpoint's path, or its vanity host. The properties available for modification are:</p>
<dl>
<dt>listenerName</dt>
<dd>The name of the endpoint's listener; for example, <strong>http</strong>. It must match a listener associated with the target deployment zone.</dd>
<dt>path</dt>
<dd>The endpoint-specific path. If the endpoint in the source environment did not have an endpoint-specific path, this will be set to <strong>NO_VALUE</strong>. A rule can set the path property to another value, or to <strong>NO_VALUE</strong> indicating that the target endpoint will not have a specific path.</dd>
<dt>vanityHostName</dt>
<dd>A host name (CNAME) specific to the endpoint. If the endpoint in the source environment did not have a vanity host name, this will be set to <strong>NO_VALUE</strong>. A rule can set the vanityHostName property to another value, or to <strong>NO_VALUE</strong> which indicates that the target endpoint will not have a vanity host name.</dd>
<dt>DISABLED</dt>
<dd>This property provides a means of disabling an endpoint via a rule. If you set the value of DISABLED to <strong>true</strong>, the endpoint is not propagated to the target environment.</dd>
</dl>

<p>In the example shown below, a rule is provided with a deployment zone configuration that will disable the propagation of endpoints that do not have a vanity host name in the source environment.</p>
<pre>{
  "sourceDeploymentZoneName":"StagingDZ",
  "targetDeploymentZoneNames":[
    "ProdDZ"
  ],
  "rules":[
    {
      "scope":"vsep",
      "condition":"vsep.vanityHostName == 'NO_VALUE'",
      "action":"vsep.DISABLED = 'true'"
    }
  ]
}</pre>


<h4 id="s06_04">Duplicate Endpoints</h4>
<p>Care should be taken to avoid duplicating endpoints across environments using the same underlying Gateways. This situation can occur if the target deployment zone has the same underlying Gateway as the source deployment zone (leading to the same host name and port) and has no options set for altering the Gateway host name or path. This situation will result in the promotion of the API failing.</p>
<p>There are several ways you can help make sure there are no duplicate endpoints:</p>
<ul>
  <li>Enable random prefixes in the target deployment zone.</li>
  <li>Provide a custom hostname for the Gateway in the target deployment zone that differs from the source deployment zone.</li>
  <li>Use a rule in the deployment zone configuration to alter the vanity host name or path of the endpoints being promoted.</li>
</ul>
<p><a href="#top">Back to top</a></p>



<h3 id="topology_api">Topology API</h3>
<p>In this section:</p>
<ul>
  <li>Finding the Topology API Documentation</li>
  <li>Using the Topology API</li>
</ul>


<h4 id="topologyapi_01">Finding the Topology API Documentation</h4>
<p>You can find the Topology API documentation in the following locations:</p>
<ul>
  <li>In your deployment:
    <ul>
      <li>Once the Lifecycle Coordinator feature is deployed, a REST API for maintaining topologies is available from the path <strong>/lc/api/topologies</strong> relative to the container's URL. For example:
      <p><strong>http://myHost:9900/lc/api/topologies</strong></p></li>
      <li>You can find Swagger documentation for this API in the container deployment:
      <p><strong>$INSTALL_DIR/docs/restApiDocs/api-platform/swagger-Topology_API.html</strong></p></li>
    </ul>
  </li>
  <li>On the <a href="../../ag/assets/restApiDocs_api-platform_84/api-urn_com.akana.lifecyclecoordinator.rest-TopologyAPI.html" title="Topology API on Akana docs site">Akana docs site</a>.</li>
</ul>


<h4 id="topologyapi_02">Using the Topology API</h4>
<p>The first step is to create a Topology. This is done by POST-ing the complete Topology JSON document to <strong>...lc/api/topologies</strong>. This can be done programmatically or with a browser plugin such as Firefox RESTClient:</p>
<p><img src="images/promotion_10.jpg" alt="Creating the topology" /></p>
<p>Note the inclusion of the content-type and basicAuth headers.</p>
<p>Updates to the topology can be performed on the topology as a whole, or on specific properties within the document. For example, the Rules for a PromotionProfile can be updated with a PUT of an array of Rules such as:</p>
<pre>[
  {
    "scope":"psep",
    "condition":"psep.url.indexOf(\"foo.com\") > 0",
    "action":"psep.url = psep.url.replace(\"foo.com\",\"bar.com\")"
  }
]</pre>
<p>To:</p>
<pre>http://myHost:9900/lc/api/topologies/{topology-name}/environments/{environment-name}/profiles/{promotionProfile-name}/rules</pre>
<p><a href="#top">Back to top</a></p>



<h3 id="lm_console">Lifecycle Manager Console</h3>
<p>The Lifecycle Manager (<strong>LM</strong>) console is useful for accessing promoted assets and their iterations as well as approving promotion requests. Within Lifecycle Manager, a topology is represented as a <strong>library</strong> and the elements of a Topology along with the entities being promoted are represented as <strong>assets</strong>.</p>


<h4 id="s07_01">Logging In</h4>
<p>The first step is to log in to the library that corresponds with the topology. There are two options:</p>
<ul>
  <li>If the admin user password has been set, you can log into the library as the Lifecycle Repository super user at the URL below:
    <pre>{container-base-url}/lm/application/access/suLogin.do</pre></li>
  <li>If the topology was configured to delegate authentication to a local tenant, you can log in at the URL below, using the tenant email and password for a user in the designated local tenant:
  <pre>{container-base-url}/lm/application/access/challenge.do</pre></li>
</ul>


<h4 id="s07_02">Viewing Assets and Iterations</h4>
<p>The left pane of the LM console contains a search box which can be used for finding assets by name:</p>
<p><img src="images/promotion_11.jpg" alt="Finding assets by name" /></p>
<p>The search results include separate LM assets for each environment to which a promotable entity has been promoted or is pending promotion. Clicking on an asset in the search results brings up a details page:</p>
<p><img src="images/promotion_12.jpg" alt="Published asset, Details page" /></p>
<p>In this case, the <strong>Current Iteration</strong> relationship is referencing the third iteration of this API asset. Click on the iteration asset name to view details about the iteration, as shown below.</p>
<p><img src="images/promotion_13.jpg" alt="Iteration details" /></p>
<p>Here you can see the following details for this iteration:</p>
<ul>
  <li>The time the iteration was promoted</li>
  <li>The user who requested the promotion</li>
  <li>The status of the promotion</li>
  <li>The actual archive.zip (after rule processing) that was imported into the target environment</li>
  <li>The response from the Import</li>
  <li>A relationship to the previous iteration for this environment</li>
  <li>A relationship to the source iteration in the previous environment</li>
  <li>A relationship to the PromotionProfile that was used to promote the iteration</li>
</ul>
<p>Additionally, in the case of a promotion failure (generally due to an invalid rule) error details are stored in the Artifacts section of the iteration asset:</p>
<p><img src="images/promotion_14.jpg" alt="Error details" /></p>

<h4 id="s07_03">Promotion Requests</h4>
<p>The configuration of the topology library can optionally be customized to require approvals for a promotion request. For assistance with customization, contact Akana Professional Services.</p>
<p>In this scenario, a user with the required authorization role has a pending request notification message in the left pane after logging into the LM console:</p>
<p><img src="images/promotion_15.jpg" alt="Pending requests" /></p>
<p>Clicking on the details for that request allows the user to approve the request:</p>
<p><img src="images/promotion_16.jpg" alt="Approving a pending request" /></p>
<p>Clicking <strong>approve</strong> allows the promotion to succeed or proceed to the next role approval.</p>
<h5>Rejecting Requests</h5>
<p>A user may choose to reject the request by clicking on <strong>rejection properties</strong> and then clicking <strong>reject</strong>. In this case, the Iteration asset remains in a <strong>Promotion Pending</strong> state, however, the API Platform UI shows the state of the promotion as <strong>Promotion Rejected</strong> and allows the promotion to be requested again.</p>
<p><a href="#top">Back to top</a></p>