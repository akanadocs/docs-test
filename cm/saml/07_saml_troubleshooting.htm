---
layout: page
title: Troubleshooting SAML | Using SAML in the API Platform | Akana API Platform Help
description: Includes information that might help you troubleshoot issues with your SAML single sign-on setup.
product: cm
category: ref
sub-nav-class: Using SAML
weight: 12
type: page
nav-title: Troubleshooting SAML
---
<h2 id="top">Troubleshooting Your SAML Setup</h2>
<p>This section includes information that might help you troubleshoot issues with your SAML single sign-on setup.</p>

<div class = "divider1"></div>



<h3 style="color: gray;">Table of Contents</h3>
<ol class="table_of_contents">
  <li><a href="#07_01">URL-unsafe characters in URL</a></li>
  <li><a href="#07_02">I can log in to Identity Provider but not to the developer portal</a></li>
  <li><a href="#07_03">I set up everything but I don't see the IdP login screen</a></li>
  <li><a href="#07_04">How can I change the IdP login screen from main page to popup or vice versa</a></li>
  <li><a href="#07_05">I can complete an end-to-end case but my developer portal screens looks different from the IdP login screen</a></li>
  <li><a href="#07_06">I am doing the SP setup in PingFederate, but when I import the metadata.xml file I get the message “Invalid signature on metadata file.” What do I do?</a></li>
  <li><a href="#07_07">I configured the OAuth provider and configured SAML Web Browser SSO domain for the resource owner domain, but could not log in</a></li>
  <li><a href="#07_08">The metadata file doesn't have the login URL for my Community Manager installation</a></li>
</ol>
<div class = "divider1"></div>




<a name="07_01"></a><h4>URL-unsafe characters in URL</h4>
<p>The Community Manager domain name is used in the Service Provider metadata URL. The domain name must have URL-safe characters or must use escape characters.</p>
<p>If the domain name includes characters that are not URL-safe, it might not work correctly.</p>
<p><a href="#top">Back to top</a></p>



<a name="07_02"></a><h4>I can log in to Identity Provider but not to the developer portal</h4>
<ul>
  <li>If you can the Identity Provider login screen, and login is successful, but you have not been successfully logged in to the developer portal, it could be due to one of a number of issues.</li>
  <li>In the Policy Manager SAML Web Browser SSO domain, check the following:</li>
  <li>In the Identity Provider configuration, make sure the configured X.509 certificate for signature verification is still being used by the IdP to sign the assertions.</li>
  <li>If the IdP is encrypting the SAML response, make sure the IdP is using the certificate that is configured for Service Provider on the <strong>Manage PKI Keys</strong> page.</li>
  <li>In the <strong>Identity Mapping</strong> section, check to see that the user identifier location is configured correctly.</li>
  <li>For HTTP-Artifact binding, check the following:
    <ul>
      <li>If the IdP uses the HTTP-Artifact binding of the Service Provider to send the artifact reference, make sure the correct authentication options have been selected on the <strong>SAML Identity Provider Configuration</strong> page.</li>
      <li>if the IdP Artifact Resolution Service is on HTTPS, make sure there are no SSL handshake errors. If there are errors, import the CA certificate of the IdP server certificate into the Policy Manager trust store.</li>
    </ul>
  </li>
  <li>Check if the IdP uses valid Name-ID format to communicate the subject inside the SAML response. If needed, check allowed Name-ID formats in the <strong>Service Provider Configuration</strong> section.</li>
</ul>
<p><a href="#top">Back to top</a></p>



<a name="07_03"></a><h4>I set up everything but I don't see the IdP login screen</h4>
<ul>
  <li>In the Policy Manager SAML Web Browser SSO domain, do the following:</li>
  <li>Check if the Authentication URL configured on the <strong>SAML Identity Provider Configuration</strong> page is valid.</li>
  <li>Make sure the certificate that is configured on the <strong>Manage PKI Keys</strong> page is still used at the IdP for verifying the signatures on incoming AuthNRequests from this Service Provider.</li>
  <li>If this issue is with end-user login in OAuth Provider, make sure the SSO login URL of this OAuth Provider is registered at the IdP as a valid Assertion Consumer Service URL with correct binding format.</li>
  <li>Check if the SAML Service Provider domain is initialized without any errors.</li>
</ul>
<p><a href="#top">Back to top</a></p>



<a name="07_04"></a><h4>How can I change the IdP login screen from main page to popup or vice versa?</h4>
<p>When enabling a domain for login in Community Manager, you can choose whether the login page is displayed as the main page or as a popup.</p>
<p>Log in as the Site Admin, go to <strong>Config</strong> &gt; <strong>Logins</strong>, and then, in the Mode column, choose Popup or Main.</p>
<p>For more information, refer to the Community Manager online help: What login page integration modes are supported?</p>
<p><a href="#top">Back to top</a></p>



<a name="07_05"></a><h4>I can complete an end-to-end case but my developer portal screens looks different from the IdP login screen</h4>
<p>The Community Manager user interface look and feel is controlled by the styles defined in the custom.less file, which is uploaded by the Site Admin. Default styles are provided with installation, and the Site Admin can customize as needed.</p>
<p>If the Identity Provider login screen is customizable, you will find this defined somewhere in the IdP account settings. For example, in PingFederate it's managed with an HTML adapter.</p>
<p>Some customers like to have a similar look and feel for all UI elements a user might see in the course of their platform experience; others prefer that the external login screen has a different look and feel, which conveys to the user that the login screen is external to the platform.</p>
<p>If you want a similar look and feel for both, you'll need to customize the Community Manager user interface, the Identity Provider login screen, or both.</p>
<p><a href="#top">Back to top</a></p>



<a name="07_06"></a><h4>I am doing the SP setup in PingFederate, but when I import the metadata.xml file I get the message “Invalid signature on metadata file.” What do I do?</h4>
<p>This message means that the signature is being validated and has been found to be invalid. If this occurs, check the following:</p>
<ul>
  <li>In Policy Manager, in Service Provider configuration, make sure that the <strong>Sign Metadata</strong> checkbox is checked.</li>
  <li>In the next tab, <strong>Manage PKI Keys</strong>, check the certificate details that are displayed.</li>
  <li>In Policy Manager, make sure the CA is set up (<strong>Configure</strong> &gt; <strong>Security</strong> &gt; <strong>Certificates</strong> &gt; <strong>Certificate Authority</strong>) and export the certificate.</li>
  <li>Then, in PingFederate, go to Trusted CAs and import the certificate.</li>
</ul>
<p><a href="#top">Back to top</a></p>



<a name="07_07"></a><h4>I configured the OAuth provider and configured SAML Web Browser SSO domain for the resource owner domain, but could not log in</h4>
<p>When you set up the domain in Policy Manager, generate the metadata XML file, and import the metadata file to your Identity Provider, the file includes the information about the endpoints you've configured.</p>
<p>When you add a new OAuth provider domain in Community Manager, a new endpoint is added to the metadata XML file. However, in order for this to work, you must add the information about the new URL to the Service Provider account with your Identity Provider. If this step is not done, the URL will not work.</p>
<p>For more information, and instructions, refer to Adding a New OAuth Provider Domain: Manual IdP Configuration on page 50.</p>
<p><a href="#top">Back to top</a></p>



<a name="07_08"></a><h4>The metadata file doesn't have the login URL for my Community Manager installation</h4>
<p>When you create the identity system in Policy Manager, you must make sure you access the metadata.xml file by using the metadata URL of the container where the features are installed that are using the SAML Web Browser SSO feature. For example:</p>
<ul>
  <li>If this domain is supporting Community Manager login, use the container that has the Community Manager feature installed.</li>
  <li>If OAuth Provider is using this domain for end user authentication, use the container that has the OAuth Provider feature installed.</li>
</ul>
<p>If there is no container with all the features that use the domain installed, get the metadata XML from one of the containers and add the other SSO URLs manually to it before registering the Service Provider with Identity Provider.</p>
<p>If you provide the wrong metadata.xml file to the Identity Provider, the feature will not work.</p>
<p>For example, for login, you should see the login URL for your instance of the platform listed in one of the AssertionConsumerService nodes in the metadata.xml file, as shown below (variables for base URL shown in curly brackets).</p>
<pre>&lt;md:AssertionConsumerService Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST" 
Location="<strong>{http(s)}://{hostname}:{port}//api/login/ssoLogin</strong>" index="7"/&gt;</pre>
<p>For OAuth Provider Domain, the entry in the AssertionConsumerService node would look something like the below.</p>
<pre>&lt;md:AssertionConsumerService Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST" 
Location="<strong>{http(s)}://{hostname}:{port}/oauth/auz/grants/provider/authcomplete</strong>" index="8"/&gt;</pre>
<p><a href="#top">Back to top</a></p>



<div class = "divider1"></div>



<h3 id="related_topics">Related Topics</h3>
<table width="700" border="0" cellspacing="0" cellpadding="2" class="doctable">
  <tr>
  <td width="300"><ul>
  <li><a href="01_overview_saml.htm">Overview of SAML</a></li>
  <li><a href="02_platform_saml_support.htm">SAML Web Browser SSO Support</a></li>
  <li><a href="03_saml_setup.htm">Setting Up the SAML Web Browser SSO Feature</a></li>
  <li><a href="04_req_resp_metadata.htm">Sample Requests, Responses, and Metadata</a></li>
  </ul>
  </td>
  <td width="400"><ul>
  <li><a href="05_idp_examples.htm">Identity Provider Configuration Examples</a></li>
  <li><a href="06_saml_updating.htm">Updating an Existing SAML Installation</a></li>
<!--  <li><a href="07_saml_troubleshooting.htm">Troubleshooting Your SAML Setup</a></li>-->
  <li><a href="08_glossary.htm">Glossary of Terms for SAML</a></li>
  </ul>
</td>
  </tr>
</table>